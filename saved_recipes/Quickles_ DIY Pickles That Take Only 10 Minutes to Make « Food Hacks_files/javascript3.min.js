(function(a){a.fn.textLimiter=function(c){if(window.console&&window.console.firebug)return;var b={moreTemplate:"<span class='txt-small more-link'>...more</span>",dataUrl:"more-url",maxHeight:-1};c&&a.extend(b,c);return this.each(function(){var d=this,c=a(this);window.setTimeout(function(){var g=a(this).data(b.dataUrl);if(g==undefined||g==null||g.Length<1)g="";var h=" <a href='"+g+"'>"+b.moreTemplate+"</a>",e=c.text(),f=0;if(b.maxHeight<0)f=a(c).css("max-height").substring(0,a(this).css("max-height").indexOf("px"));else f=b.maxHeight;c.css({overflow:"hidden",display:"block",visibility:"hidden"}).height(f);if(d.scrollHeight>f){while(e.length>0&&d.scrollHeight>f){e=e.replace(/\s+\S*$/,"");c.html(e+h)}e=e.replace(/\s+\S*$/,"").replace(/\s+\S*$/,"");c.html(e+h)}c.css({overflow:"",display:"",height:"auto",visibility:"visible"})},0)})}})(jQuery);(function(a){a.fn.scrollTo=function(d){if(!this.length)return this;var c={offSetTop:0,offSetBottom:0,speed:200},b=a.extend(c,d);return this.each(function(){var e=a(this),c=-b.offSetTop+b.offSetBottom,d=e.offset().top+c;a("html,body").animate({scrollTop:d},b.speed)})}})(jQuery);(function(a){a.fn.checkBoxSlider=function(){return this.each(function(){var b=a(this);if(b.data("checkBoxSlider"))return b;var c=b.wrap('<label class="checkboxSlider" for="'+b.attr("name")+'"></label>').parent();c.append('<span class="cover"></span><span class="sliderOn">On</span><span class="sliderOff">Off</span>');return b})}})(jQuery);function SetEqualHeights(){jQuery(".featured-content-slider .items").children().setEqualHeight()}jQuery(window).load(function(){SetEqualHeights()});Modernizr.addTest("textoverflow",function(){var a=document.documentElement.style;return"textOverflow"in a||"OTextOverflow"in a});if(typeof String.prototype.trim!=="function")String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(typeof Array.prototype.remove!=="function")Array.prototype.remove=function(a,c){var b=this.slice((c||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,b)};if(typeof String.prototype.capitalize!=="function")String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};if(typeof String.prototype.endsWith!=="function")String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1};if(typeof Array.prototype.indexOf!=="function")Array.prototype.indexOf=function(c,a){a=a?a:0;if(a<this.length)for(var b=a;b<this.length;b++)if(this[b]===c)return b;return-1};(function(a){a.fn.autogrow=function(){this.filter("textarea").each(function(){var b=a(this),e=b.height(),f=b.css("lineHeight"),d=a("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:a(this).width(),fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),lineHeight:b.css("lineHeight"),resize:"none"}).appendTo(document.body),c=function(){var b=this.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n/g,"<br/>");d.html(b);a(this).css("height",Math.max(d.height()+20,e))};a(this).change(c).keyup(c).keydown(c);c.apply(this)});return this};a.ajaxPrefilter(function(a){if(a.url.indexOf("/")!=0&&a.url.indexOf((WHT||{}).urlBase||"/")!=0)return;var d=function(p){var b=p.url+(p.url.indexOf("?")>-1?"&":"?")+"rt=json&rn="+String((new Date).valueOf())+String(Math.random()*1e3),g=b.substring(b.lastIndexOf("=")+1).split("."),i,m="",j=b.lastIndexOf("/"),h=Math.ceil(Math.random()*1e3),o="t",n="",l,k=9,r=b.substring(0,j).toLowerCase(),a=b.substring(j),q=l=Math.floor(Math.random()*k)+2,e="e",t="_",s="-",d=a.indexOf("?"),c="rk="+String(Number(g[0])%Number(g[1])+h);while(--q>0)n+="%"+String(0)+k;for(var f=1;f<arguments.length;f++)c+="&"+arguments[f];c=t+"="+n+"&"+c;i=c.length;if(d>-1){m=a.substring(d);a=a.substring(0,d)}b=r+a.toLowerCase()+String(a.length>0&&a[a.length-1]=="/"||a.indexOf(".")>-1?"":"/")+m;return{uri:b,xrl:["x".toUpperCase(),"r".toUpperCase()+e+"qu"+e+"s"+o,"l".toUpperCase()+e+"ng"+o+"h"].join(s),args:c,prn:String(h-l+i)}},c=(a.data||"").split("&");c.unshift(a);var b=d.apply(d,c);a.data=b.args;a.url=b.uri;arguments[2].setRequestHeader(b.xrl,b.prn)});a.cachedScript=function(c,b){b=a.extend(b||{},{dataType:"script",cache:true,url:c});return jQuery.ajax(b)};a.fn.equals=function(a){if(!a||!a.length||this.length!=a.length)return false;for(var b=0;b<this.length;b++)if(this[b]!==a[b])return false;return true};a.fn.setEqualHeight=function(){var c=a(this),b=0;c.css({height:"auto"});c.each(function(){var c=a(this).height();if(c>b)b=c});c.height(b)};a.validator.unobtrusive.adapters.add("email",function(a){var b=a.Message;return function(a){if(!a||!a.length)return true;var b=/^([a-z0-9_\-\.\']+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-z0-9\-]+\.)+))([a-z]{2,4}|[0-9]{1,3})$/;return b.test(a)}});a.validator.unobtrusive.adapters.add("url",function(a){var b=a.Message;return function(a){if(!a||!a.length)return true;var b=/^(http|https)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(:[a-zA-Z0-9]*)?\/?([a-zA-Z0-9\-\._\?\,\'/\\\+&amp;%\$#\=~])*$/;return b.test(a)}});!a.setCookie&&a.extend({setCookie:function(c,f,d){try{var a=window.location.hostname;a=a.substring(a.indexOf("."));if(!c)return false;var b=new Date;b.setDate(b.getDate()+d);var e=escape(f)+(d==null?"":"; expires="+b.toUTCString());document.cookie=c+"="+e+";path=/;domain="+a+";"}catch(g){return false}return true}});!a.getCookie&&a.extend({getCookie:function(e){try{for(var c,d,b=document.cookie.split(";"),a=0;a<b.length;a++){c=b[a].substr(0,b[a].indexOf("="));d=b[a].substr(b[a].indexOf("=")+1);c=c.replace(/^\s+|\s+$/g,"");if(c==e)return unescape(d)}}catch(f){return false}return false}});a.validator.unobtrusive.parseDynamicContent=function(b){if(a(b).length===0)throw"Error 36: Container"+b+" is null or undefined.";a.validator.unobtrusive.parse(b);var c=a(b).find("form");if(c==null||c.length<1)return;a.each(c,function(){var b=a(this).data("unobtrusiveValidation"),d=c.validate();if(b==null)return;a.each(b.options.rules,function(c,f){if(d.settings.rules[c]==undefined){var e={};a.extend(e,f);e.messages=b.options.messages[c];a('[name="'+c+'"]').rules("add",e)}else a.each(f,function(e,g){if(d.settings.rules[c][e]==undefined){var f={};f[e]=g;f.messages=b.options.messages[c][e];a('[name="'+c+'"]').rules("add",f)}})})})};a("body").ajaxStart(function(){});a("body").ajaxComplete(function(){});a("body").ajaxError(function(d,e,b){try{WHT.ToggleProgressCursor(false);if(b.url.indexOf("/keepalive")>-1||b.url.indexOf("/updateusersession")>-1||b.url.indexOf("/getusernotifications")>-1)return}catch(f){}!WHT.changingPage&&a.jGrowl("An unexpected AJAX Error occurred.",{position:"center",header:"Error Occurred"})});a(".related-articles").scrollable({circular:false,next:".related-articles .arrow.right",prev:".related-articles .arrow.left",itemCount:2,pageSize:2});a(".other-topics").scrollable({circular:false,next:".other-topics .arrow.right",prev:".other-topics .arrow.left",itemCount:3,pageSize:3});a(".hotnow-sidebar-container .slider").scrollable({circular:false,next:".hotnow-sidebar-container .arrow.right",prev:".hotnow-sidebar-container .arrow.left",itemCount:2,pageSize:2}).autoscroll({interval:8e3});a(".newest-articles-sidebar-container .slider").scrollable({circular:false,next:".newest-articles-sidebar-container .arrow.right",prev:".newest-articles-sidebar-container .arrow.left",itemCount:2,pageSize:2}).autoscroll({interval:8e3});a(".itemLinkListContainer .slider").scrollable({circular:false,next:".arrow.right",prev:".arrow.left",itemCount:5,pageSize:5});a(".featured-content-slider").scrollable({circular:false,prev:".previous",itemCount:3}).navigator({navi:".featured-content-slider-nav",pageSize:3}).autoscroll({interval:8e3});a(function(){a(".featured-content-slider-container .gallery-navigate").show();SetEqualHeights()});var b="/"+(location.pathname.split("/")[1]||"")+"/",c=b=="//"?true:false;a(".navbutton-list li a").each(function(){var d=a(this),e=d.attr("href");(e==location.href||e.indexOf(b)>-1&&!c)&&d.addClass("active")});a.jGrowl.defaults.pool=1})(jQuery);window.log=function(){log.history=log.history||[];log.history.push(arguments);arguments.callee=arguments.callee.caller;this.console&&console.log(Array.prototype.slice.call(arguments))};(function(b){function c(){}for(var d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),a;a=d.pop();)b[a]=b[a]||c})(window.console=window.console||{});(function(a,b){var f={LoadingDialogTemplate:"<div class=''>Loading...</div>",LoadingElementTemplate:"<div class='loading-element mgt txt-center'><img src='/images/ajax-loader.gif'/></div>"},g=0,d=[],c={},e=window.navigator&&window.navigator.msPointerEnabled;a.templates=f;a.loggedInUser={};a.currentWorld={};a.urlBase="";a.imgUrlBase="";a.imgFormats=[];a.changingPage=false;a.callingUnload=false;a.init=function(d){var g={ajaxControllerURL:"/ajax/",urlBase:"http://www.wonderhowto.com",imgUrlBase:"http://img.wonderhowto.com",imgFormats:[]};d=b.extend(g,d);if(d.loggedInUser!=null)a.loggedInUser=b.extend(a.loggedInUser,d.loggedInUser);if(d.currentWorld!=null)a.currentWorld=b.extend(a.currentWorld,d.currentWorld);if(d.alerts!=null)a.Alerts.alertsList=d.alerts;if(d.imgFormats!=null)a.imgFormats=b.extend(a.imgFormats,d.imgFormats);a.ajaxControllerURL=d.ajaxControllerURL;a.urlBase=d.urlBase;a.imgUrlBase=d.imgUrlBase;if(a.Alerts.alertsList!=null&&a.Alerts.alertsList.length>0)for(var e=0;e<a.Alerts.alertsList.length;e++)a.Alerts.Show(a.Alerts.alertsList[e]);(function f(b){window.setTimeout(function(){b=b||{};if(a.Article!=null&&a.Article.avid!=null)b={avid:a.Article.avid};a.KeepAlive(b);f(b)},Number(a.loggedInUser.IsUser?.25:5)*6e4)})();c.header=c.header||b("#page-header");c.userInfo=c.userInfo||c.header.find(".user-info");c.logo=c.logo||c.header.find("#logo");c.worldIcon=c.worldIcon||c.header.find(".world-icon");c.worldsList=c.header.find(".worlds-list");c.moreWorldsLink=c.moreWorldsLink||c.header.find(".more-worlds-link");a.World.init();a.OnDocumentReady();a.loggedInUser.IsUser&&!a.Article.ArticleID&&a.KeepAlive();b(window).scroll(a.HandleWindowScroll);a.HandleWindowScroll();b(window).unload(function(){a.changingPage=true;if(a.Article.ArticleID)return a.Article.OnUnload()});window.onbeforeunload=function(){a.changingPage=true;if(a.Article.ArticleID)return a.Article.OnUnload()};window.____iIdleTO=setTimeout(function(){a.NavigateTo("http://www.wonderhowto.com/")},window.location.toString().match("www.wonderhowto.com/$")?9e5:3e6);b(window).load(function(){b(".ad-top").css("height","auto")})};a.clearRedirect=function(){if(window.____iIdleTO!=null){clearTimeout(window.____iIdleTO);window.____iIdleTO=null}};a.animateNumber=function(e,c,d,f,a){a=a||parseInt(b(e).text());if(a==c||c>1e4||a>1e4)return;b(e).data("from-number",a).animate({val:parseInt(c)},{duration:d==null?1500:parseInt(d),easing:f||"easeInOutCirc",step:function(a,c){a=parseInt(b(this).data("from-number"));b(this).text(a+parseInt((c.end-a)*c.state))}})};a.createAjaxDialog=function(c){var g=(+new Date).toString(),h={Buttons:{},Draggable:false,Modal:true,ContainerID:g,Height:"auto",Width:600,MaxHeight:false,MaxWidth:false,Resizable:false,Title:"",AdditionalData:{},onOpen:function(){},beforeClose:function(){}};if(c.Height<1)c.Height="auto";if(c.Width<1)c.Width="auto";c=b.extend(h,c);var d=b("#"+c.ContainerID);if(d.length<1){b("body").append("<div id='"+c.ContainerID+"'></div>");d=b("#"+c.ContainerID);d.html(f.LoadingDialogTemplate)}var e={buttons:c.Buttons,closeOnEscape:!c.Modal,draggable:c.Draggable,height:c.Height,maxHeight:c.MaxHeight,maxWidth:c.MaxWidth,modal:c.Modal,resizable:c.Resizable,position:"center",title:"<span>"+c.Title+"</span>",width:c.Width,open:function(){d.html("Loading...");b.post(c.URL,c.AdditionalData,e);function e(e){d.html(e);b.validator.unobtrusive.parseDynamicContent("#"+c.ContainerID);d.dialog("option","position","center");a.OnElementReady(d);c.onOpen.apply(d)}},beforeClose:function(){c.beforeClose.apply(d)}};d.dialog(e)};a.AddDoAfterLoginCallback=function(a){if(typeof a=="string")a=eval("function(){"+a+"};");else if(typeof a!="function")throw"Callbacks can only be functions or strings to be evaluated as functions.";d.push(a)};a.ClearDoAfterLoginCallbacks=function(){d.length=0};a.DeleteAnimation=function(a){a=b(a);a.animate({backgroundColor:"#fb6c6c"},400,function(){b(this).slideUp(500,function(){b(this).remove()})})};a.RunDoAfterLoginCallbacks=function(a){for(var b in d)d.hasOwnProperty(b)&&d[b].apply(this);a!=null&&typeof a=="function"&&a.apply(this)};a.BuildAJAXUrl=function(g,b){var d=g,c="";if(typeof b!="undefined"&&b!=null){var e=[];for(var f in b)e.push(f+"="+encodeURI(b[f]));c=e.join("&")}return a.ajaxControllerURL+d+(c.length>0?(d.indexOf("?")>-1?d.indexOf("&")>-1?"&":"":"?")+c:"")};a.HandleWindowScroll=function(){a.Header.HandleWindowScroll();a.Article&&a.Article.ArticleID!=0&&a.Article.HandleWindowScroll()};a.KeepAlive=function(c,d,e){c=b.extend({},{nv:false,aid:0,avid:0,pop:false},c);b.ajax({url:a.BuildAJAXUrl("keepalive"),type:"POST",success:function(c){b.isFunction(d)&&d(c);if(c!=null&&c.Response!=null&&c.Response.Value!=null&&c.Response.Value!==true){c.Response.Value.KudosCount!=null&&a.animateNumber(b("#page-header .user-info .credits > a"),c.Response.Value.KudosCount);c.Response.Value.ReputationCount!=null&&a.animateNumber(b("#page-header .user-info .kudos > a"),c.Response.Value.ReputationCount);c.Response.Value.TotalNotificationsCount!=null;if(c.Response.Value.Alerts!=null)for(var f=0;f<c.Response.Value.Alerts.length;f++){var g=c.Response.Value.Alerts[f],e=false;for(var h in a.Alerts.alertsList)if(a.Alerts.alertsList.hasOwnProperty(h)&&a.Alerts.alertsList[h].TimeStamp==g.TimeStamp){e=!e;break}e===false&&a.Alerts.Show(g)}}},dataType:"json",data:c,async:e===true&&c.avid?false:true})};a.NavigateTo=function(b){a.changingPage=true;a.ToggleProgressCursor(true);b=String(b);var c=String(window.location);if(c.indexOf("#")>-1){var e=c.substring(0,c.indexOf("#"));if(b.indexOf("#")>-1){var d=b.substring(0,b.indexOf("#"));if(d==e)b=d}}window.location=b};a.ShowLoginScreen=function(b){b=b||"";a.createAjaxDialog({URL:"/ajax/getloginsignupform/",ContainerID:"loginDialogContainer",Buttons:null,Draggable:false,Modal:true,Height:0,Width:600,MaxHeight:0,MaxWidth:0,Resizable:false,Title:"Login",AdditionalData:{loginMessage:b}});return false};a.ToggleProgressCursor=function(a){if(a)b("body").css("cursor","progress");else b("body").css("cursor","")};a.GetUrlSafeString=function(e){for(var a="",d=e.toLowerCase().trim("- \t\r\n"),c=0;c<d.length;c++){var b=d.charCodeAt(c);if(b>47&&b<58||b>96&&b<123)a+=d.charAt(c);else if(b==32||b==45)a+="-"}if(a.indexOf("-world")==a.length-6)a=a.replace("-world","");if(a.indexOf("-world-")>0)a=a.replace("-world-","-");while(a.indexOf("--")>-1)a=a.replace("--","-");return a};a.OnDocumentReady=function(){a.OnElementReady(b(document));var c=new a.Notifications;c.init();if(window.location.hash=="#_=_")window.location.hash=""};a.OnElementReady=function(a){a=a||b(document);!Modernizr.input.placeholder&&a.find("[placeholder]").placeholder();a.find(".settings-container").settingsMenu();a.find(".item-kudos-container").kudosGiver();a.find("input.checkboxSlider").checkBoxSlider();!Modernizr.textoverflow&&a.find(".longtxt").fixLongText();a.find(".tooltip").aToolTip({fixed:true})};a.ToTitleCase=function(a){try{a=a.replace(/['‘’`]/ig,"'");for(var e="(a|an|and|as|at|but|by|en|for|from|if|in|into|onto|nor|of|on|or|the|to|v[.]?|via|vs[.]?|with)",g="([!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`‘’{|}~-—]*)",m=function(a){return a.toLowerCase()},b=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},i=function(a){return/[A-Za-zÀÁÂÃÄÅàáâãäåÒÓÔÕÖØòóôõöøÈÉÊËéèêëÇçÌÍÎÏìíîïÙÚÛÜùúûüÿÑñ]\.[A-Za-zÀÁÂÃÄÅàáâãäåÒÓÔÕÖØòóôõöøÈÉÊËéèêëÇçÌÍÎÏìíîïÙÚÛÜùúûüÿÑñ]/.test(a)?a:b(a)},j=function(d,a,c){return a+b(c)},l=function(a){return a.toUpperCase()},k=function(c,a,b){return a.toUpperCase()+b},d=[],h=/(—| \(|[:.;?!\)] )|(?: |^)["Ò]/g,n=/\b([A-Za-zÀÁÂÃÄÅàáâãäåÒÓÔÕÖØòóôõöøÈÉÊËéèêëÇçÌÍÎÏìíîïÙÚÛÜùúûüÿÑñ][a-zàáâãäåòóôõöøéèêëçìíîïùúûüÿñ.'Õ]*)\b/g,f=0;;){var c=h.exec(a);d.push(a.substring(f,c?c.index:a.length).replace(n,i).replace(RegExp("\\b"+e+"\\b","ig"),m).replace(RegExp("^"+g+e+"\\b","ig"),j));f=h.lastIndex;if(c)d.push(c[0]);else break}a=d.join("").replace(RegExp("\\b"+e+g+"$","i"),b).replace(/\bon[ ]?([&\/]|and|in|for)[ ]?\b/ig,b).replace(/ V(s?)\. /ig," v$1. ").replace(/(['Õ])S\b/ig,"$1s").replace(/\b(AT&T|Q&A)\b/ig,l).replace(/\b([OU]'[a-zàáâãäåòóôõöøéèêëçìíîïùúûüÿñ])([a-zàáâãäåòóôõöøéèêëçìíîïùúûüÿñ])/ig,k)}catch(o){}return a};a.DecodeEntities=function(){var a=document.createElement("div");function b(b){if(b&&typeof b==="string"){b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi,"");b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi,"");a.innerHTML=b;b=a.textContent;a.textContent=""}return b}return b}();a.EncodeEntities=function(){var a=document.createElement("div");function b(b){if(b&&typeof b==="string"){a.innerHTML="";var c=document.createTextNode(b);a.appendChild(c);b=a.innerHTML}return b}return b}();a.GetKiloFormat=function(a){a=a+"";if(a<1e4)return a;else{var b=(a/1e3).toFixed(0);return b+"k"}};a.Throttle=function(i,j){var c,f,d,b,g,e,h=a.Debounce(function(){g=b=false},j);return function(){c=this;f=arguments;var a=function(){d=null;if(g)e=i.apply(c,f);h()};if(!d)d=setTimeout(a,j);if(b)g=true;else{b=true;e=i.apply(c,f)}h();return e}};a.Debounce=function(d,e,c){var a,b;return function(){var f=this,g=arguments,i=function(){a=null;if(!c)b=d.apply(f,g)},h=c&&!a;clearTimeout(a);a=setTimeout(i,e);if(h)b=d.apply(f,g);return b}};a.AjaxPageable=function(l,z){var c=b.extend({next:".next-items",prev:".previous-items",navigationContainer:".nav-buttons .btn",sortListButtons:".sort-list a",items:".items",item:".item",disabledClass:"disabled",activeClass:"active",itemsPerPage:10,animSpeed:300,textLimiterHeight:160,additionalData:{},onNextPage:function(){}},z||{}),o=b(l),e=this,j=b(c.items,l).first(),q=b(c.navigationContainer,l).length>0?b(c.navigationContainer,l):b(c.navigationContainer),k=b(c.sortListButtons,l).length>0?b(c.sortListButtons,l):b(c.sortListButtons),p=b(c.prev,q.parent()),n=b(c.next,q.parent()),g=c.currentPage||1,w=o.find(".current-page-counter #currentPageLabel").length>0?o.find(".current-page-counter #currentPageLabel"):b(".current-page-counter #currentPageLabel"),d=c.currentFilter||k.closest("."+c.activeClass).text().toLowerCase(),s=c.defaultFilter||"",t=c.maxPages||99999999,x=o.find(".current-page-counter #maxPagesLabel")?o.find(".current-page-counter #maxPagesLabel"):b(".current-page-counter #maxPagesLabel"),h={},r=b(f.LoadingElementTemplate).insertBefore(j).hide(),m="",i=window.History,y=document.title,v=true,u=c.categoryUrlName||"";h[d]=[];h[d][g]=j.html();this.init=function(){e.UpdateNavigationButtons();e.SetupEventHandlers();if(i&&i.enabled){if(!Modernizr.history){i.options.disableSuid=true;window.location.href.indexOf("#")>-1&&e.HistoryStateChange(true)}else i.savedStates.length>1&&e.HistoryStateChange(true);i.Adapter.bind(window,"statechange",e.HistoryStateChange)}};this.HistoryStateChange=function(m){var a=m===true?i.savedStates[0]:i.getState();if(b.isEmptyObject(a.data)){if(a.hash.indexOf("./")>-1||a.hash=="/"){var j=c.currentFilter||k.closest("."+c.activeClass).text().toLowerCase();if(j.toLowerCase()!=d.toLowerCase()||g!=1){d=j;e.LoadNewPage(1,d,false)}}else{var h=a.hash.substring(a.hash.indexOf("#")).split("/"),l=1,f=h[1];if(f.indexOf("by-")>-1)f=f.substring(f.indexOf("by-")+3);d=f;if(h.length>2){if(b.isNumeric(h[2]))l=parseInt(h[2]);e.SeekToPage(l,f,false)}}return false}if(a.data.page!=g||a.data.sortBy.toLowerCase()!=d.toLowerCase()){d=a.data.sortBy;e.SeekToPage(a.data.page,a.data.sortBy,false)}};this.GetCachedPaged=function(b,a){return typeof h[a]=="undefined"||h[a]==null||typeof h[a][b]=="undefined"?null:h[a][b]};this.SetupEventHandlers=function(){q.click(function(h){h.preventDefault();var a=b(this);if(a.hasClass(c.disabledClass))return;var f=g+(a.equals(p)?-1:1);e.SeekToPage(f,d)});k.click(function(f){f.preventDefault();var a=b(this);d=a.data("sortby")||a.text();e.LoadNewPage(1,d);j.fadeOut(c.animSpeed)})};this.LoadNewPage=function(a,g,f){r.show();var d=b.extend({},{page:a,sortBy:encodeURI(g)},c.additionalData);if(u!=="")d.categoryurl=u;b.post(c.pagingURL,d,function(g){if(g.Error==null){var d=g.Response.Value;t=d.MaxPages;x.text(t);m=d.PagingUrlTemplate;e.UpdatePage(d.PageHTML,a,f);if(b.isFunction(c.onNextPage))c.onNextPage(a)}})};this.SeekToPage=function(a,d,f){b(window).scrollTop()>0&&b("html, body").animate({scrollTop:0},c.animSpeed);r.show();if(e.GetCachedPaged(a,d)!=null&&a!=1){j.fadeOut(c.animSpeed,function(){e.UpdatePage(h[d][a],a,f)});if(b.isFunction(c.onNextPage))c.onNextPage(a);return}e.LoadNewPage(a,d,f);j.fadeOut(c.animSpeed)};this.RecordsThisPageCount=function(){return b(c.item,j).length||0};this.UpdatePage=function(o,n,k){j.empty().html(o);try{tmntag.refresh(window._onAjaxUpdateSlots);try{if(Number(b.getCookie("ple")||0)>0){ga("send","event","unblocked","pluginunblocked","Browser Plugin Unblocked - After "+b.getCookie("ple")+"x Blocks");b.setCookie("ple",0)}}catch(p){}}catch(q){try{b.setCookie("ple",Number(b.getCookie("ple")||0)+1);ga("send","event","blocked","pluginblocked","Browser Plugin Blocking Functionality - Ajax ("+b.getCookie("ple")+"x)")}catch(p){}setTimeout(function(){},10)}a.OnElementReady(j);r.hide();j.fadeIn(c.animSpeed,function(){b(this).show()});if(typeof h[d]=="undefined"||h[d==null])h[d]=[];h[d][n]=o;g=n;w.text(g);j=b(c.items,l).first();e.UpdateNavigationButtons();if(i&&i.enabled&&(m||"").length>0&&typeof k!="undefined"?k:true){var f=b.format(m.replace(location.protocol+location.host,""),g);if(f.lastIndexOf("/1/")==f.length-3)f=f.substring(0,f.length-2);if(f.lastIndexOf("/"+s+"/")==f.length-(s.length+2))f=f.substring(0,f.length-(s.length+1));i.pushState({page:g,sortBy:d},y+String(g>1?" - Page "+g:""),f)}};this.UpdateNavigationButtons=function(){p.removeClass(c.disabledClass);n.removeClass(c.disabledClass);g==1&&p.addClass(c.disabledClass);e.RecordsThisPageCount()<c.itemsPerPage&&n.addClass(c.disabledClass);g>=t&&!n.hasClass(c.disabledClass)&&n.addClass(c.disabledClass);if(k.closest("."+c.activeClass).text().toLowerCase()!=d.toLowerCase()||(k.closest("."+c.activeClass).data("sortby")||"").toLowerCase()!=d.toLowerCase()){k.removeClass(c.activeClass);k.each(function(){(b(this).text().toLowerCase()==d.toLowerCase()||(b(this).data("sortby")||"").toLowerCase()==d.toLowerCase())&&b(this).addClass(c.activeClass)})}if(!v){p.find("a").attr("href",b.format(m,Math.max(g-1,1)));n.find("a").attr("href",b.format(m,g+1))}v=false};this.SetAdditionalData=function(a){c.additionalData=a||{};e.SeekToPage(1,d)}};b.fn.pageable=function(c){return this.each(function(){var d=b(this);if(d.data("pageable"))return d.data("pageable");var e=new a.AjaxPageable(d,c);d.data("pageable",e);e.init()})};a.ImgUrl=function(c,b,d){this.toString=function(b,f){if(this.imgID==null||this.imgID==""||this.imgID.length<6)return"";if(b==null||b==""||!b)b=this.defaultFormat;if(!a.ImgUrl.rxIsValidImgFormat.test(b))return"";var d=this.imgID.length,e="",c="";if(b=="original"){e="/"+b;b="";c=this.imgID}else{b="."+b;c=this.titleText}return a.imgUrlBase+"/img"+e+"/"+this.imgID.substr(d-4,2)+"/"+this.imgID.substr(d-2,2)+"/"+this.imgID.substr(0,d-4)+"/0/"+c+b+"."+this.imgExt+String(f===true?this.queryString:"")};this.setValue=function(c,e,d){this.imgID="";this.imgExt="jpg";this.imgFile="";this.queryString="";this.titleText="";this.defaultFormat=e||this.defaultFormat||"300x140";this.isValid=false;d=d==null||d==""?null:d;if(c==null||c=="")return;c=c.replace(/\s/g,"%20");this._initValidFormatsRegEx();var b=a.ImgUrl.rxImageID.exec(c);if(b!=null){this.imgID=String(b[1]);this.titleText=d||this.imgID;if(b[3]!=null)this.imgExt=String(b[3]);if(b[4]!=null)this.queryString=String(b[4]);this.imgFile=this.imgID+"."+this.imgExt;this.isValid=true;return}b=a.ImgUrl.rxFormattedImgUrl.exec(c);if(b!=null){this.imgID=String(b[5])+String(b[3])+String(b[4]);if(b[10]!=null)this.imgExt=String(b[10]);if(b[11]!=null)this.queryString=String(b[11]);this.titleText=d||b[7]==null?this.imgID:String(b[7]);if(e==null&&b[9]!=null)this.defaultFormat=String(b[9]);if(e==null&&b[2]!=null)this.defaultFormat=String(b[2]);this.imgFile=this.imgID+"."+this.imgExt;this.isValid=true;return}b=a.ImgUrl.rxEndsInImageID.exec(c);if(b!=null){this.imgID=String(b[1]);this.titleText=d||this.imgID;if(b[3]!=null)this.imgExt=String(b[3]);if(b[4]!=null)this.queryString=String(b[4]);this.imgFile=this.imgID+"."+this.imgExt;this.isValid=true;return}console.log("!Unable to match valid image id or format for URL:");console.log(c)};this._initValidFormatsRegEx=function(){if(a.ImgUrl.rxFormattedImgUrl!=null)return;if(a.imgFormats.length==0)return;for(var c="(",d="/img(/(original))?/([0-9]{2})/([0-9]{2})/([0-9]{2,16})/([0-9]{1,10})/([a-z0-9\\-_]+)(\\.(",b=0;b<a.imgFormats.length;b++){d+=a.imgFormats[b]+"|";c+=a.imgFormats[b]+"|";if(a.imgFormats[b+1]=="original"){d+="))?\\.(jpg)(\\?(\\S)*)?$";c+="|original)";break}}a.ImgUrl.rxFormattedImgUrl=new RegExp(d,"i");a.ImgUrl.rxIsValidImgFormat=new RegExp(c,"i")};this.setValue(c,b,d)};a.ImgUrl.rxImageID=/^[alc]?([0-9]{6,20})[l]?(\.(jpg))?(\?(\S)*)?$/i;a.ImgUrl.rxFormattedImgUrl=null;a.ImgUrl.rxEndsInImageID=/\/[alc]?([0-9]{6,20})[l]?(\.(jpg))?(\?(\S)*)?$/i;a.ImgUrl.rxIsValidImgFormat=null;a.ImgUrl.toFormat=function(c,e,b,d){return new a.ImgUrl(c,null,d).toString(e,b)};a.ImgUrl.toImgID=function(d,c){var b=new a.ImgUrl(d);return c?b.imgFile:b.imgID};a.Alerts=new function(){var c=this;this.AlertType={Default:0,Award:1,Message:2,Kudos:3};this.alertsList=[];this.DisplayErrorNotification=function(a,c){a=a||"";if(a.ErrorText)a=a.ErrorText;var d=c||6e3;b.jGrowl(a,{life:d})};this.QueueAlert=function(d,c){b.post(a.BuildAJAXUrl("queuealertajax"),{msg:d},function(b){(c||false)&&a.Alerts.Show(b.Response.Value.Alert)})};this.Show=function(d){var e={position:"bottom-left",sticky:false,themeState:"notification",close:function(){d.TimeStamp&&b.post(a.BuildAJAXUrl("dismissalert"),{timeStamp:d.TimeStamp},function(){})}};if(typeof d=="string")d={MessageText:d};if(d.MessageText!=null)d.MessageText=d.MessageText.replace(/\n/g,"<br/>");if(d.UserMessageInfo!=null){e.themeState="message";e.sticky=true}if(d.AlertType==a.Alerts.AlertType.Award)e.themeState="award";if(d.AlertType==a.Alerts.AlertType.Kudos)e.themeState="kudos";if(!d.TimeStamp)d.TimeStamp=(+new Date).toString()+"js";var f=false;for(var g in a.Alerts.alertsList)if(a.Alerts.alertsList.hasOwnProperty(g)&&a.Alerts.alertsList[g].TimeStamp==d.TimeStamp){f=!f;break}!f&&c.alertsList.push(d);d.MessageText&&b.jGrowl(d.MessageText,e)}};a.Article=new function(){var c=this,d=0;this.init=function(d){b.extend(this,d);c._cacheElements();c._setupHandlers();a.Social.GetFacebookInfo({URL:document.location.href},function(a){c.$facebookCountContainer.text(a.share_count)});a.Social.GetTwitterInfo({URL:document.location.href},function(a){c.$twitterCountContainer.text(a.count)});a.KeepAlive({nv:true,aid:a.Article.ArticleID},function(b){a.Article.avid=b.Response.Value.avid})};this._cacheElements=function(){c.$facebookCountContainer=b(".facebook-likes-count");c.$twitterCountContainer=b(".tweet-count");c.$kudosCoverImageContainer=b("#article-sidebar .kudos-cover-image-container");c.$sidebarKudosContainer=b("#article-sidebar .item-kudos-container");c.$articleContainer=b(".article-container");c.$responsesWrapper=b(".responses-wrapper");c.$seeAlsoContainer=c.$articleContainer.find(".see-also-container");if(c.$sidebarKudosContainer&&c.$sidebarKudosContainer.length>0)c.kudosContainerScrollTop=c.$sidebarKudosContainer.offset().top;if(c.$responsesWrapper&&c.$responsesWrapper.length>0)c.responsesWrapperScrollTop=c.$responsesWrapper.offset().top;c.$articleContainer.find(".settings-container ul li a").each(function(){var a=b(this),d=a.data("settings-additionaldata");d&&d.ArticleID==c.ArticleID&&a.text().trim()=="Delete"&&a.data("settings-onresponse","function(response) {if(response.Error==null){WHT.NavigateTo(response.Response.Value.WorldHome);}else{WHT.Alerts.DisplayErrorNotification(response.Error)}}")});c.$responsesWrapper.on("click",".artSubToggle .isSubscribedToArticle",a.Debounce(function(){var e=b(this),f=c.ArticleID,d=e.is(":checked");console.log(d);if(!a.loggedInUser.IsUser){e.prop("checked",!d);a.ShowLoginScreen("Please login to subscribe this post's comments:");a.AddDoAfterLoginCallback(function(){if(a.loggedInUser.IsUser){e.prop("checked",d);b.post("/ajax/UpdateArticleSubscription",{ArticleID:f,IsSubscribing:d})}})}else b.post("/ajax/UpdateArticleSubscription",{ArticleID:f,IsSubscribing:d})},300));var d=[{message:a.loggedInUser.IsUser?"Got It!":"Login with Facebook",navigateURL:a.loggedInUser.IsUser?"javascript://":"/Account/ConnectToFacebook?returnUrl="+encodeURI(window.location.href),mainButton:true}];!a.loggedInUser.IsUser&&d.push({message:"Maybe Later",onClick:function(){}});c.kudosGuideable=c.$sidebarKudosContainer.guideable({mainHeadline:"Give Kudos to Help Promote Great Posts to the Homepage",secondaryHeadline:a.loggedInUser.IsUser?"":"",guideType:a.Enums.GuideType.FirstArticlePage,guideMessage:a.loggedInUser.IsUser?"When you like a post, be sure to thank the author by giving Kudos!":"WonderHowTo is show &amp; tell for creators &amp; doers, like you! Care to join us?",buttons:d})};this._setupHandlers=function(){b(".social-icon.facebook").click(function(){a.Social.FacebookShare({URL:document.location.href})});b(".social-icon.twitter").click(function(){a.Social.TwitterShare({URL:document.location.href})});c.$seeAlsoContainer.on("click",".show-more-link",function(){c.$seeAlsoContainer.find(".hide").fadeIn(1e3);b(this).hide()});c.HandleWindowScroll();b(window,document).resize(c.HandleWindowResize);b(window).load(function(){c.HandleWindowResize();c.HandleWindowScroll()})};this.HandleWindowScroll=function(){var d=b(document).scrollTop(),a=c.$kudosCoverImageContainer;if(d>c.kudosContainerScrollTop&&d<c.responsesWrapperScrollTop)!a.hasClass("fixed")&&a.addClass("fixed");else if(a&&a.length>0&&a.hasClass("fixed")){a.removeClass("fixed");c.kudosContainerScrollTop=c.$sidebarKudosContainer.offset().top}};this.HandleWindowResize=function(){if(c.$sidebarKudosContainer&&c.$sidebarKudosContainer.length>0&&!c.$sidebarKudosContainer.hasClass("fixed"))c.kudosContainerScrollTop=c.$sidebarKudosContainer.offset().top;c.responsesWrapperScrollTop=c.$responsesWrapper.offset().top-80-(c.$kudosCoverImageContainer.hasClass("hasImage")?45:0)};this.OnUnload=function(){if(a.callingUnload)return;a.callingUnload=a.changingPage=true;a.KeepAlive({avid:a.Article.avid},null,true)};this.ChangeCoverImage=function(c){a.Images.CreatePreviewImageUploader({imagePreviewUploadOptions:{uploadType:"GalleryImage",isUploadToIDOptional:true,uploadToID:0},ajaxDialogOptions:{Title:"Upload Feature Image"},cropOptions:{enabled:true,onResponse:function(d,e){if(d.Error!=null){b("#"+e).dialog("close");a.Alerts.DisplayErrorNotification(d.Error.ErrorText)}else{var f=d.Response.Value;b.post(a.BuildAJAXUrl("UpdateCoverImageArticle",{imageID:f.ImageID,articleID:c},function(b){if(b.Error!=null)a.Alerts.DisplayErrorNotification(b.Error);else a.NavigateTo(location)}));b("#"+e).dialog("close")}},aspectRatio:300/140,minSize:[300,140],liveThumbnailSize:[300*.5,140*.5]}})}};a.Enums=new function(){this.GuideType={None:0,FirstArticlePage:1,FirstHomePage:2,FirstKudosGiven:4,FirstLogin:8,FirstWorldAdmin:16,SawHomePageCallToAction:32};this.GuideDirections={Top:1,Right:2,Bottom:3,Left:4};this.WorldSubCategoryType={Any:0,HowTo:1,Inspiration:2,Forum:3};this.WorldSubCategoryMode={Unchanged:-1,TextList:0,ImageGrid:1}};a.Forms=new function(){this.DisableForm=function(a){if(typeof a=="string")a=b(a);a.find('form input[type="submit"]').attr("disabled","disabled")};this.EnableForm=function(a){if(typeof a=="string")a=b(a);a.find('form input[type="submit"]').removeAttr("disabled")};this.OnAjaxFormComplete=function(c){var e={response:{},formContainer:"",closeDialogOnSuccess:true,replaceFormOnError:true,onError:function(){return true},onSuccess:function(){return true}};c=b.extend({},e,c);if(typeof c.formContainer=="string")c.formContainer=b(c.formContainer);var d={};try{d=!c.response.responseText||false?c.response:b.parseJSON(c.response.responseText)}catch(f){d={Error:{ErrorCode:500,ErrorText:"Unknown error occcured"},Response:{Value:{Success:false}}}}a.Forms.EnableForm(c.formContainer);if(d.Error!=null){if(c.onError(d)!==false)c.replaceFormOnError&&c.formContainer.html(d.Error.ErrorText)}else if(c.onSuccess(d)!==false)c.closeDialogOnSuccess&&(c.formContainer.data("dialog")||false)&&c.formContainer.dialog("close")}};a.Guidable=function(n,m){var c=b.extend({},{animationSpeed:500,guideType:a.Enums.GuideType.None,direction:a.Enums.GuideDirections.Left,showOnStart:false,wrapRoot:true,mainHeadline:"Welcome to WonderHowTo!",secondaryHeadline:"We're show & tell for creators & doers.",guideMessage:"",buttons:[]},m||{}),e=b(n),g=this,d={},f={},h={};this.init=function(){c.showOnStart&&g.Show()};this.Show=function(){b.isEmptyObject(d)&&i()};this.SetUserGuideFlag=function(a,d){a=a||c.guideType;if(typeof d=="undefined"||d==null)d=true;var e=g.GetUserGuideFlag();if(d)e|=a;else e&=~a;b.setCookie("GuideFlag",e,365)};this.GetOptions=function(){return c};this.GetUserGuideFlag=function(){return b.getCookie("GuideFlag")||a.Enums.GuideType.None};this.UserHasGuideFlag=function(a){if(typeof a=="undefined"||a==null)a=c.guideType;return!a?false:g.GetUserGuideFlag()&a?true:false};this.GetFlyoutContainer=function(){return d};this.GetWrapper=function(){return f};function i(){if(!b.isEmptyObject(d)||!b.isEmptyObject(f))return;var i=l(),h="<div class='guide-flyout-container"+i+"'><div class='guide-flyout'><div class='clearfix txt-title  txt-shadow-btm-dark' style='border-bottom: 1px solid #383838;'><span class='txt-size-bigger txt-clr-lightest mgr-small'>{0}</span> <span class='txt-size-normal txt-clr-meddark'>{1}</span></div><div class='mgt'><p class='txt-clr-medlight txt-size-normal'>{2}</p></div><div class='buttons-container mgt-med'></div> </div></div>";h=b.format(h,c.mainHeadline,c.secondaryHeadline,c.guideMessage);if(c.wrapRoot){f=b("<div class='guide-flyout-wrapper"+i+"'></div>").insertBefore(e).wrapInner(e);d=b(h).appendTo(f)}else d=b(h).insertAfter(e);j();d.css("opacity",0).show();var g={opacity:1};if(c.direction==a.Enums.GuideDirections.Left)g.left=e.width()-5+"px";else if(c.direction==a.Enums.GuideDirections.Top){d.css("left",e.width()/-2+30+"px");g.top=e.height()-10+"px"}else if(c.guideType==a.Enums.GuideType.FirstWorldAdmin)g.right="-15px";d.animate(g,c.animationSpeed,"easeOutBack")}function j(){var f="<div class='btn wide rnd fl {0}'><a href='{1}' class='txt-size-normal {2}'>{3}</a></div>";h=d.find(".buttons-container");if(c.buttons.length>0){for(var a=0;a<c.buttons.length;a++)var e=c.buttons[a]=b.extend({},{message:"",navigateURL:"javascript://",mainButton:false},c.buttons[a]),i=b(b.format(f,k(e),e.navigateURL,e.mainButton?"txt-clr-lightest txt-shadow-btm-dark":"txt-clr-darkest txt-shadow-btm-light",e.message)).appendTo(h).data("guideable-id",a);h.on("click",".btn",function(a){var e=b(a.target),f=c.buttons[b(this).data("guideable-id")];if(e&&e.attr("href")&&e.attr("href").indexOf("javascript:")==0){a.stopImmediatePropagation();a.preventDefault()}if(f.onClick&&f.onClick(a)==false)return false;d.fadeOut(c.animationSpeed);g.SetUserGuideFlag()})}}function k(b){var a=" ";if(b.mainButton)a+="blue mgr ";else a+="silver";return a}function l(){var b=" ";for(var e in a.Enums.GuideDirections)if(a.Enums.GuideDirections[e]==c.direction)b+=e+" ";for(var d in a.Enums.GuideType)if(a.Enums.GuideType[d]==c.guideType)b+=d+" ";return b}};b.fn.guideable=function(d){var e=b(this),c=e.data("guideable");if(c&&(typeof d=="undefined"||!d||b(c.GetOptions()).equals(d)))return c;this.each(function(){c=new a.Guidable(e,d);e.data("guideable",c);c.init()});return c};a.Header=new function(){var d=0,a=0;this.HandleWindowScroll=function(){window.clearTimeout(g);var f=c.header,d=b(window),e=d.scrollTop();a=a>0?a:c.header.offset().top;g=window.setTimeout(function(){if(d.scrollTop()>a)!c.header.hasClass("fixed")&&c.header.addClass("fixed");else c.header.hasClass("fixed")&&c.header.removeClass("fixed")},1)};this.SetHeightandPosition=function(c,b){d=c;a=b}};a.Images=new function(){this.uploadifyOptions=[];this.CreatePreviewImageUploader=function(c){var d=+new Date,c=b.extend(true,{imagePreviewUploadOptions:{uploadType:"",isUploadToIDOptional:false,uploadToID:0,CropOnly:false,ExistingImageID:""},uploadifyOptions:{ID:d,auto:true,uploader:"/js/libs/uploadify/uploadify.swf",cancelImg:"/js/libs/uploadify/cancel.png",script:a.BuildAJAXUrl("uploadpreviewimage/"),sizeLimit:10485760,fileExt:"*.jpg;*.gif;*.png",fileDesc:"Web Image Files (.JPG, .GIF, .PNG)",onError:function(e,f,c,a){console.log("Error occured uploading file:",e,f,c,a);b("#file_upload_error"+d).text("Could not upload file.")},onComplete:function(j,l,i,g){try{if(typeof g==="string")g=b.parseJSON(g)}catch(m){g={Response:{Value:{Success:false}},Error:{ErrorCode:500,ErrorText:"Unknown error occurred."}}}if(g.Error!=null){b("#file_upload_error"+d).text(g.Error.ErrorText);return}var e=g.Response.Value;if(!c.cropOptions.enabled||e.OriginalWidth<c.cropOptions.minSizeToCrop[0]||e.OriginalHeight<c.cropOptions.minSizeToCrop[1]){if(c.uploadifyOptions.onResponse&&b.isFunction(c.uploadifyOptions.onResponse))c.uploadifyOptions.onResponse(g,d);else if(c.cropOptions.onResponse&&b.isFunction(c.cropOptions.onResponse))c.cropOptions.onResponse(g,d)}else{if(e.ImageWidth<c.cropOptions.minSize[0]||e.ImageHeight<c.cropOptions.minSize[1]){b("#"+d).dialog("close");a.Alerts.DisplayErrorNotification("This image is too small.\n The minimum size is: "+c.cropOptions.minSize[0]+"x"+c.cropOptions.minSize[1]);return false}if(e.ImageWidth>c.cropOptions.maxSize[0]||e.ImageHeight>c.cropOptions.maxSize[1]){b("#"+d).dialog("close");a.Alerts.DisplayErrorNotification("This image is too big. \nThe maximum size is: "+c.cropOptions.maxSize[0]+"x"+c.cropOptions.maxSize[1]);return false}if(e.ImageWidth>600){e.ImageWidth=600;e.ImageHeight=e.OriginalHeight*600/e.OriginalWidth}if(e.ImageHeight>600){e.ImageWidth=e.OriginalWidth*600/e.OriginalHeight;e.ImageHeight=600}var f={width:0,height:0};if(c.cropOptions.aspectRatio>4/3){f.width=e.OriginalWidth;f.height=e.OriginalWidth/c.cropOptions.aspectRatio;e.Top=Math.max(e.OriginalHeight/2-f.height/2,0);e.Left=0;e.Right=e.OriginalWidth;e.Bottom=Math.max(e.OriginalHeight/2+f.height/2,0)}else if(c.cropOptions.aspectRatio==0){f.width=e.OriginalWidth;f.height=e.OriginalHeight;e.Top=0;e.Left=0;e.Right=e.OriginalWidth;e.Bottom=e.OriginalHeight}else{f.width=e.OriginalHeight*c.cropOptions.aspectRatio;f.height=e.OriginalHeight;e.Top=0;e.Left=Math.max(e.OriginalWidth/2-f.width/2,0);e.Right=Math.max(e.OriginalWidth/2+f.width/2,0);e.Bottom=f.height}b("#image_upload_container_"+d).html("Loading preview image...");b("#live_thumbnail"+d).css({width:c.cropOptions.liveThumbnailSize[0]+"px",height:c.cropOptions.liveThumbnailSize[1]+"px"});b("#croppable_image"+d+", #preview_image"+d).attr("src",e.PreviewImageURL);var h;b("#croppable_image"+d).bind("load",function(){var f=window.setInterval(function(){b("#image_upload_container_"+d).hide();b("#preview_image_container"+d).width(e.ImageWidth+c.cropOptions.liveThumbnailSize[0]+20).height(e.ImageHeight).show();b("#"+d).dialog("option","position","center");b("#croppable_image"+d).Jcrop({onChange:function(b){a.Images.UpdateLivePreviewImage(b,e,d,c.cropOptions.liveThumbnailSize)},onSelect:function(b){a.Images.UpdateLivePreviewImage(b,e,d,c.cropOptions.liveThumbnailSize)},aspectRatio:c.cropOptions.aspectRatio,setSelect:typeof c.cropOptions.setSelect!="undefined"&&c.cropOptions.setSelect!=null?c.cropOptions.setSelect:[e.Left,e.Top,e.Right,e.Bottom],minSize:c.cropOptions.minSize,maxSize:c.cropOptions.maxSize,trueSize:[e.OriginalWidth,e.OriginalHeight],boxWidth:600,boxHeight:600},function(){h=this;b("#preview_image_container"+d).find(".jcrop-holder").addClass("fl")});window.clearInterval(f)},100)});b("#saveCroppedImageButton"+d).click(function(){var f=h.tellSelect(),g=b(this);if(g.hasClass("disabled"))return;if(f.w<c.cropOptions.minSize[0]||f.h<c.cropOptions.minSize[1]){a.Alerts.DisplayErrorNotification("Please select an area of your image to crop.");return}if(f.w>c.cropOptions.maxSize[0]||f.h>c.cropOptions.maxSize[1]){a.Alerts.DisplayErrorNotification("Please make sure the selected area of your image is not too big.");return}g.addClass("disabled");b.post(a.BuildAJAXUrl("savepreviewimage"),{UploadKey:a.Images.GetUploadifyOption(d).uploadKey,h:Math.floor(f.h),w:Math.floor(f.w),x:Math.floor(f.x),x2:Math.floor(f.x2),y:Math.floor(f.y),y2:Math.floor(f.y2),ImageID:e.ImageID,OriginalWebUrl:e.OriginalWebUrl,IsCroppedImage:true,ContentID:c.imagePreviewUploadOptions.uploadToID},function(a){g.removeClass("disabled");c.cropOptions.onResponse(a,d)}).error(function(){g.removeClass("disabled")})})}}},ajaxDialogOptions:{URL:a.BuildAJAXUrl("getpreviewimageuploadform",{TimeStamp:d,UploadType:c.imagePreviewUploadOptions.uploadType,IsUploadToIDOptional:c.imagePreviewUploadOptions.isUploadToIDOptional,UploadToID:c.imagePreviewUploadOptions.uploadToID,CropOnly:c.imagePreviewUploadOptions.CropOnly}),Title:"Upload New Image",Width:"auto",ContainerID:d,onOpen:function(){b("#upload_web_image_button_"+d).click(function(f){f.preventDefault();var e=b(this);if(e.hasClass("disabled"))return;e.addClass("disabled").val("Uploading...");b.post(a.BuildAJAXUrl("uploadpreviewimage"),{UploadKey:b("#upload_web_image"+d).val()},function(a){c.uploadifyOptions.onComplete({},"",{},a,{});a.Error!=null&&e.removeClass("disabled").val("Upload")})});c.imagePreviewUploadOptions.CropOnly&&b.post(a.BuildAJAXUrl("getalreadycroppedimage"),{ImageID:c.imagePreviewUploadOptions.ExistingImageID},function(a){c.uploadifyOptions.onComplete({},"",{},a,{})})}},cropOptions:{enabled:false,onResponse:function(){},aspectRatio:0,maxSize:[9223372036854775807,9223372036854775807],minSize:[1,1],liveThumbnailSize:[135,180],minSizeToCrop:[0,0]}},c);a.Images.uploadifyOptions.push(c.uploadifyOptions);a.createAjaxDialog(c.ajaxDialogOptions)};this.UpdateLivePreviewImage=function(c,d,h,e){var g=d.OriginalWidth,f=d.OriginalHeight,a=e[0]/c.w;b("#preview_image"+h).css({width:Math.round(a*g)+"px",height:Math.round(a*f)+"px",marginLeft:"-"+Math.round(a*c.x)+"px",marginTop:"-"+Math.round(a*c.y)+"px"})};this.GetUploadifyOption=function(b){for(var a=0;a<this.uploadifyOptions.length;a++)if(this.uploadifyOptions[a].ID==b)return this.uploadifyOptions[a]}};a.KudosGiver=function(q,p){var f=b.extend({speed:100,activeClass:"active",kudosGivenClass:"given",kudosRemovedClass:"removed",upvoteCallback:function(){},downvoteCallback:function(){}},p||{}),c=b(q),d=this,n=c.find(".animate-container"),i=n.find(".items"),e=i.find(".kudos-balance"),m=e.clone().addClass("give").insertAfter(e),k=e.clone().addClass("remove").insertBefore(e),g=c.data("kudos-given")||0,o=c.data("article-id")||0,l=c.data("current-total-kudos")||0,h=window.setTimeout(function(){},1),j=c.data("guideable");b(window).load(function(){if((!a.Article.ArticleID||a.Article.ArticleID&&a.User.HasGuideFlag(a.Enums.GuideType.FirstArticlePage))&&!a.User.HasGuideFlag(a.Enums.GuideType.FirstKudosGiven)){var e=0,f="",d=c.parent();if(d.hasClass("frontpage-item")){var b=d.find(".comment-count a");e=parseInt(b.text());f=b.attr("href")}j=c.guideable({guideType:a.Enums.GuideType.FirstKudosGiven,mainHeadline:"Thank you! You've Spent Your First Credit!",secondaryHeadline:"",guideMessage:"Go spend the rest of your Credits by giving Kudos to more worthy posts.",buttons:[{message:"How Can I Earn More Credits?",mainButton:true,onClick:function(b){b.preventDefault();a.NavigateTo(a.imgUrlBase.replace("img","creator")+"/"+a.loggedInUser.UserName+"/credits")}},{message:"Got it!"}]})}});this.init=function(){b(function(){window.setTimeout(function(){i.css({top:-e.position().top-2})},50)});d.SetupEventHandlers()};this.GiveOrRemoveKudos=function(h){if(!a.loggedInUser.IsUser){a.ShowLoginScreen("Login to give Kudos to this post:");a.AddDoAfterLoginCallback(function(){d.GiveOrRemoveKudos(h)});return}var h=b.extend({isUpvote:true,kudosPower:a.loggedInUser.KudosPower||1,judgementPower:a.loggedInUser.JudgementPower||1,onVoteComplete:function(){}},h||{});if(g>0&&h.isUpvote&&!a.loggedInUser.IsStaff||g<0&&!h.isUpvote&&!a.loggedInUser.IsStaff)return;var i={KudosGiven:h.isUpvote?h.kudosPower:0,JudgementGiven:!h.isUpvote?h.judgementPower:0,KudosBalance:parseInt(e.text())+(h.isUpvote?h.kudosPower:-1*h.judgementPower)};c.removeClass(h.isUpvote?f.kudosRemovedClass:f.kudosGivenClass);if(g==0)c.addClass(h.isUpvote?f.kudosGivenClass:f.kudosRemovedClass);else{i.KudosGiven=0;i.JudgementGiven=0;i.KudosBalance-=h.isUpvote?h.kudosPower:-1*h.judgementPower}d.UpdateKudosBalance(i);if(!b.isEmptyObject(j)&&!j.UserHasGuideFlag())if(b(".guide-flyout-container:visible").length<1)if(a.Article.ArticleID){a.Article.HandleWindowResize();a.Article.HandleWindowScroll()}b.post(a.BuildAJAXUrl("givekudos"),{ArticleID:o,Kudos:h.isUpvote},function(a){h.onVoteComplete(a);try{d.UpdateKudosBalance(a.Response.Value.Kudos||i)}catch(b){}})};this.UpdateKudosBalance=function(a){g=a.KudosGiven>=a.JudgementGiven?a.KudosGiven:-1*a.JudgementGiven;if(a.KudosBalance!=l){l=a.KudosBalance;var b={top:-(g>0?m.position().top:k.position().top)};g>0?m.text(a.KudosBalance):k.text(a.KudosBalance);i.animate(b,f.speed,"easeInQuad",function(){e.text(a.KudosBalance);i.css({top:-e.position().top})})}};this.SetupEventHandlers=function(){c.hover(function(){window.clearTimeout(h);h=window.setTimeout(function(){d.ContainerHover(true)},100)},function(){window.clearTimeout(h);h=window.setTimeout(function(){d.ContainerHover(false)},100)});c.on("click",".up.vote",d.UpvoteClick);c.on("click",".down.vote",d.DownvoteClick)};this.UpvoteClick=function(){d.GiveOrRemoveKudos({isUpvote:true,onVoteComplete:f.upvoteCallback})};this.DownvoteClick=function(){d.GiveOrRemoveKudos({isUpvote:false,onVoteComplete:f.downvoteCallback})};this.ContainerHover=function(){}};b.fn.kudosGiver=function(c){return this.each(function(){var d=b(this);if(d.data("kudosgiver"))return d.data("kudosgiver");var e=new a.KudosGiver(d,c);d.data("kudosgiver",e);e.init()})};a.FixLongText=function(e){var g=b.extend({}),a=e,h=this,c=a.text();this.init=function(){d()};function d(){if(a[0].scrollWidth>a[0].offsetWidth){a.addClass("tooltip");a.attr("title",c);var b=c;while(a[0].scrollWidth>a[0].offsetWidth&&b.length>0){b=b.substr(0,b.length-1);a.text(b+"...")}}}};b.fn.fixLongText=function(c){return Modernizr.textoverflow?this:this.each(function(){var e=b(this),d=new a.FixLongText(e,c);d.init()})};a.Messages=new function(){this.DeleteMessage=function(c){var d={userID:0,conversationID:0,messageID:0,onResponse:function(){}};c=b.extend(d,c);a.ToggleProgressCursor(true);b.post(a.BuildAJAXUrl("deletemessage"),{UserID:c.userID,MessageID:c.messageID,ConversationID:c.conversationID},function(b){a.ToggleProgressCursor(false);c.onResponse(b)})};this.ReplyToMessage=function(c){var d={replyToMessageID:0,toUserID:0,body:"",fromUserID:0,onResponse:function(){}};c=b.extend(d,c);b.post(a.BuildAJAXUrl("sendreplymessagepost"),{ReplyToMessageID:c.replyToMessageID,ToUserID:c.toUserID,Body:c.body,FromUserID:c.fromUserID},function(b){a.ToggleProgressCursor(false);c.onResponse(b)})}};a.Notifications=function(){var H=this,h=0,u=0,w=0,r=0,x=0,z=false,d=[],g=[],m=false,y=0,v=0,s=false,f={},p={},q={},n=1,j=5,i=false;this.init=function(){F();G()};function l(e){e=b.extend({markAsRead:false,replaceMarkup:true,isSeederRender:false,seededUsers:[],itemsPerPage:j,page:1},e);var i=0,k=!e.isSeederRender?d:e.seededUsers,m=0;if(e.isSeederRender&&g.length<1)g=e.seededUsers;k&&k.length>0&&f.show();if(e.replaceMarkup){var l="";for(i=(e.page-1)*e.itemsPerPage;i<e.page*e.itemsPerPage&&i<k.length;i++){var h=k[i],o="<li class='"+D(h)+"'><a href='{0}' "+(h.NotificationType<0?"style='cursor:default;'":"")+" class='txt-clr-lightest clearfix'>"+(h.AboutUserID>0?"<img src='{1}' width='18' height='24' class='mgr-smaller fl'/>":"")+"<span class='fl notification-text'>{2}</span></a></li>",p=h.NotificationSummaryTemplate.replace("{AboutUser}",a.EncodeEntities(h.AboutUserDisplayName)).replace("{ContentName}",a.EncodeEntities(h.ContentTitle)).replace("{CommentOrResponse}",h.ArticleType==30?"responded to":"commented on").replace("{PostThread}",h.ArticleType==30?"thread":"post").replace("{WorldName}",a.EncodeEntities(h.WorldName)).replace("{ArticleType}",h.ArticleType==30?"Forum":h.ArticleType==20?"Inspiration":h.ArticleType==10?"How-Tos":"");l+=b.format(o,h.ActionLink||"",h.AboutUserImageURL||"",p||"");m++}E({itemsPerPage:e.itemsPerPage,currentItemsPerPage:m,currentPage:e.page,listLength:k.length});if(e.page!=n)c.notificationsListContainer.fadeOut(250,function(){c.notificationsListContainer.html(l);c.notificationsListContainer.fadeIn(250)});else c.notificationsListContainer.html(l)}if(e.markAsRead&&!e.isSeederRender)for(i=0;i<k.length;i++)k[i].IsNew=false;!e.isSeederRender&&C()}function B(){var f=b(this),h=f.hasClass("next"),c=g.length>0,e=c?g.length:d.length,a=n;if(f.hasClass("disabled"))return;a=h?a+1:a-1;if((a-1)*j>e)a=Math.round(e/j);if(a<1)a=1;l({replaceMarkup:true,isSeederRender:c,seededUsers:g,page:a});n=a}function E(a){a=b.extend({itemsPerPage:j,currentItemsPerPage:0,currentPage:1,listLength:0},a);p.addClass("disabled");q.addClass("disabled");a.currentPage>1&&q.removeClass("disabled");a.currentItemsPerPage>=a.itemsPerPage&&a.currentPage<a.listLength/a.itemsPerPage&&p.removeClass("disabled")}function D(a){var b="mgb-smaller";if(a!=null&&a){if(a.IsNew)b+=" isNew";else b+=" isOld";if(a.NotificationType<0)b+="' onclick='return false;";else if(a.NotificationType==99)" seeder-notification' data-user-id='"+a.UserID+"'"}return b}function k(e){e=b.extend({markAsRead:false,replaceMarkup:true},e);b.post(a.BuildAJAXUrl("getusernotifications"),{markAsRead:e.markAsRead},function(a){if(a.Error==null){m=false;d=a.Response.Value;c.profileArea.find(".loading-element").hide();if(d.length<1){d.push({NotificationSummaryTemplate:"You currently have no notifications.",ActionLink:"/",NotificationType:-1});f.hide()}l(e)}})}function C(){for(var a=0,b=0;b<d.length;b++){var e=d[b];if(e.IsNew)a++}c.profileArea.find(".new-notifications").text(a);a+=y+v;if(a>0)c.profileArea.removeClass("noNotifications").addClass("hasNotifications").find("a .notifications-area").text(a);else c.profileArea.removeClass("hasNotifications").addClass("noNotifications").find("a .notifications-area").hide()}function F(){c.profileArea=c.userInfo.find(".profile-area");c.creditsCountContainer=c.userInfo.children(".credits");c.kudosCountContainer=c.profileArea.siblings(".kudos");c.worldsListContainer=c.header.find(".worlds-list-container");y=c.profileArea.data("new-message-count");v=c.profileArea.data("rough-drafts-count");c.notificationsListContainer=c.profileArea.find(".notifications-list");c.logOutButton=c.profileArea.find(".logout-btn");f=c.profileArea.find(".nav-buttons");p=f.find(".next");q=f.find(".prev")}function G(){var g=function(a){h&&window.clearTimeout(h);i=true;if(a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&!c.profileArea.data("isCallingHover")){a.preventDefault();a.stopImmediatePropagation();return false}o(true)},d=function(a){if(a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&!c.profileArea.data("isCallingHover")){a.preventDefault();a.stopImmediatePropagation();return false}h&&window.clearTimeout(h);i=false;h=window.setTimeout(function(){o(false)},1e3)};if(e&&c.profileArea[0]){c.profileArea[0].addEventListener("MSPointerOver",g,false);c.profileArea[0].addEventListener("MSPointerOut",d,false)}else{c.profileArea.on("mouseenter",g);c.profileArea.on("mouseleave",d)}var j=function(a,b){if(a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&!b.data("isCallingHover")){a.preventDefault();a.stopImmediatePropagation();return false}H.HandleSimpleHover({on:a.type=="mouseenter"||a.type=="MSPointerOver"||a.type=="click"&&!b.hasClass("active"),element:b})};b.each([c.creditsCountContainer,c.kudosCountContainer,c.worldsListContainer],function(b,a){(function(c,a){function b(b){j(b,a)}if(e&&a[0]){a[0].addEventListener("MSPointerOver",b,false);a[0].addEventListener("MSPointerOut",b,false)}else{a.on("mouseenter",b);a.on("mouseleave",b)}})(b,a)});if(e||Modernizr.touch){var k=function(c){var f=b(this),e=f.parent(),h=e.data("isCallingHover");c.preventDefault();c.stopImmediatePropagation();h===undefined&&e.removeClass("active");f.parents(".active").length>0&&h!==undefined&&!~f.attr("href").indexOf("javascript")&&a.NavigateTo(f.attr("href"));e.data("isCallingHover",true);if(e.hasClass("profile-area"))c.type=="mouseenter"||c.type=="MSPointerOver"||c.type=="click"&&!e.hasClass("active")?g(c):d(c);else j(c,e);e.data("isCallingHover",false);return false};c.userInfo.find("a").on("click",k);c.worldsListContainer.find("a").on("click",k)}b("body").on("click",function(a){if(e||Modernizr.touch)i=!!b(a.target).parents(".active").length;if(!i){o(false);c.header.find(".active").removeClass("active")}});c.logOutButton.click(function(d){d.preventDefault();var c=b(this);if(c.hasClass("disabled"))return;else c.addClass("disabled");b.post("/Account/Logout",{},function(){a.NavigateTo(location)})});c.notificationsListContainer.on("click","li > a",A);f.on("click",".btn",B);c.switchAccountButton=c.profileArea.find(".switch-account-btn");c.switchAccountButton.click(function(){var a=c.profileArea.find(".loading-element").show();c.notificationsListContainer.html();s=true;b.post("/Ajax/GetSeederUsers",function(b){if(!b.Error){var c=b.Response.Value.SeededUsers;a.hide();l({isSeederRender:true,seededUsers:c,replaceMarkup:true})}})});c.profileArea.find(".switch-original-account-btn").click(function(a){a.preventDefault();t({switchToOriginal:true})})}this.HandleSimpleHover=function(a){a=b.extend({on:true,element:c.creditsCountContainer},a);window.clearTimeout(u);window.clearTimeout(w);window.clearTimeout(r);if(!a.on){var d=window.setTimeout(function(){a.element.toggleClass("active",false)},1e3);if(a.element.hasClass("credits"))u=d;else if(a.element.hasClass("kudos"))w=d;else r=d}else{c.header.find(".active").removeClass("active");a.element.toggleClass("active",true)}};function A(d){var c=b(this),a=c.data("user-id");if(a){d.preventDefault();t({userID:a})}k({markAsRead:true})}function t(c){c=b.extend({userID:0,switchToOriginal:false},c);b.post("/Ajax/SwitchAccount",{userID:c.userID,switchToOriginal:c.switchToOriginal},function(b){b.Error!=null&&a.NavigateTo(location)})}function o(a){if(a){c.profileArea.siblings().removeClass("active");c.worldsListContainer.removeClass("active");c.profileArea.addClass("active");window.clearTimeout(x);x=window.setTimeout(function(){if(c.profileArea.hasClass("active")&&!z&&!s){z=true;k({markAsRead:true,replaceMarkup:false})}},2500);if(d.length<1&&!m){m=true;k()}}else c.profileArea.removeClass("active")}};a.Profile=new function(){var d=0,f=0,e=false,c=this;this._cacheElements=function(){this.$profileIconsList=b(".profile-stats .profile-icons li");this.$profileDetailsList=b("#profile-details-container .items").children();this.$userFollowButton=b(".followUserButton");this.$reputationCounter=this.$profileIconsList.find(".reputation");this.$kudosCounter=this.$profileIconsList.find(".kudos");this.$awardsCounter=this.$profileIconsList.find(".awards");this.$followersCounter=this.$profileIconsList.find(".followers");this.$followingCounter=this.$profileIconsList.find(".following");this.$sendNewMessageButton=b(".sendNewMessageButton");this.$showReplyEditorButton=b("#showReplyEditorButton");this.$replyEditorContainer=b(".message-reply-editor-container");this.$replyEditor=b("#messageReplyEditor");if(this.User.UserID==a.loggedInUser.UserID||a.loggedInUser.IsStaff){this.$changeProfileImageLink=b(".profile-image a");this.$roughDraftsContainer=b("#roughDraftsContainer");this.$viewRoughDraftsButton=b("#viewRoughDrafts")}c.$kudosCounter.text(a.GetKiloFormat(c.$kudosCounter.text()))};this._setupHandlers=function(){this.scrollAPI=b("#profile-details-container").scrollable({circular:false,speed:150,initialIndex:d,next:".nonexistantclassthatshouldneverexist",prev:".nonexistantclassthatshouldneverexist"}).data("scrollable");this.$profileIconsList.hover(function(){a.Profile.scrollAPI.seekTo(b(this).index(),100);e=true},function(){e=false;window.clearTimeout(f);f=setTimeout(function(){!e&&a.Profile.scrollAPI.seekTo(d)},1e3)});this.$userFollowButton.hover(a.User.OnFollowButonHover);this.$userFollowButton.click(a.User.OnFollowUserClick);location.hash.indexOf("reply")>-1&&c.$replyEditor.focus();this.$sendNewMessageButton.click(function(b){b.preventDefault();a.clearRedirect();if(!a.loggedInUser.IsUser){a.ShowLoginScreen("Login to send a message to "+a.Profile.User.DisplayName+":");return}a.createAjaxDialog({URL:a.BuildAJAXUrl("getsendnewmessageform?FromUserID="+a.loggedInUser.UserID+"&ToUserID="+a.Profile.User.UserID),Title:"Send New Message",Width:500,ContainerID:"sendNewMessageDialogContainer"})});b("#content-container").on("click",".deleteMessageButton",function(){a.Profile.DeleteMessageHandler(this)});this.$showReplyEditorButton.click(function(){a.Profile.ToggleReplyEditor()});if(this.User.UserID==a.loggedInUser.UserID||a.loggedInUser.IsStaff){this.$changeProfileImageLink.click(function(c){c.preventDefault();a.Images.CreatePreviewImageUploader({imagePreviewUploadOptions:{uploadType:"ProfileImage",isUploadToIDOptional:false,uploadToID:a.Profile.User.UserID},uploadifyOptions:{onResponse:function(){}},ajaxDialogOptions:{Title:"Upload Profile Image"},cropOptions:{enabled:true,onResponse:function(c,d){if(c.Error!=null){b("#"+d).dialog("close");a.Alerts.DisplayErrorNotification(c.Error.ErrorText);return}else{var e=c.Response.Value;b(".profile-image a img").attr("src",e.ImageUrlProfile);b("img.user-profile-icon").attr("src",e.ImageUrlSmall);b("#"+d).dialog("close")}},aspectRatio:3/4,minSize:[135,180]}})});this.$viewRoughDraftsButton.click(function(){var d=b(this),e=d.text().trim()=="View";if(!c.$viewRoughDraftsButtonContainer)c.$viewRoughDraftsButtonContainer=d.parent();if(e){c.$roughDraftsContainer.slideDown(500,"easeInQuad");c.$viewRoughDraftsButtonContainer.animate({"background-color":"#7AB6F1"});d.removeClass("red").addClass("blue").text("Hide")}else{c.$roughDraftsContainer.hide();c.$viewRoughDraftsButtonContainer.animate({"background-color":"#F3E178"});d.removeClass("blue").addClass("red").text("View");b(window).scrollTop()>a.Profile.$viewRoughDraftsButtonContainer.offset().top&&b("#content-container").scrollTo()}})}};this.DeleteMessageHandler=function(g){var d=b(g),c=d.data("action"),f=d.data("messageid"),e=d.data("conversationid");if(c=="deleteConversation"&&!confirm("Are you sure you want to delete this conversation?"))return;a.Messages.DeleteMessage({userID:a.Profile.User.UserID,messageID:c=="deleteMessage"?f:0,conversationID:c=="deleteConversation"?e:0,onResponse:function(e){if(e.Error!=null)b.jGrowl(e.Error.ErrorText,{life:6e3});else{var f=b(".conversation-container");if(c=="deleteMessage"||f.length<1)a.DeleteAnimation(d.parents(".message-container:first"));else f.animate({backgroundColor:"#fb6c6c"},400,function(){b(this).slideUp(500,function(){b(this).remove();a.NavigateTo(e.Response.Value.InboxUrl)})})}}})};this.ToggleReplyEditor=function(b){var c=a.Profile.$replyEditorContainer.is(":visible");if(typeof b!="undefined"&&b!=null)c=!b;if(c){a.Profile.$replyEditor.text("");a.Profile.$replyEditorContainer.slideUp("slow");a.Profile.$showReplyEditorButton.show()}else{a.Profile.$replyEditorContainer.slideDown("slow");a.Profile.$showReplyEditorButton.hide()}};this.init=function(c){b.extend(this,c);this._cacheElements();d=c.DefaultTab||0;a.Profile.$profileIconsList.eq(d).addClass("active");this._setupHandlers()}};a.SettingsMenu=function(j,i){var c=b.extend({settingsButtonClass:".settings-button",settingsMenuClass:".settings-menu",items:"ul li a",activeClass:"active",stickyActive:false},i||{}),d=b(j),g=this,k=b(c.settingsButtonClass,d),h=b(c.settingsMenuClass,d),e=b(c.items,h),f={};if(!e||e.length<1)e=d.find(c.items);this.init=function(){if(!a.User.HasGuideFlag(a.Enums.GuideType.FirstWorldAdmin)&&a.currentWorld!=null&&a.currentWorld.IsRequestingUserModerator&&e.length>0){var h=false;e.each(function(){if(b(this).text()=="World Settings"){h=c.stickyActive=true;return false}});if(h)f=d.guideable({guideType:a.Enums.GuideType.FirstWorldAdmin,direction:a.Enums.GuideDirections.Right,wrapRoot:false,mainHeadline:"Settings menus help you manage your World.",secondaryHeadline:"",guideMessage:"Look for gears in the corners of your World and its content for admin features.",buttons:[{message:"Got it!",mainButton:true}]})}g.SetupEventHandlers()};this.ToggleElement=function(d,e){var g=typeof e!="undefined"?e:!d.hasClass(c.activeClass);if(!b.isEmptyObject(f)&&!f.UserHasGuideFlag())if(b(".guide-flyout-container:visible").length<1)if(a.Article.ArticleID){a.Article.HandleWindowResize();a.Article.HandleWindowScroll()}if(g)d.addClass(c.activeClass);else!c.stickyActive&&d.removeClass(c.activeClass)};this.SetupEventHandlers=function(){d.parent().hover(function(){g.ToggleElement(d,true)},function(){g.ToggleElement(d,false)});e.click(function(i){var d=b(this),c=d.data(),e=c.settingsAdditionaldata||{},g=eval("("+(c.settingsOnresponse||"function () {}")+")"),h=eval("("+(c.settingsOnsuccess||"function () {}")+")");if(!c.settingsCustomhtml)i.preventDefault();else return;if(c.settingsConfirm||false)if(!confirm(c.settingsConfirmMessage||"Are you sure you want to do this?"))return;if(!c.settingsFormoptions||false)b.post(d.attr("href"),e,function(b){if(c.settingsDisplaynotificationonerror||false)b.Error!=null&&a.Alerts.DisplayErrorNotification(b.Error);b.Error==null&&h(b);g(b)});else{var f=b.extend({},{Title:d.text(),URL:d.attr("href"),AdditionalData:e},c.settingsFormoptions||{});a.createAjaxDialog(f)}})}};b.fn.settingsMenu=function(c){return this.each(function(){var d=b(this);if(d.data("settingsMenu"))return d.data("settingsMenu");var e=new a.SettingsMenu(d,c);d.data("settingsMenu",e);e.init()})};a.Social=new function(){this.FacebookShare=function(c){var a="http://www.facebook.com/sharer.php?";a+="u="+encodeURIComponent(c.URL);var b=window.open(a,"","width=800,height=400");b.focus()};this.TwitterShare=function(c){var a="http://twitter.com/share?";a+="url="+encodeURIComponent(c.URL);var b=window.open(a,"","width=800,height=400");b.focus()};this.GetFacebookInfo=function(e,d){var c="http://api.ak.facebook.com/restserver.php?v=1.0&method=links.getStats&urls={0}&format=json&callback=?",a={url:"",normalized_url:"",share_count:0,like_count:0,comment_count:0,total_count:0,click_count:0,comments_fbid:null,commentsbox_count:0};c=b.format(c,encodeURIComponent(e.URL));return b.getJSON(c).success(function(c){a=b.extend(a,c[0]);d(a)})};this.GetTwitterInfo=function(e,d){var c="http://urls.api.twitter.com/1/urls/count.json?url={0}&callback=?",a={count:0,url:""};c=b.format(c,encodeURIComponent(e.URL));return b.getJSON(c,function(c){a=b.extend(a,c);d(a)})}};a.User=new function(){var c=this;this.FollowUser=function(c){var d={userID:0,followUserID:0,isDelete:false,onResponse:function(){}};c=b.extend({},d,c);a.ToggleProgressCursor(true);b.post(a.BuildAJAXUrl("addupdatesocialconnection"),{FollowUserID:c.followUserID,IsDelete:c.isDelete,UserID:c.userID},function(b){a.ToggleProgressCursor(false);c.onResponse(b)})};this.GetGuideFlag=function(){return b.getCookie("GuideFlag")||a.Enums.GuideType.None};this.HasGuideFlag=function(b){if(typeof b=="undefined"||b==null)b=a.Enums.GuideType.None;return!b?false:c.GetGuideFlag()&b?true:false};this.OnFollowButonHover=function(h){var a=b(this),c=a.data("is-following"),g=h.type=="mouseenter";if(typeof c=="undefined"||c==null)c=false;!a.data("text-default")&&a.data("text-default",a.text());if(!a.data("button-color-default")){var d="blue";if(a.hasClass("silver"))d="silver";else if(a.hasClass("gray"))d="gray";a.data("button-color-default",d)}var f=a.data("text-default"),e=a.data("button-color-default");if(g&&c){a.width(a.width());a.removeClass("blue silver gray").addClass("red").text("Unfollow")}else{a.width("auto");a.removeClass("red").addClass(e).text(f)}};this.OnFollowUserClick=function(f){f.preventDefault();var d=b(this),c=d.data("is-following"),e=d.data("userid");if(typeof c=="undefined"||c==null)c=false;if(!a.loggedInUser.IsUser){a.ShowLoginScreen("Login to follow this user:");a.AddDoAfterLoginCallback(function(){d.click()});return false}d.data("is-following",!c);d.data("text-default","Follow"+(c?"":"ing"));d.removeClass("red");a.User.FollowUser({userID:a.loggedInUser.UserID,followUserID:e,isDelete:c})}};a.World=new function(){var d=this;this.init=function(){this._cacheElements();this._setupHandlers()};this._setupHandlers=function(){var c=b("#main-wrapper .world-header");c.on("click",".btn",d.JoinLeaveWorldButtonHandler);c.on("hover",".btn",d.WorldButtonHoverHandler);if(a.currentWorld.IsRequestingUserModerator||a.loggedInUser.IsStaff){b("#categories-list-container").on("click",".topics-mode-switcher .btn",d.TopicsModeSwitcherHandler);b(".add-new-topic-container").settingsMenu({items:".add-new-topic"})}};this._cacheElements=function(){};this.TopicsModeSwitcherHandler=function(){var c=b(this),d=c.hasClass("image-grid"),e=c.data("subcategory-type")=="Inspiration";b.post("/Ajax/UpdateWorldSubcategoryMode",{WorldUrlName:a.currentWorld.UrlName,WorldSubcategoryType:e?a.Enums.WorldSubCategoryType.Inspiration:a.Enums.WorldSubCategoryType.HowTo,WorldSubCategoryMode:d?a.Enums.WorldSubCategoryMode.ImageGrid:a.Enums.WorldSubCategoryMode.TextList},function(){a.NavigateTo(location)})};this.updateWorldMemberStatus=function(c){c=b.extend({},{Action:"Join",WorldURLName:(c.World||{UrlName:a.currentWorld.UrlName}).UrlName,UpdateButtonText:true,User:a.loggedInUser,UserID:(c.User||a.loggedInUser).UserID},c);if(!a.loggedInUser.IsUser){a.ShowLoginScreen("Login to follow this world:");a.AddDoAfterLoginCallback(function(){a.World.updateWorldMemberStatus(c)});return}return b.post(a.BuildAJAXUrl("updateworldmembership"),{Action:c.Action,WorldURL:c.WorldURLName,UserID:c.UserID},function(){})};this.userJoinCurrentWorld=function(){a.World.updateWorldMemberStatus({Action:"Join",World:a.currentWorld,User:a.loggedInUser})};this.userLeaveCurrentWorld=function(){a.World.updateWorldMemberStatus({Action:"Leave",World:a.currentWorld,User:a.loggedInUser})};this.WorldButtonHoverHandler=function(c){if(b(c.target).hasClass("leave-world-btn")||b(c.target).hasClass("join-world-btn"))c.preventDefault();else return;var a=b(this),e=a.hasClass("join-world-btn"),h=c.type=="mouseenter";!a.data("text-default")&&a.data("text-default",a.text());if(!a.data("button-color-default")){var d="blue";if(a.hasClass("silver"))d="silver";else if(a.hasClass("gray"))d="gray";a.data("button-color-default",d)}var g=a.data("text-default"),f=a.data("button-color-default");if(h&&!e){a.width(a.width());a.removeClass("blue silver gray").addClass("red").text("Unfollow")}else{a.width("auto");a.removeClass("red").addClass(f).text(g)}};this.JoinLeaveWorldButtonHandler=function(f){if(b(f.target).hasClass("join-world-btn")||b(f.target).hasClass("leave-world-btn"))f.preventDefault();else return;var d=b(this),g=d.hasClass("join-world-btn"),e={UrlName:d.data("world-urlname"),WorldName:d.data("world-name")};b.when(a.World.updateWorldMemberStatus({Action:g?"Join":"Leave",World:e})).done(function(f){if(f&&f.Response&&f.Response.Value)if(g){d.removeClass("join-world-btn red").addClass("leave-world-btn").text("Following").data("text-default","Following");var j=e.UrlName+a.urlBase.substring(a.urlBase.indexOf(".")),i='<li class="fl"><a href="{0}" class="fl txt-lbl upcase">{1}</a></li>',h=b(b.format(i,j,e.WorldName)).hide();c.worldsList.prepend(h);h.fadeIn("slow")}else{d.removeClass("leave-world-btn").addClass("join-world-btn").text("Follow").data("text-default","Follow");c.worldsList.children().each(function(){var a=b(this);a.text()==e.WorldName&&a.fadeOut("slow",function(){a.remove()})})}})}};a.WorldLinks=new function(){var c=this,d=[],k="<div id='worldLinkItem{0}' data-id='{0}' class='item-container clearfix mgt-small mgl-smaller'><div class='fl clearfix mgt-small' style='width: 40px;'><div class='up move-link-btn btn arrow fl'  data-id='{0}'></div><div class='down move-link-btn btn arrow fr mgr-small' data-id='{0}'></div></div><div class='mgr-small fl'><input type='text' name='[{1}].Name' maxlength='50' size='25' value='{2}' placeholder='click to name your new link' data-val-required='Link Name is required.' data-val='true' class='valid isnew'/></div><div class='fl'><input type='text' name='[{1}].Link' maxlength='512' size='42' value='{3}'  placeholder='click to add a new link url' data-val-required='Link URL is required.' data-val='true' data-val-url='Invalid URL format.'  class='valid isnew'/></div><div class='ui-dialog-titlebar-close ui-corner-all fr mgr btn delete-link-btn' data-id='{0}'><span class='ui-icon ui-icon-closethick'>Delete</span></div></div>",i={},h=0,e={},g={},j={},f;this.init=function(d){d=b.extend({},{Links:{}},d);c._cacheElements();c._setupHandlers();if(d.Links)for(var f in d.Links)c.AddNewLink(d.Links[f]);c.AddNewLink();b("<div class='editor-field txt-center mgt'><input type='submit' class='btn blue med rnd' value='Save Changes' name='updateWorldLinks' id='updateWorldLinksButton'></div>").appendTo(b(".container form",e));b(function(){j=g.validate({onkeyup:false,onblur:false,ignore:".isnew"});a.OnElementReady(e)})};this._cacheElements=function(){e=b("#editWorldLinkContainer");g=b("form",e)};this._setupHandlers=function(){e.on("click",".move-link-btn",c.MoveLinkHandler);e.on("click",".delete-link-btn",c.DeleteLinkHandler);e.on("click","input[type='submit']",c.SaveChangesHandler);e.on("keyup","input[type='text']",c.LinkInputKeyUpHandler)};this.AddNewLink=function(a){var g={ID:-1,Name:"",SortOrder:d.length,Link:"",IsNew:false,Deleted:false};if(a==null||typeof a=="undefined"){g.IsNew=true;h++}a=b.extend({},g,a);if(c.GetElementByID(a.ID).length<1)c.CreateEditLinkElement(a);else if(typeof a.element=="undefined"||a.element==null)if(a.IsNew){for(var f=-1,e=0;e<d.length;e++)if(d[e].ID<=f)f=d[e].ID-1;a.ID=f;c.CreateEditLinkElement(a)}else a.element=c.GetElementByID(a.ID);d.push(a)};this.SetLinkOrder=function(a,b){a.element.find("input[name='["+a.SortOrder+"].Name']").attr("name","["+b+"].Name");a.element.find("input[name='["+a.SortOrder+"].Link']").attr("name","["+b+"].Link");a.SortOrder=b};this.GetElementByID=function(b){var a=c.GetLinkItemByID(b);return a?a.element:e.find("#worldLinkItem"+b)};this.GetLinkItemByID=function(c){for(var a=0;a<d.length;a++){var b=d[a];if(b.ID==c)return b}};this.CreateEditLinkElement=function(a){var d=b.format(k,a.ID,a.SortOrder,a.Name,a.Link),c=b("#updateWorldLinksButton",e);if(c.length>0&&!f)f=c;if(f&&f.length>0)a.element=b(d).insertBefore(f);else a.element=b(d).appendTo(b(".container form",e))};this.ClearEmptyLinks=function(){for(var b=0,a=d.length-1;a>=0;a--){var e=d[a];if(c.IsLinkEmpty(e))b++;b>1&&c.RemoveLinkElement(e)}};this.IsLinkEmpty=function(c,f){var g=c.element.inputs=c.element.inputs||c.element.find("input"),a=true;checkAll=f||false;var d=0,e=0;g.each(function(){e++;var c=b(this).val();if(c!=null&&c.length>0){a=false;d++}});if(checkAll&&d!=e)a=true;return a};this.RemoveLinkElement=function(a){if(a.IsNew&&c.IsLinkEmpty(a)&&h>1){a.element.remove();h--;d.splice(d.indexOf(a),1)}};this.LinkInputKeyUpHandler=function(){window.clearTimeout(i);i=window.setTimeout(function(){c.AddNewLink();c.ClearEmptyLinks()},500)};this.DeleteLinkHandler=function(){var e=b(this),f=e.data("id"),a=c.GetLinkItemByID(f),d=a.Deleted;if(a.ID<0&&c.IsLinkEmpty(a))return;if(d){a.element.removeClass("deleted");a.Deleted=false}else{a.element.addClass("deleted");a.Deleted=true}};this.MoveLinkHandler=function(){for(var i=0,a=0,j=b(this),k=j.data("id"),f=c.GetLinkItemByID(k),g=j.hasClass("up"),h=0;h<d.length;h++)if(d[h].ID==k){a=i=h;break}a+=g?-1:1;if(a<0)a=0;if(a>=d.length-1)a=d.length-1;if(a==i)return;var e=d[a];if(e.IsNew||f.IsNew)return;d[a]=f;d[i]=e;e.element.animate({top:(g?26:-26)+"px"},400);f.element.animate({top:(g?-26:26)+"px"},400,function(){f.element.css({top:"0px"});e.element.css({top:"0px"});if(g)f.element.insertBefore(e.element);else f.element.insertAfter(e.element)});c.SetLinkOrder(e,e.SortOrder+(g?1:-1));c.SetLinkOrder(f,f.SortOrder+(g?-1:1))};this.SaveChangesHandler=function(m){m.preventDefault();var h=b(this),k=h.hasClass("disabled");if(k)return;g.find(".input-validation-error").removeClass("input-validation-error");if(!g.data("unobtrusiveValidation").validate())return;h.addClass("disabled");for(var j=[],i=0;i<d.length;i++){var f=d[i];if(!f.IsNew||f.IsNew&&!c.IsLinkEmpty(f,true)&&!f.Deleted){var l={ID:f.ID,Name:f.element.find("input[name='["+f.SortOrder+"].Name']").val(),SortOrder:i+1,Link:f.element.find("input[name='["+f.SortOrder+"].Link']").val(),Delete:f.Deleted};j.push(l)}}b.ajaxSettings.traditional=true;b.post("/Ajax/UpdateWorldLinksPost","LinksString="+JSON.stringify(j)).error(function(a){h.removeClass("disabled");e.find(".validation-summary-errors ul").html("<li>Could not save changes because: <br/>"+a+"</li>")}).success(function(b){if(b.Error!=null){h.removeClass("disabled");e.find(".validation-summary-errors ul").html("<li>Could not save changes because: <br/>"+b.Error.ErrorText+"</li>")}else{a.Alerts.QueueAlert("Links were successfully updated!");a.NavigateTo(location)}})}};a.Shims=new function(){b.fn.placeholder=function(a){a=b.extend(a,{color:"#AAA",cls:"placeholder",lr_padding:4,selector:"input[placeholder], textarea[placeholder]"});function c(f){var c=b(f),d=c.offsetParent().offset(),e=c.offset();return{top:e.top-d.top+(c.outerHeight()-c.height())/2,left:e.left-d.left+a.lr_padding,width:c.width()-a.lr_padding}}return Modernizr.input.placeholder?this:this.each(function(){var d=b(this);if(d.data("placeholder")){var g=d.data("placeholder");g.css(c(d));return true}var f={};if(!d.is("textarea")&&d.css("height")!="auto")f={lineHeight:d.css("height"),whiteSpace:"nowrap"};var e=b("<label />").text(d.attr("placeholder")).addClass(a.cls).css(b.extend({position:"absolute",display:"inline","float":"none",overflow:"hidden",textAlign:"left",color:a.color,cursor:"text",paddingTop:d.css("padding-top"),paddingLeft:d.css("padding-left"),fontSize:d.css("font-size"),fontFamily:d.css("font-family"),fontStyle:d.css("font-style"),fontWeight:d.css("font-weight"),textTransform:d.css("text-transform"),zIndex:99},f)).css(c(this)).attr("for",this.id).data("target",d).click(function(){b(this).data("target").focus()}).insertBefore(this);d.data("placeholder",e).focus(function(){e.hide()}).blur(function(){e[d.val().length?"hide":"show"]()}).triggerHandler("blur");b(window).resize(function(){var a=e.data("target");e.css(c(a))})})}}})(window.WHT=window.WHT||{},jQuery);(function(a,b){var h=900,g="post",c="comment",f=10,d=20,e=30;a.WHTPostEditor=function(t,F){var i={mode:g,postType:null,editDoc:null,postTo:"SubmitPost",previewAt:"PreviewPost",defaultHowToHeadlineText:"How to ",defaultHowToHeadlineHtml:'How to <span class="txt-clr-lighter">Type Your Headline (Be Specific)</span>',defaultInspHeadlineText:"",defaultInspHeadlineHtml:'<span class="txt-clr-lighter">Type Your Headline (Be Specific)</span>',defaultForumHeadlineText:"",defaultForumHeadlineHtml:'<span class="txt-clr-lighter">Ask a Question or Start a Discussion</span>',defaultHowToFirstParagraphText:"",defaultHowToFirstParagraphHtml:'<span class="txt-clr-lighter">First, introduce this how-to and who it\'s for. Try to describe the problem your viewer is facing and what they\'ll learn from this tutorial.<br/><br/>Then add "Step 1" of your tutorial, embed a how-to video, or link to a how-to on the web using the attachment buttons below.<br/>&nbsp;<br/>&nbsp;</span>',defaultInspFirstParagraphText:"",defaultInspFirstParagraphHtml:'<span class="txt-clr-lighter">Start with an introduction paragraph describing what\'s interesting about this post.<br/><br/>Then attach images, embed videos, or link to something inspiring using the attachment buttons below.<br/>&nbsp;<br/>&nbsp;</span>',defaultForumFirstParagraphText:"",defaultForumFirstParagraphHtml:'<span class="txt-clr-lighter">Start by providing some background on your question, or discussion.<br/><br/>You can attach images, embed videos, or link to something on the web by using the attachment buttons below.<br/>&nbsp;<br/>&nbsp;</span>'};F&&b.extend(i,F);var h=this,w=false,D=false,J=J++,C=0,y=1,k=b(t),s=k.find(".share-type-select"),z=k.find(".sharePrompt"),L=k.find(".commentPrompt"),l=k.find(".editorBlocks"),B=k.find(".attachMenu"),v=b('<div class="attachMenuContainer fixed"></div>').appendTo(z).append(B.clone()).hide(),H=k.find(".actionButtons"),K=H.clone().addClass("clearfix rnd-bottom").appendTo(v),M=B.find(".attachBtn"),x=k.find(".share-widget-tips"),I=b("#sidebar").length>0?parseInt(b("#sidebar").css("margin-top").replace("px","")):0,n=[],j=null,m={},u=[],E=[],A=[],r=[],q=k.find(".cover-image-selector"),G=q.find(".items").html(),p=q.find(".slider").scrollable({prev:".previous",clickSpeed:50,itemCount:1,onSeek:function(e,f){if(w){var d=e.currentTarget,a=b(d.getItems().get(f)),c=a&&a.length>0?a.attr("data-image-id"):"0";if(c!="0"&&c!=o)o=c}}}).data("scrollable"),o="0";v.append('<div class="filler"></div>');h.divEditorBlocks=l;this.init=function(){s.find(".share-type-howto").on({"click.whtPostEditor":h.onShareHowToClick});s.find(".share-type-inspiration").on({"click.whtPostEditor":h.onShareInspirationClick});s.find(".share-type-forum").on({"click.whtPostEditor":h.onShareForumClick});k.on("click.whtPostEditor",".share-submit",h.onSubmitClick);k.on("click.whtPostEditor",".share-cancel",h.onCancelClick);k.on("click.whtPostEditor",".share-save-draft",h.onSaveDraftClick);k.on("click.whtPostEditor",".share-preview",h.onPreviewClick);b(window).on({"keydown.whtPostEditor":h.onKeyDown});k.on("click.whtPostEditor",".attachBtn",h.onAttachClick);q.on("click.whtPostEditor",".uploadbtn",h.onUploadCoverImageClick);b(window).on("scroll.positionAttachMenu",h._positionMenusAndTip);b(window).on("resize.positionAttachMenu",h._positionMenusAndTip);i.editDoc!=null&&this._initEditor(i.editDoc);i.mode==c&&!i.editDoc&&this._initEditor();h.blinkCursors()};this.blinkCursors=function(){h.blinkInterval&&window.clearInterval(h.blinkInterval);var a=k.find("span.cursor.blinker").removeClass("blink");this.blinkInterval=setInterval(function(){a.toggleClass("blink")},500)};this.xml=function(f){if(arguments.length>0&&f!=null&&typeof f==="object"&&f.version!=null&&f.docParts!=null){var e=this.getLastBlock(),d=0;while(e!=null&&e.EB_TYPE!="EBWealthyHeadline"&&d++<1e4){this.deleteBlock(e,true);e=this.getLastBlock()}d>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():0)");var r=Number(f.version),k=f.docParts,p=this.getFirstBlock();if(p)this.setFocusedBlock(this.getFirstBlock());else j=null;for(var g=0;g<k.length;g++){var m=k[g];switch(m.type){case"textBlock":h.attachBlockWithDefaultOptions("EBWealthyParagraph",true);j.xml(m.htmlText);j.isLastBlock()&&(j.EB_TYPE==="EBWealthyHeadline"||j.EB_TYPE==="EBWealthySubHeadline"||j.EB_TYPE==="EBWealthySubHeadlineStep")&&h.attachBlockWithDefaultOptions("EBWealthyParagraph",true);break;case"gallery":h.attachBlockWithDefaultOptions("EBGallery",true);j.xml(m);g+1<=k.length&&(!k[g+1]||k[g+1].type!="textBlock")&&h.attachBlockWithDefaultOptions("EBWealthyParagraph",true);break;case"attachedLinkBlock":h.attachBlockWithDefaultOptions("EBLink",true);j.xml(m)}}d=0;this.setFocusedBlock(this.getFirstBlock());while(!j.isLastBlock()&&d++<1e4){e=j;this.setFocusedBlock(e.getNextBlock());if(j.isEmpty()){if(j.EB_TYPE=="EBWealthyParagraph"){var o=this.getNextBlock(j);if(e.EB_TYPE!="EBWealthyParagraph"&&(o==null||o.EB_TYPE!="EBWealthyParagraph"))continue}this.deleteBlock(j)}}d>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():1)");this.setFocusedBlock(this.getFirstBlock());setTimeout(function(){if(l.find("span.cursor").length>1){l.find("span.cursor").remove();j.setFocused(false);j=null;h.setFocusedBlock(h.getFirstBlock());try{h.setFocusedBlock(h.getNextBlock(j))}catch(b){}h.setFocusedBlock(h.getFirstBlock())}j.CAN_SET_SELECTION&&j.setSelection(a.EditorBlock.SELECT_START);setTimeout(function(){j.CAN_SET_SELECTION&&j.setSelection(a.EditorBlock.SELECT_END)},10);setTimeout(function(){h.updateStepNumbers()},15)},10)}var n='<DocX Version="2.0">',b=this.getFirstBlock();if(b!=null){if(i.mode!==c){var q=b.txtElement.val();b=this.getNextBlock(b)}d=0;while(b!=null&&d++<1e4){n+=b.xml();b=this.getNextBlock(b)}d>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():2)")}n+="</DocX>";return n};this.destroy=function(){k.off(".whtPostEditor");b(window).off(".positionAttachMenu");window.clearInterval(h.blinkInterval);var a=h.getLastBlock();while(a!=null)h.deleteBlock(a,true)};this.getRoot=function(){return k};this.getMatchedEmbedList=function(){return E};this.getLoadingEmbedList=function(){return r};this.getLoadedEmbedList=function(){return A};this.onShareHowToClick=function(a){a.stopPropagation();h._initEditor.apply(h,[f])};this.onShareInspirationClick=function(a){a.stopPropagation();h._initEditor.apply(h,[d])};this.onShareForumClick=function(a){a.stopPropagation();h._initEditor.apply(h,[e])};this.onUploadCoverImageClick=function(){a.Images.CreatePreviewImageUploader({imagePreviewUploadOptions:{uploadType:"GalleryImage",isUploadToIDOptional:true,uploadToID:null},cropOptions:{enabled:true,aspectRatio:300/140,minSize:[300,140],minSizeToCrop:[400,180],liveThumbnailSize:[150,70],onResponse:function(b,a){h.onUploadCoverImageResponse(b,a)}}})};this.onUploadCoverImageResponse=function(c,d){b("#"+d).dialog("close");if(c.Error!=null){a.Alerts.DisplayErrorNotification(c.Error.ErrorText);return}c=c.Response.Value;if(c.OriginalWidth<300||c.OriginalHeight<140){a.Alerts.DisplayErrorNotification("The image you selected was not big enough. It must be a minimum of 300x140.");return}var e=new a.ImgUrl(c.ImageID);u.push(e);o=c.ImageID;h._renderCoverImageSelector(h._getAvailableCoverImages(),c.ImageID)};this.onFocusPreviousBlock=function(a){h.setFocusedBlock(h.getPrevBlock(a.fromBlock))};this.onFocusThisBlock=function(a){h.setFocusedBlock(a.fromBlock)};this.onFocusNextBlock=function(a){h.setFocusedBlock(h.getNextBlock(a.fromBlock))};this.onFocusFollowingBlock=function(){};this.onDeleteBlock=function(a){h.deleteBlock(a.fromBlock)};this.onUpdateDefaultTip=function(a){h.__iIsShowingDefaultTipForBlockID==a.fromBlock.blockID&&h._showSidebarTip(a.fromBlock.defaultSidebarTip,true,true)};this.onSubmitClick=function(a){h.submitPost(a)};this.onSaveDraftClick=function(a){h.submitPost(a,true)};this.submitPost=function(n,m){if(h._isSubmitting)return;h._isSubmitting=true;a.ToggleProgressCursor(true);n.stopPropagation();var d="";try{var e=h.getLastBlock();e&&e.wte&&e.wte.cleanup();var j=h.xml(),f="",l=h.getFirstBlock();if(i.mode!==c)if(l==null)d="Your post is still empty";else{f=l.wte.getValue(true);if(f=="")d="Please add a headline"}if(j=='<DocX Version="2.0"></DocX>')d="Content can not be empty";if(d!=""){a.ToggleProgressCursor(false);a.Alerts.DisplayErrorNotification(d);h._isSubmitting=false;return}if(i.mode===g)b.post(a.BuildAJAXUrl(i.postTo),{ArticleID:i.editDoc&&i.editDoc.articleID?i.editDoc.articleID:0,RevisionID:i.editDoc&&i.editDoc.revisionID?i.editDoc.revisionID:0,CoverImageID:h._getCurrentlySelectedCoverImageID()||"0",SaveDraft:m===true,Headline:f,ArticleType:i.postType,XmlContent:j,WorldTopicID:k.data("world-topic-id")?k.data("world-topic-id"):0},function(c){if(c.Error==null&&c.Response.Value.Success)if(m===true){h._isSubmitting=false;a.ToggleProgressCursor(false);if(!i.editDoc)i.editDoc={};b.extend(true,i.editDoc,c.Response.Value);h._initButtonsFromEditDoc();a.Alerts.Show("Draft Saved")}else{window.onbeforeunload=null;a.NavigateTo(c.Response.Value.ArticleUrl)}else{h._isSubmitting=false;a.ToggleProgressCursor(false);a.Alerts.DisplayErrorNotification(c.Error.ErrorText)}}).error(function(){console.log("There was an error saving your post.");h._isSubmitting=false;a.ToggleProgressCursor(false)});else if(i.mode===c){a.Comments.SubmitComment({commentText:j,parentCommentID:t.find("#response").data("parentCommentID")||0,skipReply:false,isVideo:false,CommentID:i.editDoc&&i.editDoc.commentID?i.editDoc.commentID:0});h._resetEditor(true);h._isSubmitting=false;a.ToggleProgressCursor(false)}}catch(o){b.error("Exception When Trying to Submit!");console.log(o);h._isSubmitting=false;a.ToggleProgressCursor(false)}};this.onPreviewClick=function(j){var g=h.xml(),e="",d="";if(h._isSubmitting)return;h._isSubmitting=true;a.ToggleProgressCursor(true);j.stopPropagation();var f=h.getFirstBlock();if(i.mode!==c)if(f==null)d="Your post is still empty";else{e=f.wte.getValue(true);if(e=="")d="Please add a headline";else if(g=='<DocX Version="2.0"></DocX>')d="Your post is still empty"}if(d!=""){a.ToggleProgressCursor(false);alert(d);h._isSubmitting=false;return}b.post(a.BuildAJAXUrl(i.previewAt),{Headline:e,ArticleType:i.postType,CoverImageID:h._getCurrentlySelectedCoverImageID()||"0",XmlContent:g},function(c){h._isSubmitting=false;a.ToggleProgressCursor(false);if(c.Error==null&&c.Response.Value.Success)a.createAjaxDialog({URL:"/Ajax/PreviewArticle",Width:692,Height:b(window).height()-40,Title:"Preview Article",onOpen:function(){var a=b(this).css("background","#F8F8F8");a.on("click","a",function(a){a.preventDefault()});a.find(".settings-container,.follow-button").remove();b("body").addClass("dialogOpen")},beforeClose:function(){b("body").removeClass("dialogOpen");b(this).remove()}});else a.Alerts.DisplayErrorNotification(c.Error.ErrorText)}).error(function(){console.log("There was an error creating the preview.");h._isSubmitting=false;a.ToggleProgressCursor(false)})};this.onCancelClick=function(){var b=h._resetEditor.apply(h,[]);if(b)if(i.editDoc&&i.editDoc.cancelUrl&&i.editDoc.cancelUrl!=""){s.html("<h2>Cancelling Edits...</h2>");h._isSubmitting=true;a.ToggleProgressCursor(true);window.onbeforeunload=null;a.NavigateTo(i.editDoc.cancelUrl)}};this.onAttachClick=function(d){var c=b(d.target),a="";if(c.data("disableevent"))return;if(c.hasClass("attachLink"))a="EBLink";else if(c.hasClass("attachVideo"))a="EBGalleryVideo";else if(c.hasClass("attachImage"))a="EBGalleryImage";else if(c.hasClass("attachHeadline"))a="EBWealthySubHeadline";else if(c.hasClass("attachStep"))a="EBWealthySubHeadlineStep";else if(c.hasClass("attachCode"))a="EBCodeEditor";h.attachBlockWithDefaultOptions(a)};this.onWindowScroll=function(){};this.onMouseDown=function(){b(window).on({"mouseup.whtPostEditor":h.onMouseUp})};this.onMouseUp=function(){b(window).off("mouseup.whtPostEditor")};this._initEditor=function(e){a.clearRedirect();w&&this._resetEditor(true);window.onbeforeunload=function(){return"If you leave this page now, any unsaved changes will be lost!"};var d=typeof e==="object"?e:null;if(d)e=d.postType;i.postType=e;var f=this._getDefaultPlaceholderStrings(e);if(i.mode==g){b("#sidebar").length>0&&b("#sidebar").animate({marginTop:0});s.css("display","none");z.css("display","block");b(".share-widget").toggleClass("active",true);var k=h._attachEditorBlock("EBWealthyHeadline",{defaultText:f.headlineText,defaultHtml:f.headlineHtml,xml:d?d.headline:null,followWithBlockOptions:{defaultText:f.firstParagraphText,defaultHtml:f.firstParagraphHtml}});k.CAN_SET_SELECTION&&k.setSelection(a.EditorBlock.SELECT_END);if(d){h._initButtonsFromEditDoc();h.xml(d.docX)}o=d?d.coverImageID:"0";h._renderCoverImageSelector(h._getAvailableCoverImages(),o)}else if(i.mode==c){s.hide();z.show();t.parent().toggleClass("active",true);t.toggleClass("active",true);t.find("#response").hide();if(!d){var j=h._attachEditorBlock("EBWealthyParagraph",{defaultHtml:""});i.editDoc=null;h._showDefaultSidebarTip();window.setTimeout(function(){h.setFocusedBlock(j);j.CAN_SET_SELECTION&&j.setSelection(a.EditorBlock.SELECT_END)},0)}if(d){console.log("initting with object:",d);i.editDoc=d;h.xml(d)}}window.setTimeout(function(){h._positionMenusAndTip()},20);w=true};this._initLinkLoader=function(a){for(var c=0;c<r.length;c++)b.inArray(r[c],A)>-1&&r.remove(c);if(r.length<1){a.remove();return}a.animate({color:"#6CD49A"},{step:function(){l.find(".markDownURL").each(function(){d(b(this))})},duration:500,complete:function(){a.animate({color:"#056D33"},{duration:500,step:function(){l.find(".markDownURL").each(function(){d(b(this))})},complete:function(){h._initLinkLoader(a)}})}});function d(c){var d=b.trim(c.text());b.inArray(d,r)>-1&&c.css({color:a.css("color")})}};this._getAvailableCoverImages=function(){for(var d=[],i=h.getGalleryBlocks(),e=0;e<i.length;e++){var c=i[e];if(c.gal&&c.gal.settings&&c.gal.settings.galleryItems)for(var g=c.gal.settings.galleryItems,f=0;f<g.length;f++){var b=g[f];if(b.galleryItemType==="Image")b.oImgUrl&&d.push(b.oImgUrl);else if(b.galleryItemType==="Video")b.thumbSource&&d.push(new a.ImgUrl(b.thumbSource))}}return d};this._getCurrentlySelectedCoverImageID=function(){var c=i.editDoc&&i.editDoc.coverImageID?i.editDoc.coverImageID:"0",a=b(p.getItems()[p.getIndex()]);if(a&&a.length>0&&a.attr("data-image-id")){var d=a.attr("data-image-id");if(d!==c&&d!="0")c=d}return c};this._renderCoverImageSelector=function(d,e){if(i.mode==c)return;q.show();if(typeof d==="undefined"||d&&d.length<1)d=h._getAvailableCoverImages();if(typeof e==="undefined")e=o!=="0"?o:"0";e=e!=="0"?a.ImgUrl.toImgID(e):"0";if(u&&u.length>0)d=u.concat(d);if((!d||d.length<1)&&e!=="0"){var l=new a.ImgUrl(e);u=[l];d=[l]}if(d&&d.length>0){for(var m='<div class="item fl" data-image-id="{0}"><img width="80" height="35" src="{1}" /></div>',k="",g=-1,f=0;f<d.length;f++){var j=typeof d[f]==="object"&&d[f].imgID?d[f]:new a.ImgUrl(d[f]);k+=b.format(m,j.imgID,j.toString("300x140"));if(j.imgID===e)g=f}if(e&&e!=="0"&&g<0){var j=new a.ImgUrl(e);k=b.format(m,j.imgID,j.toString("300x140"))+k}p.replaceItems(k,g>-1?false:true);if(g>-1){p.getConf().initialIndex=g;p.seekTo(g,1)}}else p.seekTo(0)};this._positionMenusAndTip=function(){var d=x.find(".share-tip")||{},m=d.height()||0,a=h.getFocusedBlock(),k=a&&(a.displayElement||a.displayWrapper||a.baseElement)?(a.displayElement||a.displayWrapper||a.baseElement).offset().top:0,c=a&&a.getNextBlock()?a.getNextBlock():null,i=c&&(c.displayElement||c.displayWrapper||c.baseElement)?(c.displayElement||c.displayWrapper||c.baseElement).offset().top:0,f=B.offset().top,j=f+100,l=i===0?f:i,e=b(window).scrollTop(),g=e+b(window).height();if(e+42>k&&e+80<l)!d.hasClass("fixed")&&d.addClass("fixed");else d.hasClass("fixed")&&d.removeClass("fixed");if(g<j-11&&g-125>t.offset().top){if(v.is(":hidden")){v.show();q.addClass("fixed")}}else if(!v.is(":hidden")){v.hide();q.removeClass("fixed")}};this._initButtonsFromEditDoc=function(){if(i.editDoc.articleID&&i.editDoc.articleID!=0&&i.editDoc.articleID!=-1&&i.editDoc.isPublished){k.find(".share-submit").html("Publish Revisions");k.find(".share-save-draft").hide()}else{k.find(".share-submit").html("Submit");k.find(".share-save-draft").show()}};this._getDefaultPlaceholderStrings=function(a){return{headlineText:a==f?i.defaultHowToHeadlineText:a==d?i.defaultInspHeadlineText:a==e?i.defaultForumHeadlineText:null,headlineHtml:a==f?i.defaultHowToHeadlineHtml:a==d?i.defaultInspHeadlineHtml:a==e?i.defaultForumHeadlineHtml:null,firstParagraphText:a==f?i.defaultHowToFirstParagraphText:a==d?i.defaultInspFirstParagraphText:a==e?i.defaultForumFirstParagraphText:null,firstParagraphHtml:a==f?i.defaultHowToFirstParagraphHtml:a==d?i.defaultInspFirstParagraphHtml:a==e?i.defaultForumFirstParagraphHtml:null}};this._resetEditor=function(f){var k=h.xml(),d=h.getFirstBlock();if(d!=null&&d.wte){var j=d.wte.getValue(true);if(f!==true&&(k!='<DocX Version="2.0"></DocX>'||j!=""))if(!confirm("Are you sure? Your changes will be lost."))return false}i.postType=null;h._clearEditor();if(i.mode==g){var e=b("#sidebar");e.length>0&&e.animate({marginTop:I})}else if(i.mode==c){i.editDoc&&a.Comments.GetCommentContainer(i.editDoc.commentID).show();a.Comments.ResetCommentEditor();t.parent().removeClass("active")}r=[];E=[];A=[];w=false;window.onbeforeunload=null;return true};this._clearEditor=function(){h.__iIsShowingDefaultTipForBlockID=null;for(var c in m)if(m[c]!=null)try{clearTimeout(m[c]);m[c]=null}catch(e){}m={};x.empty();var a=this.getLastBlock(),d=0;while(a!=null&&d++<1e4){this.deleteBlock(a,true);a=this.getLastBlock()}d>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor._resetEditor():0)");j=null;C=0;y=1;b(".share-widget").toggleClass("active",false);u=[];o="0";p.replaceItems(G);q.hide();z.css("display","none");s.css("display","block")};this._showSidebarTip=function(a,c,f){if(a==null||a.sHeadline===""||a.sBodyTemplate==="")return;var e='<div class="share-tip rnd-big-top"><div class="share-tip-header rnd-big-top"><span class="ribbon"></span>{0}</div><div class="share-tip-body">{1}</div></div>',d=[typeof a.sHeadline==="function"?a.sHeadline():a.sHeadline,typeof a.sBodyTemplate==="function"?a.sBodyTemplate():a.sBodyTemplate];if(f===true||!this._hideSidebarTip(a,false,c)){var b=x.empty().html(e.replace(/\{(\d+)\}/g,function(b,a){return d[a]})).find(".share-tip").fadeIn("fast").css("margin-top",a.oForBlock.baseElement.position().top+6+"px");if(a.iHideAfterSeconds!=null&&a.iHideAfterSeconds>0)m["tip"+C]=setTimeout(function(){h._hideSidebarTip()},a.iHideAfterSeconds*1e3);b.data("tipID",C++);a.bindEvents&&a.bindEvents(b);h.__iIsShowingDefaultTipForBlockID=c==true?a.oForBlock.blockID:null;setTimeout(function(){h._positionMenusAndTip()},1)}};this._hideSidebarTip=function(c,d,e){var b=x.find(".share-tip");if(b.length>0){var a=b.data("tipID");if(m["tip"+a]!=null){clearTimeout(m["tip"+a]);m["tip"+a]=null;delete m["tip"+a]}h.__iIsShowingDefaultTipForBlockID=null;b.fadeOut("fast",function(){x.empty();if(c!=null)h._showSidebarTip(c,e);else!d&&h._showDefaultSidebarTip()});return true}else c==null&&!d&&h._showDefaultSidebarTip();return false};this._showDefaultSidebarTip=function(){if(h.__showDefaultTipTO!=null){clearTimeout(h.__showDefaultTipTO);h.__showDefaultTipTO=null}if(arguments.length==0){h.__showDefaultTipTO=setTimeout(function(){h._showDefaultSidebarTip(true)},50);return}var a=x.find(".share-tip").length>0;if(a&&h.__iIsShowingDefaultTipForBlockID==null)return;if(j!=null){if(a&&h.__iIsShowingDefaultTipForBlockID==j.blockID)return;if(j.defaultSidebarTip!=null)this._showSidebarTip(j.defaultSidebarTip,true,arguments.length>=2);else h.__iIsShowingDefaultTipForBlockID!=null&&this._hideSidebarTip(null,true)}};this.attachBlockWithDefaultOptions=function(o,c,m,e){var b={},d='<span class="txt-clr-lighter">Click to start a new paragraph...</span>',k='<span class="txt-clr-lighter">Click to start typing your detailed instructions for this step...</span>',n=j!=null&&j.CAN_BE_SPLIT&&w,f=n?a.EditorBlock.AM_SPLIT:null;switch(o){case"EBLink":if(j==null||j.onMenuButtonClick("EBLink",b))return h._attachEditorBlock("EBLink",b,null,c);break;case"EBGallery":b=typeof e==="object"?e:{initMode:"",followWithBlockOptions:{defaultText:"",defaultHtml:d}};if(j==null||j.onMenuButtonClick("EBGallery",b))return h._attachEditorBlock("EBGallery",b,f,c);break;case"EBGalleryVideo":b=typeof e==="object"?e:{initMode:"video",followWithBlockOptions:{defaultText:"",defaultHtml:d}};if(j==null||j.onMenuButtonClick("EBGallery",b))return h._attachEditorBlock("EBGallery",b,f,c);break;case"EBGalleryImage":b=typeof e==="object"?e:{initMode:"image",followWithBlockOptions:{defaultText:"",defaultHtml:d}};if(j==null||j.onMenuButtonClick("EBGallery",b))return h._attachEditorBlock("EBGallery",b,f,c);break;case"EBWealthySubHeadline":b={isStep:false,followWithBlockOptions:{defaultText:"",defaultHtml:d}};if(j==null||j.onMenuButtonClick("EBWealthySubHeadline",b)){var g=h._attachEditorBlock("EBWealthySubHeadline",b,f,c);g.setSelection(a.EditorBlock.SELECT_END);return g}break;case"EBWealthySubHeadlineStep":b={isStep:true,stepNum:y,followWithBlockOptions:{defaultText:"",defaultHtml:k}};if(j==null||j.onMenuButtonClick("EBWealthySubHeadline",b)){var g=h._attachEditorBlock("EBWealthySubHeadline",b,f,c);g.setSelection(a.EditorBlock.SELECT_END);return g}break;case"EBWealthyParagraph":if(j==null||j.EB_TYPE=="EBWealthyHeadline"){var l=this._getDefaultPlaceholderStrings(i.postType);b={defaultText:l.firstParagraphText,defaultHtml:l.firstParagraphHtml}}else if(j.EB_TYPE=="EBWealthySubHeadline"&&j.settings.isStep)b={defaultText:"",defaultHtml:k};else b={defaultText:"",defaultHtml:d};return h._attachEditorBlock("EBWealthyParagraph",b,null,c,m);case"EBCodeEditor":b={followWithBlockOptions:{defaultText:"",defaultHtml:d}};if(j==null||j.onMenuButtonClick("EBCodeEditor",b))return h._attachEditorBlock("EBCodeEditor",b,null,c)}return null};this._attachEditorBlock=function(f,e,g,k,i){if(a.EditorBlock.BlockTypes[f]==null){console.log("Invalid BlockType. Is a Plugin Missing? ["+f+"]");return null}n.push(new a.EditorBlock.BlockTypes[f](h,e));var b=n[n.length-1],c=j;if(e&&e.insertAfterBlock)c=e.insertAfterBlock;switch(g==null?b.ATTACHMENT_MODE:g){case a.EditorBlock.AM_SPLIT:if(c!=null&&c.CAN_BE_SPLIT&&b.CAN_SPLIT_BLOCKS)b.splittingOtherBlock(c)!==false&&c.split(b);case a.EditorBlock.AM_APPEND_NEXT:if(c!=null){if(b.EB_TYPE==c.EB_TYPE&&!c.CAN_HAVE_TWIN_NEIGHBOR&&!c.CAN_MERGE_WITH_TWIN){var d=c.getNextBlock();if(d!=null&&d.ATTACHMENT_MODE!=a.EditorBlock.AM_APPEND_BOTTOM){if(d.blockID==b.blockID||d.ATTACHMENT_MODE==a.EditorBlock.AM_APPEND_BOTTOM){d=h.attachBlockWithDefaultOptions("EBWealthyParagraph",true,true);if(d==null)d=c}d.baseElement.after(b.baseElement)}else c.baseElement.after(b.baseElement)}else c.baseElement.after(b.baseElement);break}case a.EditorBlock.AM_APPEND_BOTTOM:l.append(b.baseElement)}b.baseElement.on({"focusPreviousBlock.whtPostEditor":h.onFocusPreviousBlock,"focusNextBlock.whtPostEditor":h.onFocusNextBlock,"updateDefaultTip.whtPostEditor":h.onUpdateDefaultTip});if(i!==true){this.setFocusedBlock(b);if(k!==true&&b.FOLLOW_WITH_BLOCK_TYPE!=null&&b.FOLLOW_WITH_BLOCK_TYPE!=""&&a.EditorBlock.BlockTypes[b.FOLLOW_WITH_BLOCK_TYPE]!=null&&(b.isLastBlock()||b.getNextBlock().EB_TYPE!=b.FOLLOW_WITH_BLOCK_TYPE)){this._attachEditorBlock(b.FOLLOW_WITH_BLOCK_TYPE,b.settings.followWithBlockOptions,a.EditorBlock.AM_APPEND_NEXT,true,true);this.setFocusedBlock(b)}this.updateStepNumbers()}b.initDroppable();return b};this.setFocusedBlock=function(a){if(a==null)return;if(j!=null)if(j.blockID==a.blockID)return;else{var d=["EBWealthyParagraph","EBWealthyHeadline","EBWealthySubHeadline","EBCodeEditor"];if(~b.inArray(j.EB_TYPE,d)&&!~b.inArray(a.EB_TYPE,d)){var c=b('<textarea id="dummyTextArea'+a.blockID+'" style="width:1px;height:1px;position:fixed;left:50px;top:100px;"></textarea>').appendTo("body");c.focus();c.remove()}j.setFocused(false);h._showDefaultSidebarTip()}j=a;j.setFocused(true);h.updateStepNumbers()};this.getFocusedBlock=function(){return j};this.getBlockByBlockID=function(b){for(var a=0;a<n.length;a++)if(n[a].blockID==b)return n[a];return null};this.getFirstBlock=function(){var a=l.find(".editorBlock");return a.length>0?this.getBlockByBlockID(b(a[0]).data("blockID")):null};this.getPrevBlock=function(e){for(var d=l.find(".editorBlock"),c=null,a=0;a<d.length;a++){if(b(d[a]).data("blockID")==e.blockID)break;c=b(d[a]).data("blockID")}return c==null?null:this.getBlockByBlockID(c)};this.getNextBlock=function(e){for(var c=l.find(".editorBlock"),d=false,a=0;a<c.length;a++){if(d)return this.getBlockByBlockID(b(c[a]).data("blockID"));d=b(c[a]).data("blockID")==e.blockID}return null};this.getLastBlock=function(){var a=l.find(".editorBlock");return a.length>0?this.getBlockByBlockID(b(a[a.length-1]).data("blockID")):null};this.getGalleryBlocks=function(){for(var c=l.find(".editorBlock"),d=[],a=0;a<c.length;a++){var e=this.getBlockByBlockID(b(c[a]).data("blockID"));e.EB_TYPE=="EBGallery"&&d.push(e)}return d};this.isInited=function(){return w};this.isDragging=function(a){if(typeof a!=="undefined")D=!!a;return D};this.getSettings=function(){return i};this.deleteBlock=function(c,e){if(c==null)return;var b=this.getPrevBlock(c);if(e!==true&&(b==null||b.blockID==c.blockID))return;if(b!=null){this.setFocusedBlock(b);b.IS_TEXT&&b.setSelection(a.EditorBlock.SELECT_END)}for(var d=0;d<n.length;d++)if(n[d].blockID==c.blockID){n.splice(d,1);break}c.destroy();c=null;this.updateStepNumbers();this.mergeNeighboringBlock(b)};this.mergeNeighboringBlock=function(b){if(b!=null&&!b.CAN_HAVE_TWIN_NEIGHBOR){var c=b.IS_TEXT?b.getSelectionRange():null,d=c?c.end==0?b.wte.getValue().length+1:c.end+1:a.EditorBlock.SELECT_END,e=this.getNextBlock(b),f=b.merge(e);if(f)b.IS_TEXT&&b.setSelection(d)}};this.updateStepNumbers=function(g){for(var e=l.find(".editorBlock"),c=1,d=0;d<e.length;d++){var a=this.getBlockByBlockID(b(e[d]).data("blockID"));if(a.EB_TYPE=="EBWealthySubHeadline"&&a.settings.isStep==true){var f=a.wte.getValue().toLowerCase();if(c>2&&f.indexOf("step 1:")==0||f=="step 1")c=1;a.setStepNum(c++)}else if(a.EB_TYPE=="EBWealthyParagraph"&&a.minimumHeights!=null&&a.baseElement!=null&&!g){a.displayElement.css("min-height",String(a.minimumHeights[d==e.length-1?1:0])+"px");a.txtElement.height(a.displayElement.height())}if(j!=null&&a.blockID==j.blockID)y=c}if(j==null)y=c;k.find(".attachStep").html("+ Step "+String(y))}};b.fn.whtPostEditor=function(c){return this.each(function(){var d=b(this);if(d.data("whtPostEditor"))return d.data("whtPostEditor");var e=new a.WHTPostEditor(d,c);d.data("whtPostEditor",e);e.init()})}})(window.WHT=window.WHT||{},jQuery);(function(b,a){var c=90;b.WealthyTextEditor=function(n,u){this.settings={defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start typing...</span>',defaultCharIndex:0,multiLine:true,text:"",html:""};u&&a.extend(true,this.settings,u);var c=this,B=B++,t=/\[*(?:(?:https?|ftp|itpc):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])\]*/gi,o=/\b(?:(?:https?|ftp|itpc):\/\/|www\.|ftp\.)\S*(about\.com|youtube\.com|youtu\.be|metacafe\.com|vtutorial\.com|dailymotion\.com|revver\.com|howcast\.com|vimeo\.com(?!\.))\S*/gi,z=/^https?:\/\/(?:[a-z\-]+\.)+[a-z]{2,6}(?:\/[^\/#?]+)+\.(?:jpe?g|gif|png)$/i,s=/^(?:(?:https?|ftp|itpc):\/\/)?(?:[A-Z0-9](?:[-A-Z0-9.]*))(?:\.[a-z]{2,4}(?::[0-9]+)?)(?:(?:\/|\?|#)(?:(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$?!:,.])$|(?:\/|\?|#)$|$)/i,p=/^\/(?:(?:(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$?!:,.])$|(?:\/|\?|#)$|$)/i,w=/^(?:(?:https?|ftp|itpc):\/\/)/i,d=a(n).val(c.settings.defaultText),q=d.wrap('<div class="wteTextInnerWrap"/>').parent(".wteTextInnerWrap"),k=q.wrap('<div class="wteTextWrap"/>').parent(".wteTextWrap"),m=k.wrap('<div class="wteWrapper"/>').parent(".wteWrapper"),h=m.append('<div class="wteDispWrap"><div class="wteDispInnerWrap"><span class="wteDisplay">'+c.settings.defaultHtml+"</span></div></div>").find(".wteDisplay"),i=m.find(".wteDispWrap"),x=i.find(".wteDispInnerWrap"),e={},l=false,j=false,A=jQuery.browser.msie||jQuery.browser.opera||navigator.userAgent.match(/ip(ad|hone)/i)!=null;this.init=function(){a.each("padding-top,padding-bottom,font-family,font-size,font-weight,font-style,vertical-align,text-align,text-shadow,line-height,color,background".split(","),function(c,a){var b=d.css(a);k.css(a,b);i.css(a,b)});var e={"padding-top":d.css("padding-top"),"padding-bottom":d.css("padding-bottom"),"padding-left":d.css("padding-left"),"padding-right":d.css("padding-right")},b={"padding-left":0,"padding-right":0,"padding-top":0,"padding-bottom":0};i.css(e);k.css(e);d.css(b);h.css(b);jQuery.browser.mozilla&&i.css({"padding-left":"11px","padding-right":"11px"});m.css({position:"relative"});x.css({width:String(q.width()-(jQuery.browser.mozilla?2:0))+"px"});i.css({position:"absolute",top:0,left:0,"z-index":1});k.css({position:"relative","z-index":2,color:"transparent","background-color":"transparent","text-shadow":"none"});d.css({color:"transparent","background-color":"transparent","text-shadow":"none"}).height(h.height());d.on({"paste.wealthyTextArea":c.onTxtPaste,"mousedown.wealthyTextArea":c.onMouseDown,"focus.wealthyTextArea":c.onTxtFocus,"blur.wealthyTextArea":c.onTxtBlur,"keydown.wealthyTextArea":c.onTxtKeyDown,"keyup.wealthyTextArea":c.onTxtKeyUp,"change.wealthyTextArea":c.onTxtChange,"input.wealthyTextArea":c.onTxtInput});h.on({"mousedown.wealthyTextArea":c.onMouseDown});c.settings.defaultText&&c.selectEnd()};this.destroy=function(){d.unbind(".wealthyTextArea");h.unbind(".wealthyTextArea")};this.getSelectionRange=function(b){var a=d[0];return("selectionStart"in a&&function(){var b=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:b,text:a.value.substr(a.selectionStart,b),textBefore:a.value.substr(0,a.selectionStart),textAfter:a.value.substring(a.selectionStart+b),allText:a.value}}||document.selection&&function(f){if(f===true&&!a._isFocused&&e!=null)return{start:e.start,end:e.end,length:e.length,text:e.text,textBefore:e.textBefore,textAfter:e.textAfter,allText:e.allText};a.focus();var b=document.selection.createRange();if(b==null)return{start:0,end:a.value.length,length:0};var d=a.createTextRange(),c=d.duplicate();d.moveToBookmark(b.getBookmark());c.setEndPoint("EndToStart",d);return{start:c.text.length,end:c.text.length+b.text.length,length:b.text.length,text:b.text,textBefore:c.text,textAfter:a.value.substring(c.text.length+b.text.length),allText:a.value}}||function(){return{start:0,end:a.value.length,length:0}})(b);return r};this.setSelection=function(a,f,i){var e=d[0];c._bIgnoreFocusEvents=true;var j=e._isFocused;if(a==b.EditorBlock.SELECT_START)a=f=0;else if(a==b.EditorBlock.SELECT_END)a=f=e.value.length;else if(f==null)f=a;e.focus();if(e.setSelectionRange)e.setSelectionRange(a,f);else if(e.createTextRange){var h=e.value.replace(/\r\n/g,"\n");a-=h.slice(0,a).split("\n").length-1;f-=h.slice(0,f).split("\n").length-1;var g=e.createTextRange();g.collapse(true);g.moveEnd("character",f);g.moveStart("character",a);g.select()}c._bIgnoreFocusEvents=false;(j!=e._isFocused||i===true)&&this._onCursorChange("txtFocus",{},true)};this.selectStart=function(){this.setSelection(b.EditorBlock.SELECT_START)};this.selectEnd=function(){this.setSelection(b.EditorBlock.SELECT_END)};this.isSelectionAtStart=function(){return e.start==0};this.isSelectionAtEnd=function(){return e.end==d.val().length};this.getLastSelectionRange=function(){return e};this.getValue=function(a){return a!=null&&a&&d.val()==c.settings.defaultText?"":d.val()};this.setValue=function(f,a,b){d.val(f);if(a!=null)this.setSelection(a,b,true);else{h.html(c.toHtmlMirror(d.val(),e.end,l&&!j));d.height(h.height())}};this.onMouseDown=function(b){a(window).on({"mouseup.wealthyTextArea":c.onMouseUp});j=true;c._onCursorChange.apply(c,["mouseDown",b])};this.onMouseUp=function(b){a(window).off("mouseup.wealthyTextArea");j=false;setTimeout(function(){c._onCursorChange.apply(c,["mouseUp",b,true])},0)};this.onTxtFocus=function(a){this._isFocused=true;if(c._bIgnoreFocusEvents)return;c._onCursorChange.apply(c,["txtFocus",a,true])};this.onTxtBlur=function(a){this._isFocused=false;if(c._bIgnoreFocusEvents)return;c._onCursorChange.apply(c,["txtBlur",a,true])};this.onTxtKeyDown=function(a){c._onCursorChange.apply(c,["txtKeyDown",a])};this.onTxtKeyUp=function(a){c._onCursorChange.apply(c,["txtKeyUp",a])};this.onTxtPaste=function(a){window.setTimeout(function(){c._onCursorChange.apply(c,["txtPaste",a])},0)};this.onTxtChange=function(a){c._onCursorChange.apply(c,["txtChange",a])};this.onTxtInput=function(a){setTimeout(function(){c._onCursorChange.apply(c,["txtInput",a])},0)};this._onCursorChange=function(g,o,k){c._bIgnoreFocusEvents=true;if(k)if(g=="txtFocus"||g=="txtBlur")l=g=="txtFocus";var m=c.getSelectionRange(k===true&&l===false);if(c.compareChanges(m)||k){h.html(c.toHtmlMirror(d.val(),m.end,l&&!j));c._updateCursorSpanPos();d.height(h.height());e=m}c._bIgnoreFocusEvents=false;if(g==="txtPaste"){var n=function(i){var b=c.getSelectionRange(),g=b.allText,e=i||b.allText.substring(Math.max(b.start-2,0),b.start),h=Math.max(b.start-e.length,0),a=-1,f=0,d=[];do{a=g.indexOf(e,a+1);~a&&d.push({index:a});if(h===a)f=d.length-1}while(~a);return{textToMatch:e,textIndex:f,textPosition:h,instancesOfText:d,allText:g}},b=n();c.cleanup();var i=n(b.textToMatch),f=i.allText;if(i.instancesOfText.length>=b.instancesOfText.length){var a=Math.min(i.instancesOfText[b.textIndex].index+b.textToMatch.length,f.length);if(f[a]===" "&&f[a+1]==="]"&&f[a+2]!=="]")a++;c.setSelection(a)}}};this._updateCursorSpanPos=function(e){var d=h.find("span.cursor.placeholder");if(d.length==0)return;var i=d.offset(),f=a(window).height()-126;i.top>f+a(window).scrollTop()&&a(window).scrollTop(i.top-f);if(!A||e){var g=d.position(),b=h.find(".cursor.blinker");if(b.length<1)b=a('<span class="cursor blinker"></span>').appendTo(h);b[0].style.top=g.top+"px";b[0].style.left=g.left+"px"}d.remove();c.baseEditor&&e&&c.baseEditor.blinkCursors()};var f=function(b,a){try{return b.charAt(a+1)}catch(c){return""}},g=function(b,a){try{return b.charAt(a-1)}catch(c){return""}};this.toHtmlMirror=function(i,w,q){var D=jQuery.browser.msie?true:false;c._bIgnoreFocusEvents=true;var e="",m=i.length,I=m-1,o=false,u=false,k=false,x=false,t=false,E='<span class="sentenceWrap">';if(i==""||i==c.settings.defaultText){if(i!=c.settings.defaultText)if(!q||c.settings.defaultText=="")d.val(c.settings.defaultText);else{c._bIgnoreFocusEvents=false;return'<span class="cursor placeholder"></span>&nbsp;'}else if(q&&c.getSelectionRange(q===false).end!=d.val().length){c._bIgnoreFocusEvents=false;c.setSelection(b.EditorBlock.SELECT_END);return}c._bIgnoreFocusEvents=false;return q&&w>0&&w<=c.settings.defaultText.length?c.settings.defaultHtml.indexOf(c.settings.defaultText)>-1?c.settings.defaultHtml.replace(c.settings.defaultText,c.settings.defaultText+'<span class="cursor placeholder"></span>'):c.settings.defaultHtml.replace(">: ",'>: <span class="cursor placeholder"></span>'):q?'<span class="cursor placeholder"></span>'+c.settings.defaultHtml:c.settings.defaultHtml}for(var j=0;j<m;j++){var h=i.charAt(j),l=f(i,j),n=g(i,j);if(q&&j===w)e+=n==="\n"||n==="\r"?'<span class="cursor placeholder">&nbsp;</span>':'<span class="cursor placeholder"></span>';if(this.settings.multiLine){if(!t){t=true;e+=E}if(h==="&")e+="&amp;";else if(h==='"')e+="&quot;";else if(h==="'")e+="&#039;";else if(h==="<")e+="&lt;";else if(h===">")e+="&gt;";else if(h==="\n"||h==="\r"){if(h==="\r"&&l==="\n")j++;if(k){e+="</span>";k=false}var G=i.lastIndexOf("\n",j-1),B=Math.max(i.lastIndexOf("\n* ",j-1),i.lastIndexOf("\n- ",j-1),i.lastIndexOf("\n+ ",j-1));if(B>=G&&B>-1){if(o){e+="</strong>";o=false}if(u){e+="</em>";u=false}}if(t){if(n==="\n"&&l)e+='<span style="display:inline-block;"></span>';e+="</span>";t=false}e+="<br/>"}else if(h===" "){if(k&&x)e+="</span>";e+=l===" "||n==="\n"||n==="\r"?D?"&nbsp;<wbr />":"&nbsp;":D?" <wbr />":" ";if(k&&x){e+='<span class="markDownLinkText">';x=false}}else if(!k&&h==="*"){var v=l,A=n;if(v==="*"){e+="**";j++}else if((v===" "||v==""||v==="\n"||v==="\r")&&(A==="\n"||A==="\r"||A==""))e+='<span class="markDownReplace">*<span>&bull;</span></span>';else if(o){e+='<span class="markDown">*</span></strong>';o=!o}else{e+='<strong><span class="markDown">*</span>';o=!o}}else if(!k&&(h==="-"||h==="+")&&(l===" "||l==""||l==="\n"||l==="\r")&&(n==="\n"||n==="\r"||n==""))e+='<span class="markDownReplace">'+h+"<span>&bull;</span></span>";else if(!k&&h==="_")if(l==="_"){e+="__";j++}else{e+=u?'<span class="markDown">_</span></em>':'<em><span class="markDown">_</span>';u=!u}else if(h==="["||h==="]")if(!k&&l===h)e+=h+i.charAt(j++);else if(k&&h==="[")e+="[";else if(k&&h==="]"&&l==="]")e+="]";else{x=k=h==="[";if(k){var C=Math.min(i.indexOf(" ",j+1)>-1?i.indexOf(" ",j+1):999999999999999,i.indexOf("]",j+1)>-1?i.indexOf("]",j+1):999999999999999,i.indexOf("\n",j+1)>-1?i.indexOf("\n",j+1):999999999999999),r=i.substring(j+1,C),F=String(C>j+1&&(s.test(r)||p.test(r))?"markDownURL":"markDownURLInvalid"),y=c&&c.baseEditor?c.baseEditor.getMatchedEmbedList():[],z=c&&c.baseEditor?c.baseEditor.getLoadingEmbedList():[],H=c&&c.baseEditor?c.baseEditor.getLoadedEmbedList():[];if(y&&y.length>0&&~a.inArray(r,y)&&!~a.inArray(r,H)&&!~a.inArray(r,z)){!~a.inArray(r,z)&&z.push(r);window.setTimeout(function(){var b=c.baseEditor.getRoot().find(".linkDummyContainer");if(b.length<1){b=a('<div class="hide linkDummyContainer" style="width:0;height:0;display:none;color:#0C743A;"></div>').appendTo(c.baseEditor.getRoot());c.baseEditor._initLinkLoader(b)}},0)}e+='<span class="markDown">[</span><span class="'+F+'">'}else e+='</span><span class="markDown">]</span>'}else if(h==="—"&&l!=="—"&&a.browser.webkit)e+="—<wbr />";else if(t&&!k&&(h==="."||h==="!"||h==="?"||h===";"||j===m.length-1)){t=false;e+=h+"</span>"}else e+=h}else if(h==="&")e+="&amp;";else if(h==='"')e+="&quot;";else if(h==="'")e+="&#039;";else if(h==="<")e+="&lt;";else if(h===">")e+="&gt;";else e+=h}if(o)e+="</strong>";if(u)e+="</em>";if(q&&w==m)e+=g(i,m)=="\n"||g(i,m)=="\r"?'<span class="cursor placeholder">&nbsp;</span>':'<span class="cursor placeholder"></span>';if(i.charAt(m-1)=="\r"||i.charAt(m-1)=="\n"||i.charAt(m-1)==" "&&(i.charAt(m-2)=="\r"||i.charAt(m-2)=="\n"))e+="&nbsp;";c._bIgnoreFocusEvents=false;return e};this.html=function(){if(!this.settings.multiLine)return this.getValue().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");for(var c=a.trim(this.getValue()),d="<p>",r=c.length,A=r-1,l=false,o=false,i=false,n=false,e=false,h=false,k=false,b=0;b<r;b++)if(c.charAt(b)=="&")d+="&amp;";else if(c.charAt(b)=='"')d+="&quot;";else if(c.charAt(b)=="'")d+="&#039;";else if(c.charAt(b)=="<")d+="&lt;";else if(c.charAt(b)==">")d+="&gt;";else if(c.charAt(b)=="\n"||c.charAt(b)=="\r"){if(c.charAt(b)=="\r"&&f(c,b)=="\n")b++;if(i){d+="</a>";i=false}if(k){d+="</li>\n";k=false}else if(g(c,b)=="\n"&&(h||e)){if(h){d+="</ol><p>";h=false}else if(e){d+="</ul><p>";e=false}}else d+="<br/>"}else if(c.charAt(b)==" "&&(f(c,b)==" "||g(c,b)=="\n"||g(c,b)=="\r"))d+="";else if(!i&&c.charAt(b)=="*"){var m=f(c,b),v=g(c,b);if(m=="*"){d+="*";b++}else if((m==" "||m==""||m=="\n"||m=="\r")&&(v=="\n"||v=="\r"||v=="")){if(h){d+="</ol><ul>";h=false;e=true}else if(!e){d+="</p><ul>";e=true}d+="<li>";k=true;if(m==" ")b++}else if(l){d+="</strong>";l=!l}else{d+="<strong>";l=!l}}else if(!i&&(c.charAt(b)=="-"||c.charAt(b)=="+")&&(f(c,b)==" "||f(c,b)==""||f(c,b)=="\n"||f(c,b)=="\r")&&(g(c,b)=="\n"||g(c,b)=="\r"||g(c,b)=="")){if(h){d+="</ol><ul>";h=false;e=true}else if(!e){d+="</p><ul>";e=true}d+="<li>";k=true}else if(!i&&c.charAt(b)=="_")if(f(c,b)=="_"){d+="_";b++}else{d+=o?"</em>":"<em>";o=!o}else if(c.charAt(b)=="["||c.charAt(b)=="]")if(!i&&f(c,b)==c.charAt(b))d+=c.charAt(b++);else if(i&&c.charAt(b)=="[")d+="[";else if(i&&c.charAt(b)=="]"&&f(c,b)=="]")d+="]";else{i=c.charAt(b)=="[";if(i){var z=Math.min(c.indexOf(" ",b+1)>-1?c.indexOf(" ",b+1):999999999999999,c.indexOf("]",b+1)>-1?c.indexOf("]",b+1):999999999999999,c.indexOf("\n",b+1)>-1?c.indexOf("\n",b+1):999999999999999),j=c.substring(b+1,z),x=j.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#039;");if(s.test(j)){d+='<a href="'+String(w.test(j)?"":"http://")+j.replace(/&/g,"&amp;").replace(/"/g,"&quot;")+'">';b+=j.length;while(c.charAt(b+1)==" ")b++;n=true}else if(p.test(j)){d+='<a href="'+x+'">';b+=j.length;while(c.charAt(b+1)==" ")b++;n=true}else n=false}else if(n){var y=d.substring(d.lastIndexOf(">")+1);if(y.length===0||y===" ")d+=x;d+="</a>";n=false}}else if((g(c,b)=="\n"||g(c,b)=="")&&c.charAt(b).match(/[1-9]/)){var q=c.charAt(b++);while(b<r&&c.charAt(b).match(/[0-9]/))q+=c.charAt(b++);if(b<r&&c.charAt(b)=="."&&f(c,b)==" "){if(e){d+="</ul><ol>";e=false;h=true}else if(!h){if(q=="1")d+="</p><ol>";else d+='</p><ol start="'+q+'">';h=true}d+="<li>";k=true;b++}else{d+=q;b--}}else{if((e||h)&&!k)if(h){d+="</ol><p>";h=false}else if(e){d+="</ul><p>";e=false}d+=c.charAt(b)}if(l)d+="</strong>";if(o)d+="</em>";if(k)d+="</li>";if(h)d+="</ol>";else if(e)d+="</ul>";else d+="</p>";d=a.trim(HTMLtoXML(d.replace(/\&#039;/g,"'").replace(/\<br\/\>[\s]*<br\/\>/g,"</p><p>").replace(/<p>[\s]*<br\/>/g,"<p>").replace(/<br\/>[\s]*<\/p>/g,"</p>").replace(/<li>[\s]*<\/li>/g,"").replace(/<[uo]l(start="[0-9]+")?>[\s]*<\/[uo]l>/g,"").replace(/<p>[\s]*<\/p>/g,"").replace(/\s+/g," ")).replace(/\<br\/\>[\s]*<br\/\>/g,"</p><p>").replace(/<p>[\s]*<br\/>/g,"<p>").replace(/<br\/>[\s]*<\/p>/g,"</p>").replace(/<li>[\s]*<\/li>/g,"").replace(/<[uo]l(\sstart="[0-9]+")?>[\s]*<\/[uo]l>/g,"").replace(/<p>[\s]*<\/p>/g,"").replace(/\s+/g," "));var t=HTMLtoWTE(d),u=a.trim(t[0].value);if(u!=c){console.log("====== Converted WTE Markdown: ");console.log(c);console.log("====== Generated Valid XHTML: ");console.log(d);console.log("====== Converted Back to WTE Mark-Down ("+String(u==c?"equal":"NOT EQUAL")+"):");console.log(u)}if(t.length>1){console.log("====== Multiple WTE Blocks: ");console.dir(t)}return d};this.cleanup=function(){var g=this.getValue(true),b=a.trim(g);while(b.match(/(\n|^)(\* |- |\+ )( )*(\n|$)/))b=b.replace(/(\n|^)(\* |- |\+ )( )*(\n|$)/g,"\n").replace(/(\n|^)(\*|-|\+)( )*$/g,"\n");while(b.match(/(  )|(( )*(\r)?\n( )*(\r)?\n( )*(\r)?\n( )*)|( (\r)?\n)|((\r)?\n )/))b=b.replace(/(  )/g," ").replace(/( )*(\r)?\n( )*(\r)?\n( )*(\r)?\n( )*/g,"\n\n").replace(/( )(\r)?\n/g,"\n").replace(/\n( )/g,"\n");var e=t.exec(b),l=0,i=this.baseEditor||n.parents(".share-widget").data("whtPostEditor"),k=i.getMatchedEmbedList(),f=null;while(e&&e.index>=0&&++l<100&&i.isInited()){var d=e[0],j=d.replace(/^\[+|\]+$/,"");if(d.indexOf("[")<0&&d.indexOf("]")<0){b=v(d,e.index,b);f=e.index+d.length+2}!~a.inArray(j,k)&&(d.match(o)||d.match(z))&&y(j,d);e=t.exec(b)}b=b.replace(/([^\n])((\r)?\n)(?!(\* |- |\+ |[0-9]+\. ))([^\n]{120,})/g,function(){return arguments[1]+"\n\n"+arguments[5]});b=b.replace(/([^\n]{120,})((\r)?\n)(?!(\* |- |\+ |[0-9]+\. ))([^\n])/g,function(){return arguments[1]+"\n\n"+arguments[5]});g!=b&&this.setValue(b);if(this.settings.multiLine){var h=HTMLtoWTE(this.html());b=a.trim(h[0].value);g!=b&&this.setValue(b);h.length>1}f!==null&&c.setSelection(f)};function y(d,h){try{var e=c.baseEditor||n.parents(".share-widget").data("whtPostEditor"),i=e.getMatchedEmbedList(),g=e.getLoadingEmbedList(),j=e.getLoadedEmbedList(),f=h.match(o)?true:false,k=f?{VideoURL:d}:{UploadKey:h};i.push(d);a.post(f?b.BuildAJAXUrl("GetVideoEmbed"):b.BuildAJAXUrl("UploadPreviewImage"),k,function(h){if(h&&h.Error==null){if(!e.isInited())return;var i=c.getValue(),n=i.indexOf(d),k=new RegExp("^\\[+"+d.replace("?","\\?").replace("(","\\(").replace(")","\\)")+"\\s*\\]+\\s*$","gmi"),a=k.exec(i);if(~n&&a&&~a.index){console.log("found empty:",a);c.setSelection(a.index,a.index+a[0].length,true)}else{var m=new RegExp("\\[+"+d.replace("?","\\?").replace("(","\\(").replace(")","\\)")+"\\s*(.*)\\]+\\s*","gmi"),b=m.exec(i);console.log("found with text:",b);if(b&&~b.index&&b[1]&&b[1].length>1)return}var g=h.Response.Value,l=e.getFocusedBlock();if(f&&typeof g.embedTag!=="undefined"&&g.embedTag.length>0&&g.thumbSource.length>0||!f&&g.ImageWidth>=300&&g.ImageHeight>=48){var j=e.attachBlockWithDefaultOptions("EBGallery",false,true,{insertAfterBlock:l,initMode:""});if(f)j.gal.onVideoEmbedResponse(h);else j.gal.onImageUploadResponse(h)}}}).always(function(){j.push(d);for(var a=0;a<g.length;a++)g[a]===d&&g.remove(a)})}catch(l){console.log("Error Occurred:",l);return false}return true}function v(c,b,a){var f="["+c+" ]",d=a.substring(0,b),e=a.substring(b+c.length);a=d+f+e;return a}this.compareChanges=function(a){var b=e;if(a.start!=b.start||a.end!=b.end||a.text!=b.text||a.allText.length!=b.allText.length){b.beforeText!=a.beforeText;e=a;return true}return false}};a.fn.wealthyTextArea=function(c){return this.each(function(){var d=a(this);if(d.data("wealthyTextArea"))return d.data("wealthyTextArea");var e=new b.WealthyTextEditor(d,c);d.data("wealthyTextArea",e);e.init()})}})(window.WHT=window.WHT||{},jQuery);(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(e){var g=this.prototype;a=true;var f=new this;a=false;for(var c in e)f[c]=typeof e[c]=="function"&&typeof g[c]=="function"&&b.test(e[c])?function(a,b){return function(){var d=this._super;this._super=g[a];var c=b.apply(this,arguments);this._super=d;return c}}(c,e[c]):e[c];function d(){!a&&this.init&&this.init.apply(this,arguments)}d.prototype=f;d.prototype.constructor=d;d.extend=arguments.callee;return d}})();(function(b,a){b.EditorBlock=Class.extend({EB_TYPE:"undefined",IS_TEXT:false,CAN_MERGE_WITH_TWIN:false,CAN_HAVE_TWIN_NEIGHBOR:false,CAN_SET_SELECTION:true,CAN_BE_SPLIT:false,CAN_SPLIT_BLOCKS:false,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"",settings:{followWithBlockOptions:{}},blockID:null,baseEditor:null,baseElement:null,isFocused:false,destroy:function(){this.baseElement.remove();this.blockID=null;this.self=null;this.baseEditor=null},split:function(){a.error(".split() not implemented by this EditorBlock")},splittingOtherBlock:function(){a.error(".splitOtherBlock() not implemented by this EditorBlock")},merge:function(a){if(this.CAN_MERGE_WITH_TWIN&&a!=null&&a.EB_TYPE==this.EB_TYPE){if(this.EB_TYPE=="EBWealthyParagraph")this.xml(a.wte.html(),true);else this.xml(a.xml(),true);this.baseEditor.deleteBlock(a);return true}return false},mergeWithNext:function(){var a=this.getNextBlock();return!!(a&&this.merge(a))},xml:function(){a.error(".xml() not implemented by this EditorBlock");return""},blockIndex:function(){a.error(".blockIndex() not implemented by this EditorBlock")},isEmpty:function(){a.error(".isEmpty() not implemented by this EditorBlock");return false},init:function(){a.error(".init() not implemented by this EditorBlock")},initDroppable:function(){var c=this,e=[],d={},h=function(){c.baseElement.addClass("droppableActive");e=f();var d=b.Throttle(function(){e=f()},100);a(window).on("scroll.whtPostEditor",d)},g=function(l,k){c.baseElement.removeClass("droppableActive");c.baseElement.find(".cursor").remove();a(window).off("scroll.whtPostEditor");if(l.type==="drop"&&d&&d.el){var b=0;c.displayElement.find(".sentenceWrap").each(function(){var c=a(this);if(this!==d.el||!d.isTopLeft)b+=c.text().length;if(c.prev().prop("tagName")==="BR")b++;return this!==d.el});c.setFocused(true);c.wte.setSelection(b,b,true);c.split();var j=c.getPrevBlock(),i=c.getNextBlock(),e=k.draggable.parent().parent(),f=c.baseEditor.getBlockByBlockID(e.data("blockID")),g=f.getPrevBlock(),h=f.getNextBlock();c.baseElement.after(e);i&&i.mergeWithNext();j&&j.mergeWithNext();g&&g.mergeWithNext();h&&h.mergeWithNext();e.scrollTo({offSetTop:50});f.setFocused(true)}},f=function(){var a=[],b=c.displayElement.find(".sentenceWrap");b.each(function(d,c){var b=c&&c.getClientRects&&c.getClientRects();if(b&&b.length>0){a.push({el:c,x:b[0].left,y:b[0].top,height:b[0].height,width:b[0].width,isTopLeft:true});a.push({el:c,x:b[b.length-1].left+b[b.length-1].width,y:b[b.length-1].top,height:b[b.length-1].height,width:b[b.length-1].width,isTopLeft:false})}});return a},j=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};c.baseElement&&c.baseElement.length>0&&c.CAN_BE_SPLIT&&c.baseElement.droppable({over:h,out:g,drop:g,tolerance:"touch"});var i=b.Throttle(function(o){var g=c.displayElement.find(".cursor.placeholder"),k={x:o.clientX,y:o.clientY};e=e&&e.length>0?e:f();if(e.length<1||!c.baseEditor||!c.baseEditor.isDragging())return;if(g.length<1)g=a('<span class="cursor placeholder"><span style="display:inline-block;"></span></span>');var m=d,b=99999999,l=b,h=[],n=0;h=[];a.each(e,function(d,a){var c=Math.abs(k.y-(a.y+a.height/2));if(c<=b){a.yDist=b=c;h.push(a)}});a.each(h,function(d,c){var a=j(k,c);if(a<l&&c.yDist<=b){l=a;n=d}});d=e[n];var i=d.el;if(d.isTopLeft)g.insertBefore(i);else g.insertAfter(i);m&&m.el!==d.el&&c.wte._updateCursorSpanPos(true)},100);if(c.displayElement&&c.displayElement.length>0&&c.wte)c.baseElement.on("mousemove",i)},getSelectionRange:function(){a.error(".getSelectionRange() not implemented by this EditorBlock")},setSelection:function(){a.error(".setSelection() not implemented by this EditorBlock")},setFocused:function(a){if(this.isFocused!=a){this.isFocused=a;this.baseElement.toggleClass("isFocused",this.isFocused);if(this.isFocused){this.triggerFocusThisBlock();this.onGotFocus()}else this.onLostFocus()}},getNextBlock:function(){return this.baseEditor&&this.baseEditor.getNextBlock(this)},getPrevBlock:function(){return this.baseEditor&&this.baseEditor.getPrevBlock(this)},isFirstBlock:function(){var a=this.baseEditor.getFirstBlock();return a!=null&&a.blockID==this.blockID},isLastBlock:function(){var a=this.baseEditor.getLastBlock();return a!=null&&a.blockID==this.blockID},onGotFocus:function(){},onLostFocus:function(){},triggerFocusPreviousBlock:function(){var b=a.Event("focusPreviousBlock");b.fromBlock=this;this.baseElement.trigger(b)},triggerFocusThisBlock:function(){var b=a.Event("focusThisBlock");b.fromBlock=this;this.baseEditor.onFocusThisBlock(b)},triggerFocusNextBlock:function(){var b=a.Event("focusNextBlock");b.fromBlock=this;this.baseElement.trigger(b)},triggerDeleteBlock:function(){var b=a.Event("deleteBlock");b.fromBlock=this;this.baseEditor.onDeleteBlock(b)},triggerUpdateDefaultTip:function(){var b=a.Event("updateDefaultTip");b.fromBlock=this;this.baseElement.trigger(b)}});b.EditorBlock.AM_APPEND_NEXT=0;b.EditorBlock.AM_APPEND_BOTTOM=1;b.EditorBlock.AM_SPLIT=2;b.EditorBlock.SELECT_START="s";b.EditorBlock.SELECT_END="e";b.EditorBlock.BlockID=88e4;b.EditorBlock.BlockTypes={}})(window.WHT=window.WHT||{},jQuery);(function(b,a){b.EditorBlock.BlockTypes.EBWealthyParagraph=b.EditorBlock.extend({EB_TYPE:"EBWealthyParagraph",IS_TEXT:true,CAN_MERGE_WITH_TWIN:true,CAN_HAVE_TWIN_NEIGHBOR:false,CAN_BE_SPLIT:true,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:["MenuLink","MenuImage"],FOLLOW_WITH_BLOCK_TYPE:"",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...</span>',multiLine:true},minimumHeights:[22,154],init:function(e,d){this.blockID=b.EditorBlock.BlockID++;this.self=this;this.baseEditor=e;this.txtElement=null;this.baseElement=null;this.wte=null;var c={};a.extend(true,c,this.settings);d&&a.extend(true,c,d);this.settings=c;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){var a=this,c=a.getSelectionRange(),b=a.baseEditor.attachBlockWithDefaultOptions("EBWealthyParagraph",true,true);a.wte.setValue(c.textBefore);a.wte.cleanup();b.wte.setValue(c.textAfter);b.wte.cleanup()},setHtml:function(e){for(var d=HTMLtoWTE(e),c=0;c<d.length;c++){var a=d[c];if(c==0){this.wte.setValue(a.value,b.EditorBlock.SELECT_END);continue}switch(a.type){case"EBWealthyParagraph":case"EBWealthySubHeadline":case"EBWealthySubHeadlineStep":this.baseEditor.attachBlockWithDefaultOptions(a.type,true);this.baseEditor.getFocusedBlock().wte.setValue(a.value);break;case"EBGallery":this.baseEditor.attachBlockWithDefaultOptions(a.type,true);this.baseEditor.getFocusedBlock().xml(a.value)}}d.length>1&&this.baseEditor.updateStepNumbers()},xml:function(b,f){if(b!=null&&typeof b==="string"){b=a.trim(b);var c="";if(b.indexOf("<DocPart")!=0&&b.indexOf("<HtmlText")!=0)c=b;else try{var e=a(a.parseXML(b).firstChild),d=a(e.first()[0].nodeName=="DocPart"?e.find(":first-child"):e);c=d.first()[0].nodeName=="HtmlText"?d.html():d.find("HtmlText").html()}catch(g){console.log("Error Parsing XML for TextArea:\n"+b);console.dir(g)}this.setHtml(f===true?a.trim(a.trim(this.wte.html())+a.trim(c)):c)}var c=a.trim(this.wte.html());return c==""?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText>'+c+"</HtmlText></DocPart>"},blockIndex:function(){a.error("!!!.blockIndex() not implemented by this EBWealthyParagraph")},isEmpty:function(){return a.trim(this.wte.getValue())==""},getSelectionRange:function(){return this.wte.getLastSelectionRange()},setSelection:function(a,b){this.wte.setSelection(a,b)},onGotFocus:function(){!this.txtElement[0]._isFocused&&this.txtElement[0].focus()},onLostFocus:function(){this.wte!=null&&this.wte.cleanup()},onKeyPress:function(i){switch(i.keyCode||i.which){case 13:if(!this.settings.multiLine){this.triggerFocusNextBlock();var f=this.baseEditor.getFocusedBlock();if(f.blockID==this.blockID||f.EB_TYPE!="EBWealthyParagraph"&&this.FOLLOW_WITH_BLOCK_TYPE=="EBWealthyParagraph"){this.triggerFocusThisBlock();var j=this.baseEditor._attachEditorBlock(this.FOLLOW_WITH_BLOCK_TYPE,this.settings.followWithBlockOptions,b.EditorBlock.AM_APPEND_NEXT);this.baseEditor.setFocusedBlock(j)}else f.IS_TEXT&&f.setSelection(b.EditorBlock.SELECT_START);return false}else{var d=a.browser.msie&&a.browser.version<9?"\r\n":"\n",c=this.wte.getLastSelectionRange();if(c.textBefore.match(/((\r\n|\n|^)(\* |- |\+ )( )*)$/)){var e=0;this.wte.setValue(c.textBefore.replace(/((\r\n|\n|^)(\* |- |\+ )( )*)$/,function(){e=arguments[3].length;return arguments[2]})+(c.textAfter.length>0||c.start<4?c.textAfter:d),c.textAfter.length>0||c.start<4?c.start-e:c.start-e+d.length);return false}else if(c.textBefore.match(/((\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )( )*)$/)){var e=0;this.wte.setValue(c.textBefore.replace(/((\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )( )*)$/,function(){e=arguments[3].length;return arguments[2]})+(c.textAfter.length>0||c.start<5?c.textAfter:d),c.textAfter.length>0||c.start<5?c.start-e:c.start-e+d.length);return false}else if(c.textBefore.match(/(\r\n|\n|^)(\* |- |\+ )[^\n]+$/)){this.wte.setValue(c.textBefore+d+c.textBefore.match(/(\r\n|\n|^)(\* |- |\+ )[^\n]+$/)[2]+c.textAfter,c.start+2+d.length);return false}else if(c.textBefore.match(/(\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )[^\n]+$/)){var g=c.textBefore.match(/(\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )[^\n]+$/),h=String(Number(g[3])+1)+g[4]+" ";this.wte.setValue(c.textBefore+d+h+c.textAfter,c.start+h.length+d.length);return false}}break;case 32:var c=this.wte.getLastSelectionRange();if(c.start==0||c.textBefore.match(/((  )|\n)$/)){c.end>c.start&&this.wte.setValue(c.textBefore+c.textAfter,c.start);return false}else if(c.textAfter.match(/^(  )/)||c.textAfter.match(/^( )/)&&c.textBefore.match(/( )$/)){if(c.end>c.start)this.wte.setValue(c.textBefore+c.textAfter,c.start);else this.wte.setSelection(c.start+1);return false}else if(c.textBefore.lastIndexOf("[")>-1&&c.textAfter.substring(0,1)==" ")if(c.textBefore.lastIndexOf("]")<c.textBefore.lastIndexOf("[")&&c.textBefore.lastIndexOf(" ")<c.textBefore.lastIndexOf("[")&&c.textBefore.lastIndexOf("\n")<c.textBefore.lastIndexOf("[")){this.wte.setSelection(c.start+1);return false}}return true},onKeyDown:function(e){switch(e.keyCode||e.which){case 8:if(!(this.wte.isSelectionAtStart()&&this.wte.getLastSelectionRange().length==0))return true;else if(this.wte.getValue(true)==""){if(this.settings.multiLine){var m=this.baseEditor,l=this.getPrevBlock();this.triggerDeleteBlock();l!=null&&l.blockID!==this.blockID&&m.attachBlockWithDefaultOptions.apply(m,["EBWealthyParagraph",true,true])}else this.triggerDeleteBlock();return false}case 37:case 38:if(this.wte.isSelectionAtStart()){var d=this.baseEditor.getPrevBlock(this),o=10;while(d!=null&&d.blockID!=this.blockID&&--o>0)if(d.IS_TEXT)d.setSelection(b.EditorBlock.SELECT_END);else d=this.baseEditor.getPrevBlock(d);return false}break;case 39:case 40:if(this.wte.isSelectionAtEnd()){var c=this.baseEditor.getNextBlock(this),n=10;while(c!=null&&c.blockID!=this.blockID&&--n>0)if(c.IS_TEXT){c.setSelection(b.EditorBlock.SELECT_START);break}else c=this.baseEditor.getNextBlock(c);return false}break;case 219:if(e.shiftKey||!this.settings.multiLine)break;var a=this.wte.getLastSelectionRange(),f=a.textAfter.indexOf("]"),j=a.textAfter.indexOf("["),k=a.textAfter.indexOf("\n");if(f<0||j>-1&&j<f||k>-1&&k<f){for(var g=0,i=a.textBefore.length-1;i>=0;i--)if(a.textBefore.charAt(i)=="[")g++;else break;var h=!(a.text==""||Math.max(a.text.indexOf("\n"),a.text.indexOf("]"),a.text.indexOf("["))>-1);if(h&&!(g>0&&g%2>0)){this.wte.setValue(a.textBefore+"[ "+String(h?a.text:"")+"]"+String(h||a.text==""?"":" "+a.text)+a.textAfter,a.start+1);return false}}break;case 221:if(e.shiftKey||!this.settings.multiLine)break;var a=this.wte.getLastSelectionRange();if(a.textBefore.lastIndexOf("[")>-1&&a.textAfter.substring(0,1)=="]")if(a.textBefore.lastIndexOf("]")<a.textBefore.lastIndexOf("[")&&a.textBefore.lastIndexOf("\n")<a.textBefore.lastIndexOf("[")){this.wte.setSelection(a.start+1);return false}}return true},onMenuButtonClick:function(f){if(this.settings.multiLine&&f=="EBLink"){var a=this.wte.getLastSelectionRange();if(a.text!=""){var b=a.textAfter.indexOf("]"),c=a.textAfter.indexOf("["),d=a.textAfter.indexOf("\n");if(b<0||c>-1&&c<b||d>-1&&d<b){var e=!(a.text==""||Math.max(a.text.indexOf("\n"),a.text.indexOf("]"),a.text.indexOf("["))>-1);this.wte.setValue(a.textBefore+"[ "+String(e?a.text:"")+"]"+String(e||a.text==""?"":" "+a.text)+a.textAfter,a.start+1);return false}}}return true},_build:function(){if(this.baseElement!=null)return;this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWPtxt'+this.blockID+'" class="wteParagraph"></textarea>').find("#EBWPtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine});this.wte=this.txtElement.data("wealthyTextArea");if(this.wte)this.wte.baseEditor=this.baseEditor;this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",true);this.baseElement.data("blockID",this.blockID);this.displayElement=this.baseElement.find(".wteDisplay");var a=this;this.defaultSidebarTip={sHeadline:"How to Format Your Text",sBodyTemplate:'<div class="share-tip-section clearfix"><span class="lbl">Bold, Italics, or Link Text</span><p><span class="markDown">*</span><span style="color:#000;">bold</span><span class="markDown">*</span> or <span class="markDown">_</span><span style="font-style:italic;">italics</span><span class="markDown">_</span> or <span class="markDown">[<span style="color:#0C743A">http://url.com/</span> <span style="color:#06C">link text</span>]</span></p></div><div class="share-tip-section clearfix"><span class="lbl">Bullet Lists</span><p><span class="markDown">*&nbsp;</span>&nbsp;Start a new line with an asterix &amp; a space</p></div><div class="share-tip-section last clearfix"><span class="lbl">Numbered Lists</span><p><span class="markDown">1.&nbsp;</span>&nbsp;Start a new line with a number &amp; a period</p></div>',oForBlock:a}},_initEvents:function(){var a=this;this.txtElement.on({"focus.whtPostEditor":function(){a.triggerFocusThisBlock()},"keypress.whtPostEditor":function(b){return a.onKeyPress(b)},"keydown.whtPostEditor":function(b){return a.onKeyDown(b)}})}})})(window.WHT=window.WHT||{},jQuery);(function(a,b){a.EditorBlock.BlockTypes.EBWealthyHeadline=a.EditorBlock.BlockTypes.EBWealthyParagraph.extend({EB_TYPE:"EBWealthyHeadline",CAN_MERGE_WITH_TWIN:false,CAN_HAVE_TWIN_NEIGHBOR:false,CAN_SPLIT_BLOCKS:true,CAN_BE_SPLIT:false,INTERCEPT_MENU_BUTTONS:["MenuStep","MenuHeadline"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Type a Headline...</span>',multiLine:false,followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...</span>'}},minimumHeights:null,xml:function(a){if(a){a=b.trim(a);a.indexOf("<DocPart ")!=0&&this.wte.setValue(a)}var c=b.trim(this.wte.html());return c==""?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText><h1>'+c+"</h1></HtmlText></DocPart>"},onLostFocus:function(){this._super();this._fixCapitalizationIfNeeded()},_build:function(){if(this.baseElement!=null)return;this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWHtxt'+this.blockID+'" class="wteHeadline"></textarea>').find("#EBWHtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine});this.wte=this.txtElement.data("wealthyTextArea");this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",true);this.baseElement.data("blockID",this.blockID)},_fixCapitalizationIfNeeded:function(){var b=this.wte.getValue(true);if(b=="")return;var c=a.ToTitleCase(b);if(c!=b){this.wte.setValue(c);var d=this;this.baseEditor._showSidebarTip({sHeadline:"I Capitalized Your Headline",sBodyTemplate:'<div class="share-tip-section last clearfix"><span class="btn std silver med btnCloseTip fr">Ok, Thanks!</span> <span class="btn std silver med btnUndo fl">Undo Capitalization</span></div>',oForBlock:d,bindEvents:function(c){var a=this.oForBlock;c.find(".btnCloseTip").on({"click.whtPostEditor":function(){a.baseEditor._hideSidebarTip()}});c.find(".btnUndo").on({"click.whtPostEditor":function(){a.wte.setValue(b);a.baseEditor._hideSidebarTip()}})},iHideAfterSeconds:8})}}})})(window.WHT=window.WHT||{},jQuery);(function(a,b){a.EditorBlock.BlockTypes.EBWealthySubHeadline=a.EditorBlock.BlockTypes.EBWealthyHeadline.extend({EB_TYPE:"EBWealthySubHeadline",CAN_MERGE_WITH_TWIN:false,CAN_HAVE_TWIN_NEIGHBOR:false,CAN_SPLIT_BLOCKS:true,CAN_BE_SPLIT:false,INTERCEPT_MENU_BUTTONS:["MenuStep","MenuHeadline"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Type a Headline...</span>',multiLine:false,isStep:false,stepNum:1,followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...</span>'}},minimumHeights:null,init:function(e,d){this.blockID=a.EditorBlock.BlockID++;this.self=this;this.baseEditor=e;this.txtElement=null;this.baseElement=null;this.wte=null;var c={};b.extend(true,c,this.settings);d&&b.extend(true,c,d);this.settings=c;this.setStepNum(this.settings.stepNum);this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},setStepNum:function(a){if(this.settings.isStep){this.settings.stepNum=a;this.settings.defaultText="Step "+String(this.settings.stepNum)+": ";this.settings.defaultHtml="Step "+String(this.settings.stepNum)+'<span class="txt-clr-medlight">: Type a Headline for this Step (optional)...</span>'}else{this.settings.defaultText="";this.settings.defaultHtml='<span class="txt-clr-lighter">Type a Headline...</span>'}if(this.wte!=null){this.wte.settings.defaultText=this.settings.defaultText;this.wte.settings.defaultHtml=this.settings.defaultHtml;if(this.settings.isStep)this.txtElement[0].value=this.txtElement[0].value.replace(/^Step\s[0-9]+(?::?)(?:\s?)/i,"Step "+String(this.settings.stepNum)+": ");this.wte._onCursorChange("redraw",{},true)}},splittingOtherBlock:function(b){if(!b)return false;var a=b.getSelectionRange();this.isStep&&this.baseEditor.updateStepNumbers(true);a.text&&a.text!==""&&this.wte.setValue((this.settings&&this.settings.defaultText&&this.settings.defaultText!==""?this.settings.defaultText:"")+a.text)},xml:function(){var a=b.trim(this.wte.html());return a==""?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText><h2 class="'+String(this.settings.isStep?"step":"sectionHeadline")+'">'+a+"</h2></HtmlText></DocPart>"},_build:function(){if(this.baseElement!=null)return;this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWSHtxt'+this.blockID+'" class="wteSubHeadline"></textarea>').find("#EBWSHtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine});this.wte=this.txtElement.data("wealthyTextArea");this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",true);this.baseElement.data("blockID",this.blockID)}})})(window.WHT=window.WHT||{},jQuery);(function(b,a){b.EditorBlock.BlockTypes.EBGallery=b.EditorBlock.extend({EB_TYPE:"EBGallery",IS_TEXT:false,CAN_MERGE_WITH_TWIN:true,CAN_HAVE_TWIN_NEIGHBOR:true,CAN_SET_SELECTION:false,CAN_SPLIT_BLOCKS:true,CAN_BE_SPLIT:false,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:["MenuLink","MenuImage"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{initMode:"image",followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...</span>'}},init:function(e,d){this.blockID=b.EditorBlock.BlockID++;this.self=this;this.baseEditor=e;this.baseElement=null;var c={};a.extend(true,c,this.settings);d&&a.extend(true,c,d);this.settings=c;this._build();this._initEvents()},xml:function(c){if(c!=null&&typeof c==="string")try{for(var f=a(a.parseXML(c)).children().first(),i=f.first()[0].nodeName=="DocPart"?f.first():f,j=Number(i.attr("Layout")||0),h=i.children(),d=0;d<h.length;d++){var e=a(h[d]);switch(e[0].nodeName){case"Video":this.gal.appendGalleryItem(new b.WHTGalleryVideo(e));break;case"Image":this.gal.appendGalleryItem(new b.WHTGalleryImage(e))}}this.gal.setDisplayTemplate(j)}catch(l){console.log("Error Parsing XML for Gallery:\n"+c);console.dir(l)}else c!=null&&typeof c==="object"&&this.gal.addGalleryItems(c.galleryItems,c.layout);if(this.gal.settings.galleryItems.length==0)return"";for(var g='<DocPart PartType="Gallery" id="docPartGal'+this.blockID+'" SingleMode="False" Layout="'+this.gal.getActiveLayoutIndex()+'">',d=0;d<this.gal.settings.galleryItems.length;d++)g+=this.gal.settings.galleryItems[d].xml();g+="</DocPart>";return g},blockIndex:function(){a.error("!!!.blockIndex() not implemented by this EBGallery")},isEmpty:function(){return this.gal.settings.galleryItems.length==0},getSelectionRange:function(){a.error("!!!.getSelectionRange() not implemented by this EBGallery")},setSelection:function(){a.error("!!!.setSelection() not implemented by this EBGallery")},resizeDraggable:function(){if(this.draggable&&this.draggable.length>0&&this.baseEditor.isInited()&&this.gal){var d=this,c=this.gal.getActiveGalleryItem(),a=this.gal.getThumbnailContainer()?this.gal.getThumbnailContainer().height():0,b=this.baseElement.height();window.setTimeout(function(){d.draggable.height(c&&c.galleryItemType==="Image"?b-a:b*.4-a)},10)}},onGotFocus:function(){var a=this;this.baseElement!=null&&this.baseElement[0].focus();a.resizeDraggable()},onLostFocus:function(){this.draggable&&this.draggable.length>0&&this.draggable.height(this.baseElement.height())},onMenuButtonClick:function(){return true},contentChanged:function(){this.dragClone=null;this.resizeDraggable();this.baseEditor.isInited()&&this.baseEditor._renderCoverImageSelector()},splittingOtherBlock:function(){},_build:function(){if(this.baseElement!=null)return;this.baseElement=this.baseEditor.divEditorBlocks.append('<div class="editorBlock" id="EBGal'+this.blockID+'"></div>').find("#EBGal"+this.blockID);this.baseElement.data("blockID",this.blockID);this.baseElement.whtGallery({initPromptMediaType:this.settings.initMode,editMode:true,galleryItems:[],baseEditor:this.baseEditor,galleryBlock:this});this.baseElement.prepend('<div class="galDraggableContainer"><div class="galDraggable fl" >&nbsp;</div></div>');this.gal=this.baseElement.data("whtGallery");var c=this;this.defaultSidebarTip={sHeadline:function(){return this.oForBlock.gal.getEditorHeadline()},sBodyTemplate:function(){return this.oForBlock.gal.getEditorMenu()},oForBlock:c,bindEvents:function(c){var b=this.oForBlock;c.find(".gallery-layout-container").on({"click.whtPostEditor":function(){a(".gallery-layout-container").removeClass("active");b.gal.setDisplayTemplate(a(this).addClass("active").data("template-index"))}});c.find(".gallery-btn-new-image").on({"click.whtPostEditor":function(){b.gal.addNewGalleryItem("image")}});c.find(".gallery-btn-new-video").on({"click.whtPostEditor":function(){b.gal.addNewGalleryItem("video")}});c.find(".gallery-btn-shadow-on").on({"click.whtPostEditor":function(){b.gal.toggleImageShadow(0,true)}});c.find(".gallery-btn-shadow-off").on({"click.whtPostEditor":function(){b.gal.toggleImageShadow(0,false)}});c.find(".gallery-btn-delete").on({"click.whtPostEditor":function(){b.gal.removeGalleryItem(0)}});c.find(".gallery-btn-toggle-caption").on({"click.whtPostEditor":function(){b.gal.showCaptionEditorForItem(c,0)}});c.find(".gallery-item .gallery-btn").on({"click.whtPostEditor":function(){var e=a(this),d=Number(e.parent().data("index"));if(e.hasClass("left"))b.gal.reOrderGalleryItem(d,d-1);else if(e.hasClass("right"))b.gal.reOrderGalleryItem(d,d+1);else if(e.hasClass("edit"))b.gal.showCaptionEditorForItem(c,d);else e.hasClass("delete")&&b.gal.removeGalleryItem(d)}});c.find(".gallery-btn-caption-cancel, .gallery-btn-caption-ok").on({"click.whtPostEditor":function(){var e=a(this),d=e.hasClass("gallery-btn-caption-ok"),f=d?Number(e.data("for-gal-index")):0;b.gal.editGalleryItem(c,f,d)}})}};c.innerContent=this.baseElement.find(".contentArea .innerContent");c.itemCaption=this.baseElement.find(".captionText .itemCaption");c.itemsThumbContainer=this.baseElement.find(".itemLinkListContainer .items");c.btnLeft=this.baseElement.find(".nav-leftright .left");c.btnRight=this.baseElement.find(".nav-leftright .right");c.draggable=c.baseElement.find(".galDraggable");b.OnElementReady(this.baseElement)},_getDragClone:function(){var b=this;b.dragClone=b.dragClone||(b.gal?b.gal.getThumbnailContainer()?b.gal.getThumbnailContainer().clone().css({"z-index":"9999"}):a('<div style="z-index: 9999; position: absolute;">'+b.gal.getActiveGalleryItemThumbnail()+"</div>"):"");return b.dragClone},_initEvents:function(){var b=this;b.draggable.draggable({cursor:"move",cursorAt:{top:-2,left:2},start:function(){b.setFocused(true);b.baseEditor.isDragging(true);b.baseEditor.getRoot().find(".wteTextWrap").css("z-index","0")},stop:function(){b.baseEditor.isDragging(false);b.baseEditor.getRoot().find(".wteTextWrap").css("z-index","2")},helper:function(){return jQuery.browser.msie&&+jQuery.browser.version<10?"<span></span>":b._getDragClone()},scrollSensitivity:40});b.baseElement.on({"focus.whtPostEditor":function(){b.triggerFocusThisBlock()},"click.whtPostEditor":function(){b&&b.baseEditor&&b.baseEditor.onFocusThisBlock&&b.triggerFocusThisBlock()},"contentChanged.whtPostEditor":function(a){b.contentChanged(a);b.triggerUpdateDefaultTip()},"galleryEmptied.whtPostEditor":function(){b.triggerDeleteBlock()},"galleryLoaded.whtPostEditor":function(){if(b.draggable&&b.draggable.length>0){b.draggable.height(b.baseElement.height());b.resizeDraggable();b._getDragClone()}},"galleryItemChanged.whtPostEditor":function(){b.resizeDraggable()}});b.baseElement.on("hover",".gallery-delete-btn",function(c){var b=a(this);if(c.type==="mouseenter")b.addClass("silver rnd");else b.removeClass("silver")});b.baseElement.on("click",".gallery-delete-btn",function(){b.setFocused(true);if(!confirm("Are you sure you want to delete this gallery?"))return;for(var a=b.gal.settings.galleryItems.length-1;a>-1;a--)b.gal.removeGalleryItem(a,true)})}})})(window.WHT=window.WHT||{},jQuery);(function(){var c=/^<([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,d=/^<\/([-A-Za-z0-9_]+)[^>]*>/,k=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,j=a("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,canvas"),e=a("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul,article,header,aside,hgroup,output,section,figure,figcaption,footer,progress,video"),i=a("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var,mark,audio,meter,nav,details,command,source,datalist,summary,time"),f=a("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),g=a("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),h=a("script,style"),b=this.HTMLParser=function(a,l){var m,p,n,b=[],q=a;b.last=function(){return this[this.length-1]};while(a){p=true;if(!b.last()||!h[b.last()]){if(a.indexOf("<!--")==0){m=a.indexOf("-->");if(m>=0){l.comment&&l.comment(a.substring(4,m));a=a.substring(m+3);p=false}}else if(a.indexOf("</")==0){n=a.match(d);if(n){a=a.substring(n[0].length);n[0].replace(d,o);p=false}}else if(a.indexOf("<")==0){n=a.match(c);if(n){a=a.substring(n[0].length);n[0].replace(c,r);p=false}}if(p){m=a.indexOf("<");var s=m<0?a:a.substring(0,m);a=m<0?"":a.substring(m);l.chars&&l.chars(s)}}else{a=a.replace(new RegExp("(.*)</"+b.last()+"[^>]*>"),function(b,a){a=a.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1");l.chars&&l.chars(a);return""});o("",b.last())}if(a==q)throw"Parse Error: "+a;q=a}o();function r(m,a,h,c){a=a.toLowerCase();if(e[a])while(b.last()&&i[b.last()])o("",b.last());f[a]&&b.last()==a&&o("",a);c=j[a]||!!c;!c&&b.push(a);if(l.start){var d=[];h.replace(k,function(c,a){var b=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:g[a]?a:"";d.push({name:a,value:b,escaped:b.replace(/(^|[^\\])"/g,'$1\\"')})});l.start&&l.start(a,d,c)}}function o(e,d){if(!d)var a=0;else for(var a=b.length-1;a>=0;a--)if(b[a]==d)break;if(a>=0){for(var c=b.length-1;c>=a;c--)l.end&&l.end(b[c]);b.length=a}}};this.HTMLtoXML=function(c){var a="";b(c,{start:function(e,c,d){a+="<"+e;for(var b=0;b<c.length;b++)a+=" "+c[b].name+'="'+c[b].escaped+'"';a+=(d?"/":"")+">"},end:function(b){a+="</"+b+">"},chars:function(b){a+=b},comment:function(b){a+="<!--"+b+"-->"}});return a};this.HTMLtoDOM=function(j,c){var e=a("html,head,body,title"),g={link:"head",base:"head"};if(!c){if(typeof DOMDocument!="undefined")c=new DOMDocument;else if(typeof document!="undefined"&&document.implementation&&document.implementation.createDocument)c=document.implementation.createDocument("","",null);else if(typeof ActiveX!="undefined")c=new ActiveXObject("Msxml.DOMDocument")}else c=c.ownerDocument||c.getOwnerDocument&&c.getOwnerDocument()||c;var f=[],i=c.documentElement||c.getDocumentElement&&c.getDocumentElement();!i&&c.createElement&&(function(){var a=c.createElement("html"),b=c.createElement("head");b.appendChild(c.createElement("title"));a.appendChild(b);a.appendChild(c.createElement("body"));c.appendChild(a)})();if(c.getElementsByTagName)for(var h in e)e[h]=c.getElementsByTagName(h)[0];var d=e.body;b(j,{start:function(a,h,j){if(e[a]){d=e[a];return}var b=c.createElement(a);for(var i in h)b.setAttribute(h[i].name,h[i].value);if(g[a]&&typeof e[g[a]]!="boolean")e[g[a]].appendChild(b);else d&&d.appendChild&&d.appendChild(b);if(!j){f.push(b);d=b}},end:function(){f.length-=1;d=f[f.length-1]},chars:function(a){d.appendChild(c.createTextNode(a))},comment:function(){}});return c};this.HTMLtoWTE=function(u){var c=[{type:"EBWealthyParagraph",value:""}],a=0,f=false,h=false,k=false,g=false,j=false,l=false,m=false,s=false,n=false,r=false,o=1,i=null,t="",p="";b(u,{start:function(y,b,x){if(l)return;p="";switch(y.toLowerCase()){case"br":c[a].value+="\n";break;case"b":case"strong":if(g||h||f)break;h=true;c[a].value+="*";break;case"i":case"em":if(j||k||f)break;k=true;c[a].value+="_";break;case"a":if(f)break;f=true;c[a].value+="[";for(var d in b)if(b[d].name=="href")c[a].value+=p=b[d].value.replace(/&quot;/g,'"').replace(/&amp;/g,"&");c[a].value+=" ";break;case"span":for(var d in b)if(b[d].name=="class"&&b[d].value.indexOf("ulText")>-1&&!h&&!f&&!g){g=true;c[a].value+="*"}else if(b[d].name=="style"){var u=b[d].value.toLowerCase().replace(/\s/g,"");if((u.indexOf("font-weight:bold")>-1||u.indexOf("text-decoration:underline")>-1)&&!h&&!f&&!g){g=true;c[a].value+="*"}if(u.indexOf("font-style:italic")>-1&&!k&&!f&&!j){j=true;c[a].value+="_"}}break;case"li":r=true;c[a].value+=t=n?String(o++)+". ":"* ";break;case"ul":s=true;break;case"ol":n=true;o=1;for(var d in b)if(b[d].name=="start"&&b[d].value.match(/^[0-9]+$/))o=Number(b[d].value);break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":i=null;c.push({type:"EBWealthySubHeadline",value:""});a++;l=true;for(var d in b)if(b[d].name=="class"){var e=b[d].value.match(/\bstepNum([0-9]+)\b/i);if(e&&e.index>-1)i=Number(e[1]);break}break;case"img":var q="",v=false;for(var d in b)if(b[d].name=="src")q=b[d].value;else if(b[d].name=="class"&&(b[d].value.indexOf("imgRight")>-1||b[d].value.indexOf("imgLeft")>-1))v=true;if(q!=""){var w=new WHT.WHTGalleryImage(q,0,0);c.push({type:"EBGallery",value:'<DocPart PartType="Gallery" SingleMode="False" Layout="0">'+w.xml()+"</DocPart>",swapWithNext:v});a++}m=!x;if(!m){c.push({type:"EBWealthyParagraph",value:""});a++}}},end:function(b){if(l)switch(b.toLowerCase()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":c[a].value=$.trim(c[a].value);if(!/^Step\s[0-9]+(?::?)(?:\s?)/i.test(c[a].value)&&i!=null&&i>0)c[a].value="Step "+i+": "+c[a].value;if(/^Step\s[0-9]+(?::?)(?:\s?)/i.test(c[a].value))c[a].type="EBWealthySubHeadlineStep";c.push({type:"EBWealthyParagraph",value:""});a++;l=false}else if(m)switch(b.toLowerCase()){case"img":c.push({type:"EBWealthyParagraph",value:""});a++;m=false}else switch(b.toLowerCase()){case"p":c[a].value+="\n\n";break;case"b":case"strong":if(!h)break;h=false;c[a].value+="*";break;case"i":case"em":if(!k)break;k=false;c[a].value+="_";break;case"a":if(!f)break;f=false;c[a].value+="]";break;case"span":if(j){j=false;c[a].value+="_"}if(g){g=false;c[a].value+="*"}break;case"li":c[a].value+="\n";r=false;break;case"ol":c[a].value+="\n";n=false;break;case"ul":c[a].value+="\n";s=false;break;default:if(e[b.toLowerCase()]&&c[a].value.length>0&&c[a].value.charAt(c[a].value.length-1)!="\n")c[a].value+="\n"}},chars:function(b){if(b==""||(n||s)&&!r)return;var d=document.createElement("div");d.innerHTML=b;if(f){b=$(d).text().replace(/\s+/g," ");if(b===p)b=""}else b=$(d).text().replace(/\s+/g," ").replace(/_/g,"__").replace(/\*/g,"**").replace(/\[/g,"[[").replace(/\]/g,"]]");if(c[a].value.charAt(c[a].value.length-1)==" "&&b.charAt(0)==" ")b=b.substring(1);c[a].value+=b}});var d=[];for(a=0;a<c.length;a++){c[a].value=$.trim(c[a].value);if(a==0||c[a].value!="")if(a>0&&c[a].type=="EBWealthyParagraph"&&d[d.length-1].swapWithNext){d[d.length-1].swapWithNext=false;if(d.length>1&&d[d.length-2].type=="EBWealthyParagraph"){var q=c[a].value.indexOf("\n");if(q>-1){d[d.length-2].value+=" "+c[a].value.substring(0,q);c[a].value=$.trim(c[a].value.substring(q));c[a].value!=""&&d.push(c[a])}else d[d.length-2].value+=" "+c[a].value}else{d.push(d[d.length-1]);d[d.length-2]=c[a]}}else d.push(c[a])}return d};function a(d){for(var c={},b=d.split(","),a=0;a<b.length;a++)c[b[a]]=true;return c}})();(function(b,a){var g=200,c=/height="([0-9]+)"/gi,d=/width="([0-9]+)"/gi,f=/\/audio\/#url=(.*)/,e=/^(?:(?:https?|ftp|itpc):\/\/)?(?:[A-Z0-9](?:[-A-Z0-9.]*))(?:\.[a-z]{2,4}(?::[0-9]+)?)(?:(?:\/|\?|#)(?:(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$?!:,.])$|(?:\/|\?|#)$|$)/i;b.WHTGalleryVideo=function(i,b,f,k,h,g,j){this.xml=function(b){if(arguments.length>0&&b!=null){if(typeof b==="string")try{b=a(a.parseXML(b)).children().first()}catch(i){}if(typeof b==="object")if(b.jquery){var e=b.length>0&&b.first()[0].nodeName=="Video"?b:b.find("Video");if(e.length>0){this.videoLink=decodeURIComponent(e.attr("VideoLink")||"");this.embedTag=a.trim(decodeURIComponent(e.find("EmbedTag").html()||""));this.thumbSource=e.attr("ThumbSource")||"";this.caption=decodeURIComponent(e.attr("Caption")||"");this.creditUrl=e.attr("CreditURL")||"";this.creditText=decodeURIComponent(e.attr("CreditText")||"");this.videoID=decodeURIComponent(e.attr("VideoID")||-1)}}else{this.videoLink=b.videoLink||"";this.embedTag=a.trim(b.embedTag||"");this.thumbSource=b.thumbSource||"";this.caption=b.caption||"";this.creditUrl=b.creditUrl||"";this.creditText=b.creditText||"";this.videoID=b.videoID||-1}if(this.creditText.indexOf("<a href")>-1)this.creditText="";if(this.embedTag.indexOf("&lt;")==0)this.embedTag=a("<div/>").html(this.embedTag).text();if(this.embedTag.indexOf("&amp;autoplay=0")>0&&this.embedTag.indexOf("?")==-1)this.embedTag=this.embedTag.split("&amp;autoplay=0").join("?autoplay=0");
                var rxOldYT = /youtube\.com\/v\/([a-z0-9\?\&\=_\-\;]*)\"/gi,
                    sNewYT = '<iframe width="532" height="324" src="http://www.youtube.com/embed/{0}" frameborder="0" allowfullscreen="allowfullscreen"></iframe>';
                if (rxOldYT.test(this.embedTag)) {
                    var ytIDandArgs = '';
                    this.embedTag.replace(rxOldYT, function () {
                        ytIDandArgs = arguments[1];
                        return '';
                    });
                    if (ytIDandArgs != '') {
                        this.embedTag = $.format(sNewYT, ytIDandArgs);
                    }
                }
var f=299,g=532;c.test(this.embedTag)&&this.embedTag.replace(c,function(){f=+arguments[1];return""});d.test(this.embedTag)&&this.embedTag.replace(d,function(){g=+arguments[1];return""});this.height=f;this.width=g}var h=[encodeURIComponent(this.videoLink),encodeURIComponent(this.embedTag),this.thumbSource.replace(/&/g,"&amp;"),encodeURIComponent(this.caption),this.creditUrl.replace(/&/g,"&amp;"),encodeURIComponent(this.creditText),this.videoID];return'<Video VideoLink="{0}" ThumbSource="{2}" Caption="{3}" CreditURL="{4}" CreditText="{5}" VideoID="{6}"><EmbedTag>{1}</EmbedTag></Video>'.replace(/\{(\d+)\}/g,function(b,a){return h[a]})};var e=this;this.galleryItemType="Video";if(arguments.length===1)this.xml(arguments[0]);else{this.videoLink=i;this.embedTag=b||"";this.thumbSource=f||"";this.caption=k||"";this.creditUrl=h||"";this.creditText=g||"";this.videoID=j||-1;if(this.embedTag.indexOf("&amp;autoplay=0")>0&&this.embedTag.indexOf("?")==-1)this.embedTag=this.embedTag.split("&amp;autoplay=0").join("?autoplay=0");this.width=532;b.match(d)&&this.embedTag.replace(d,function(){e.width=+arguments[1]});this.height=299;b.match(c)&&this.embedTag.replace(c,function(){e.height=+arguments[1]})}};b.WHTGalleryImage=function(f,h,e,k,j,i,g,c,l,d){var m=this;this.xml=function(c){if(arguments.length>0&&c!=null){if(typeof c==="string")try{c=a(a.parseXML(c)).children().first()}catch(f){}if(typeof c==="object"){if(c.jquery){var d=c.length>0&&c.first()[0].nodeName=="Image"?c.first():c.find("Image");if(d.length>0){this.src=d.attr("LargeSource")||"";if(this.src==""||this.src==null)this.src=d.attr("StandardSource")||"";this.width=Number(d.attr("LargeWidth")||0);if(this.width==null||this.width==0||String(this.width)=="NaN")this.width=Number(d.attr("StandardWidth")||0);if(this.width==null||String(this.width)=="NaN")this.width=0;this.height=Number(d.attr("LargeHeight")||0);if(this.height==null||this.height==0||String(this.height)=="NaN")this.height=Number(d.attr("StandardHeight")||0);if(this.height==null||String(this.height)=="NaN")this.height=0;this.caption=decodeURIComponent(d.attr("Caption")||"");this.creditUrl=d.attr("CreditURL")||"";this.creditText=decodeURIComponent(d.attr("CreditText")||"");this.originalUrl=decodeURIComponent(d.attr("OriginalURL")||"");this.shadow=String(d.attr("Shadow")||"").toLowerCase()=="true";this.scale=Number(d.attr("Scale")||0);this.imageTitleUrlBase=""}}else{this.src=c.src||"";this.width=c.width||0;this.height=c.height||0;this.caption=c.caption||"";this.creditUrl=c.creditUrl||"";this.creditText=c.creditText||"";this.originalUrl=c.originalUrl||"";this.shadow=c.shadow||false;this.scale=c.scale||0;this.imageTitleUrlBase=c.imageTitleUrlBase||""}if(this.creditText.indexOf("<a href")>-1)this.creditText="";this.oImgUrl=new b.ImgUrl(this.src,"w654",this.imageTitleUrlBase)}}var e=[(this.oImgUrl.isValid&&this.oImgUrl.toString()!=""?this.oImgUrl.imgID+"."+this.oImgUrl.imgExt+this.oImgUrl.queryString:this.src).replace(/&/g,"&amp;"),this.width,this.height,encodeURIComponent(this.caption),this.creditUrl.replace(/&/g,"&amp;"),encodeURIComponent(this.creditText),encodeURIComponent(this.originalUrl),this.shadow?"True":"False",this.scale];return'<Image StandardSource="{0}" LargeSource="{0}" ThumbSource="{0}" StandardWidth="{1}" LargeWidth="{1}" StandardHeight="{2}" LargeHeight="{2}" Caption="{3}" CreditURL="{4}" CreditText="{5}" OriginalURL="{6}" Shadow="{7}" Scale="{8}"/>'.replace(/\{(\d+)\}/g,function(b,a){return e[a]})};this.galleryItemType="Image";if(arguments.length==1)this.xml(arguments[0]);else this.xml({src:f||"",width:h||0,height:e||0,caption:k||"",creditUrl:j||"",creditText:i||"",originalUrl:g||"",shadow:c===true||String(c||"").toLowerCase()=="true",imageTitleUrlBase:d||""})};b.WHTGallery=function(x,w){this.settings={initPromptMediaType:"",editMode:false,galleryItems:[],initFromGalleryItemsObjects:[],imageTitleUrlBase:"",initWithLayoutIndex:0,galleryBlock:{}};w&&a.extend(true,this.settings,w);if(!this.settings.baseEditor)this.settings.baseEditor=x.parents(".share-widget").data("whtPostEditor");var f=this,B=B++,g=-1,n=0,l=10,t='<figure class="gal-row gal-row-34 gal-wf gal-mgb clearfix"></figure><div class="gal-row gal-row-14 clearfix"><figure class="gal-w6 gal-mgr gal-mgb fl"></figure><figure class="gal-w6 gal-mgr gal-mgb fl"></figure><figure class="gal-w6 gal-mgr gal-mgb fl"></figure><figure class="gal-w6 gal-mgr gal-mgb fl"></figure><figure class="gal-w6 gal-mgr gal-mgb fl"></figure><figure class="gal-w6 gal-mgb fl"></figure></div>',z='<div class="galContentContainer"><div class="galContent clearfix"></div> <div class="white-out"><div></div></div></div> <div class="galBottom clearfix"> <div class="nav-leftright fr"><div class="arrow left btn fl"></div><div class="arrow right btn fr"></div></div> <div class="items clearfix"></div></div>',C='<figure>{0}</figure><div class="itemCaption">{1}</div></div>',y='<span class="fl itemLink gallery{0} galleryItemIndex{1}{3}" data-index="{1}"><img src="{2}" width="68" height="53" alt=""/>{4}</span>',o=[['<div class="galEmpty"></div>'],['<figure class="gal-row gal-row-f gal-{1}" data-index="0">{0}</figure>'],["gallery",'<div class="gal-row gal-row-f clearfix"><figure class="gal-w2 fl" data-index="0">{0}</figure><figure class="gal-w2 fr" data-index="1">{1}</figure></div>','<figure class="gal-row gal-row-12 gal-mgb gal-wf" data-index="0">{0}</figure><figure class="gal-row gal-row-12 gal-wf" data-index="1">{1}</figure>'],["gallery",'<div class="gal-row gal-row-f clearfix"><figure class="gal-w3 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w3 fl" data-index="1">{1}</figure><figure class="gal-w3 fr" data-index="2">{2}</figure></div>','<figure class="gal-row gal-row-12 gal-wf gal-mgb" data-index="0">{0}</figure><div class="gal-row gal-row-12 clearfix"><figure class="gal-w2 fl" data-index="1">{1}</figure><figure class="gal-w2 fr" data-index="2">{2}</figure></div>','<div class="gal-row gal-row-12 gal-mgb clearfix"><figure class="gal-w2 fl" data-index="0">{0}</figure><figure class="gal-w2 fr" data-index="1">{1}</figure></div><figure class="gal-row gal-row-12 gal-wf gal-wf" data-index="2">{2}</figure>','<figure class="gal-row gal-row-13 gal-wf gal-mgb" data-index="0">{0}</figure><figure class="gal-row gal-row-13 gal-wf gal-mgb" data-index="1">{1}</figure><figure class="gal-row gal-row-13 gal-wf" data-index="2">{2}</figure>'],["gallery",'<div class="gal-row gal-row-12 gal-mgb clearfix"><figure class="gal-w2 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w2 fr" data-index="1">{1}</figure></div><div class="gal-row gal-row-12 clearfix"><figure class="gal-w2 fl gal-mgr" data-index="2">{2}</figure><figure class="gal-w2 fr" data-index="3">{3}</figure></div>','<figure class="gal-row gal-row-12 gal-mgb" data-index="0">{0}</figure><div class="gal-row gal-row-12 clearfix"><figure class="gal-w3 fl gal-mgr" data-index="1">{1}</figure><figure class="gal-w3 fl" data-index="2">{2}</figure><figure class="gal-w3 fr" data-index="3">{3}</figure></div>','<figure class="gal-row gal-row-13 gal-mgb" data-index="0">{0}</figure><div class="gal-row gal-row-13 gal-mgb clearfix"><figure class="gal-w2 fl gal-mgr" data-index="1">{1}</figure><figure class="gal-w2 fr" data-index="2">{2}</figure></div><figure class="gal-row gal-row-13" data-index="3">{3}</figure>','<div class="gal-row gal-row-12 gal-mgb clearfix"><figure class="gal-w3 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w3 fl" data-index="1">{1}</figure><figure class="gal-w3 fr" data-index="2">{2}</figure></div><figure class="gal-row gal-row-12" data-index="3">{3}</figure>'],["gallery",'<div class="gal-row gal-row-12 gal-mgb clearfix"><figure class="gal-w2 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w2 fr" data-index="1">{1}</figure></div><div class="gal-row gal-row-12 clearfix"><figure class="gal-w3 fl gal-mgr" data-index="2">{2}</figure><figure class="gal-w3 fl" data-index="3">{3}</figure><figure class="gal-w3 fr" data-index="4">{4}</figure></div>','<figure class="gal-row gal-row-13 gal-mgb" data-index="0">{0}</figure><div class="gal-row gal-row-13 gal-mgb clearfix"><figure class="gal-w2 fl gal-mgr" data-index="1">{1}</figure><figure class="gal-w2 fr" data-index="2">{2}</figure></div><div class="gal-row gal-row-13 clearfix"><figure class="gal-w2 fl gal-mgr" data-index="3">{3}</figure><figure class="gal-w2 fr" data-index="4">{4}</figure></div>','<div class="gal-row gal-row-13 gal-mgb clearfix"><figure class="gal-w2 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w2 fr" data-index="1">{1}</figure></div><figure class="gal-row gal-wf gal-row-13 gal-mgb" data-index="2">{2}</figure><div class="gal-row gal-row-13 clearfix"><figure class="gal-w2 fl gal-mgr" data-index="3">{3}</figure><figure class="gal-w2 fr" data-index="4">{4}</figure></div>','<div class="gal-row gal-row-12 gal-mgb clearfix"><figure class="gal-w3 fl gal-mgr" data-index="0">{0}</figure><figure class="gal-w3 fl" data-index="1">{1}</figure><figure class="gal-w3 fr" data-index="2">{2}</figure></div><div class="gal-row gal-row-12 clearfix"><figure class="gal-w2 fl gal-mgr" data-index="3">{3}</figure><figure class="gal-w2 fr" data-index="4">{4}</figure></div>'],["gallery"]],s=o[0],r=a(x).addClass("whtGallery").html(""+(f.settings.editMode?'<div class="gallery-menu">   <a class="btn gallery-delete-btn tooltip" href="javascript: // Delete" title="Delete this gallery">X</a></div>':"")+'<div class="gallery-layout">   <div class="gallery-layout-container">   </div>   <div class="white-out">       <div></div>   </div></div>'),h=r.find(".gallery-layout"),i=h.find(".gallery-layout-container"),k=h.find(".white-out"),A=i.width(),q=null,m=null,p=null,v=null,u=null,j=null;this.init=function(){if(this.settings.initPromptMediaType=="image"||this.settings.initPromptMediaType=="video"){this.addNewGalleryItem(this.settings.initPromptMediaType);this.setDisplayTemplate()}else if(this.settings.initFromGalleryItemsObjects.length>0)this.addGalleryItems(this.settings.initFromGalleryItemsObjects,this.settings.initWithLayoutIndex,this.settings.imageTitleUrlBase,true);else this.setDisplayTemplate(0)};this.initGalleryMode=function(){q=i.find(".galContentContainer"),m=i.find(".galContent").empty(),j=i.find(".white-out");p=i.find(".galBottom .items").empty(),v=i.find(".nav-leftright .left"),u=i.find(".nav-leftright .right");if(g<=0||g>=f.settings.galleryItems.length)g=0;for(var b="",a=0;a<f.settings.galleryItems.length;a++)b+=f.getGalleryItemThumbnail(a);p.append(b);p.find(".itemLink").on({"click.whtGallery":f.onItemThumbnailClick});v.on({"click.whtGallery":f.onLeftClick});u.on({"click.whtGallery":f.onRightClick});f.setActiveGalleryItem(g,true)};this.addNewGalleryItem=function(d){var c=this;switch(d){case"image":c._bIsPromptingForNewContent=true;b.Images.CreatePreviewImageUploader({imagePreviewUploadOptions:{uploadType:"GalleryImage",isUploadToIDOptional:true,uploadToID:null},uploadifyOptions:{onResponse:function(b,a){c.onImageUploadResponse(b,a)}},cropOptions:{enabled:true,minSize:[533,32],minSizeToCrop:[533,32],onResponse:function(b,a){c.onImageUploadResponse(b,a)}},ajaxDialogOptions:{beforeClose:function(){c._bIsPromptingForNewContent&&setTimeout(function(){c.onAddItemPromptClosedWithoutResponse("image")},1)}}});break;case"video":c._bIsPromptingForNewContent=true;b.createAjaxDialog({URL:b.BuildAJAXUrl("GetAddVideoEmbedForm"),Title:"Embed Video",Width:500,ContainerID:"addVideoEmbedContainer",onSuccess:function(){},onOpen:function(){this.oCalledFrom=c;a("#addVideoEmbedContainer").data("call-back-gallery",c)},beforeClose:function(){c._bIsPromptingForNewContent&&setTimeout(function(){c.onAddItemPromptClosedWithoutResponse("video")},1)}})}};this.getActiveLayoutIndex=function(){return n};this.getActiveGalleryItem=function(){return f.settings.galleryItems[~g&&g<f.settings.galleryItems.length?g:0]};this.getActiveGalleryItemThumbnail=function(){return f.getGalleryItemThumbnail(~g&&g<f.settings.galleryItems.length?g:0)};this.getGalleryItemThumbnail=function(c){var a=f.settings.galleryItems[c],d=[];if(a)d=[a.galleryItemType,c,a.galleryItemType==="Video"?a.thumbSource===""||a.thumbSource===null?"/images/video_no_thumb.png":b.ImgUrl.toFormat(a.thumbSource,"88x68"):b.ImgUrl.toFormat(a.src,"88x68",a.imageTitleUrlBase),c===g?" active":"",a.galleryItemType==="Video"?'<span class="video-thumb"></span>':""];return y.replace(/\{(\d+)\}/g,function(b,a){return d[a]})};this.getThumbnailContainer=function(){return p};this.getEditorHeadline=function(){var a=this.settings.galleryItems.length;return a<1?"Attach a new "+this.settings.initPromptMediaType:a==1?this.settings.galleryItems[0].galleryItemType=="Image"?"Image Options":"Add This "+this.settings.galleryItems[0].galleryItemType+" to a Gallery?":"Edit Gallery"};this.getEditorMenu=function(){var e=this.settings.galleryItems.length,j=false,h='<div class="share-tip-body-edit-caption hide"><div class="share-tip-section clearfix"><span class="lbl">Caption</span><span class="mgt-small"><textarea name="txtImgCaption" id="txtImgCaption"></textarea></span></div><div class="share-tip-section last clearfix"><span class="lbl">Credit Text</span><input type="text" name="txtImgCreditText" id="txtImgCreditText"/><span class="lbl mgt-small">Credit URL</span><input type="text" name="txtImgCreditURL" id="txtImgCreditURL"/><a href="javascript:// OK" class="btn fr silver std mgt-small gallery-btn-caption-ok">OK</a><a href="javascript:// Cancel" class="btn fl silver std mgt-small gallery-btn-caption-cancel">Cancel</a></div></div>';if(e<1)return'<div class="share-tip-body-main"><div class="share-tip-section last clearfix"><span class="lbl">Please choose the '+this.settings.initPromptMediaType+" you would like to attach.</span></div></div>"+h;if(e==1){var g='<div class="share-tip-body-main">';if(this.settings.galleryItems[0].galleryItemType=="Image"){g+='<div class="share-tip-section clearfix"><a href="javascript:// Toggle Image Drop-Shadow" class="btn fl silver std gallery-btn-shadow-'+String(this.settings.galleryItems[0].shadow?"off":"on")+'">Toggle Image Drop-Shadow '+String(this.settings.galleryItems[0].shadow?"Off":"On")+"</a></div>";if(b.loggedInUser.IsStaff)g+='<div class="share-tip-section clearfix"><a href="javascript:// Credits" class="btn fl silver std gallery-btn-toggle-caption">Edit Credits/Caption</a></div>'}g+='<div class="share-tip-section last clearfix"><span class="lbl">Group additional images &amp; videos together with this '+this.settings.galleryItems[0].galleryItemType.toLowerCase()+' to create a gallery.</span><a href="javascript:// Add New Image" class="btn fl silver std mgt-small gallery-btn-new-image">+ Image</a><a href="javascript:// Add New Video" class="btn fl silver std mgt-small mgl-small gallery-btn-new-video">+ Video</a><a href="javascript:// Delete" class="btn fr silver std mgt-small gallery-btn-delete tooltip" title="Delete this item from the gallery">X</a></div>';return g+"</div>"+h}for(var a=0;a<this.settings.galleryItems.length;a++)if(this.settings.galleryItems[a].galleryItemType=="Video"){j=true;break}var c='<div class="share-tip-body-main"><div class="share-tip-section galleryLayoutTipSection"><span class="lbl">Layout</span><div class="gallery-layout-select clearfix">';if(e<6&&!j)for(var a=0;a<o[e].length;a++)if(o[e][a]=="gallery")c+='<div class="gallery-layout-container fl mgr-smaller mgt-smaller'+String(a==n?" active":"")+'" data-template-index="'+String(a)+'">'+t+"</div>";else c+='<div class="gallery-layout-container fl mgr-smaller mgt-smaller'+String(a==n?" active":"")+'" data-template-index="'+String(a)+'">'+o[e][a].replace(/\{(\d+)\}/g,"")+"</div>";else{c+='<div class="gallery-layout-container fl mgr-smaller mgt-smaller active" data-template-index="0">'+t+"</div>";c+='<div class="fl" style="color:#999;padding:5px;width:200px;font-style:italic;"><strong>Note:</strong> Additional layout choices are available for image-only galleries with up to 5 images.</div>'}c+="</div></div>";c+='<div class="share-tip-section last galleryItemManagementSection"><span class="lbl">Manage Gallery Images &amp; Videos</span><div class="gallery-item-list clearfix">';for(var a=0;a<e;a++){var d=f.settings.galleryItems[a],i="/images/video_no_thumb.png";switch(d.galleryItemType){case"Video":if(d.thumbSource!=""&&d.thumbSource!=null)i=b.ImgUrl.toFormat(d.thumbSource,"88x68");break;case"Image":if(d.src!=""&&d.src!=null)i=b.ImgUrl.toFormat(d.src,"88x68",d.imageTitleUrlBase)}var k=b.loggedInUser.IsStaff?'<span class="gallery-btn edit"></span>':'<span class="gallery-btn edit" style="display:none;"></span>';c+=String('<div class="gallery-item fl mgr-small mgt-small" data-index="{0}"><img src="{1}" width="82" height="62" alt=""><span class="gallery-btn left"></span><span class="gallery-btn right"></span>'+k+'<span class="gallery-btn delete"></span></div>').replace(/\{(\d+)\}/g,function(c,b){return b==0?a:i})}c+='<div class="gallery-add-new fl mgr-small mgt-small"><a href="javascript:// Add New Image" class="btn silver med gallery-btn-new-image">+ Image</a><a href="javascript:// Add New Video" class="btn silver med gallery-btn-new-video">+ Video</a></div>';c+="</div></div></div>"+h;return c};this.setDisplayTemplate=function(a,c,d){if(a==null){a=n;c=true}a=a<o[this.settings.galleryItems.length<6?this.settings.galleryItems.length:6].length?a:0;for(var b=0;b<this.settings.galleryItems.length;b++)if(this.settings.galleryItems[b].galleryItemType=="Video"){a=0;break}if(a!=n||c){n=a;s=o[this.settings.galleryItems.length<6?this.settings.galleryItems.length:6][n];this.initDisplayTemplate(d)}};this.initDisplayTemplate=function(b){i.find("img").off("load");h.css("overflow","hidden");h.height(h.height());var c=function(){if(h._bInited!==true){if(h.height()<200)if(b)h.height(200);else h.animate({height:200},{queue:false,duration:100});h._bInited=true}if(k._iShowTimer!=null){clearTimeout(k._iShowTimer);k._iShowTimer=null}k._iShowTimer=setTimeout(function(){k._iShowTimer=null;k.find("div").fadeIn("fast")},250);i.empty();if(s=="gallery"){i.html(z);f.initGalleryMode()}else{var d=[],c=null;if(f.settings.galleryItems.length==1){c=f.settings.galleryItems[0];if(c.galleryItemType!="Image"){d.push(f._getGalleryItemHtmlTag(c));d.push("wf video-loading")}else{d.push(f._getGalleryItemHtmlTag(c,"auto"));d.push(c.shadow?"wa img-shadow":"wa")}}else for(var j=0;j<f.settings.galleryItems.length;j++){c=f.settings.galleryItems[j];d.push(f._getGalleryItemHtmlTag(c))}i.html(s.replace(/\{(\d+)\}/g,function(b,a){return d[a]}))}var g=i.find("img"),e=g.length;if(e>0)g.each(function(){a(this).one("load",function(){e--;if(e==0){g.off("load");f.onLayoutPreloaded(b)}}).each(function(){this.complete&&a(this).trigger("load")}).error(function(){e--;if(e==0){g.off("load");f.onLayoutPreloaded(b)}})});else f.onLayoutPreloaded(b)};this.triggerContentChanged();if(b){k.show();c()}else k.fadeIn("fast",c)};this.onLayoutPreloaded=function(e){var g=h.find(".gal-row").each(function(){var b=a(this),h=false;if(b.find(".gal-row").length>0)h=true;else if(b.parents(".gal-row").length>0)return;var i=9999999999,j=9999999999,c=1,e=function(){var c=a(this),e=f.settings.galleryItems[c.data("index")],h=c.find("img"),b=A,d=h.width()||h[0]&&h[0].naturalWidth||0,g=h.height()||h[0]&&h[0].naturalHeight||0;if((e.width==null||e.width<=0)&&d>0)e.width=d;if((e.height==null||e.height<=0)&&g>0)e.height=g;var i=a(c.children().first().parentsUntil(".gallery-layout-container").get().reverse());i.each(function(){var e=a(this);if(e.hasClass("gal-wa")&&d<b)b=d;else if(e.hasClass("gal-w2"))if(e.next().length==0&&Math.floor((b-l)/2)!=Math.ceil((b-l)/2))b=b-l-Math.floor((b-l)/2);else b=Math.floor((b-l)/2);else if(e.hasClass("gal-w3"))if(e.next().length==0&&Math.floor((b-l)/2)!=Math.ceil((b-l)/2))b=b-l*2-Math.floor((b-l*2)/3)*2;else b=Math.floor((b-l*2)/3);e.width(b);c.data("min-height",Math.min(d>=b?g:9999999999,Math.floor(g/d*b),c.data("min-height")==null?999999999:c.data("min-height")));c.data("max-height",Math.max(g,Math.ceil(g/d*b),c.data("max-height")==null?1:c.data("max-height")));var h=c.data("min-height"),f=c.data("max-height")})},g=function(){var b=a(this),d=b.data("min-height"),e=b.data("max-height");c=Math.max(c,d)};b.find("figure").each(e).each(g);b.is("figure")&&b.each(e).each(g);var d=c;b.data("row-height",d);if(!h){b.find("img").css({width:"auto",height:String(d)+"px"}).each(function(){var b=a(this);b.css("margin-left","-"+String(Math.ceil(((b.width()||b[0].naturalWidth)-(b.parent().is("figure")?b.parent().width():b.parent().parent().width()))/2)+"px"))});b.find("object,embed").css({height:String(d)+"px"})}});if(k._iShowTimer!=null){clearTimeout(k._iShowTimer);k._iShowTimer=null}k.find("div").hide();k.fadeOut("fast");var b=i.height();if(b<=0){var d=i.html();c.test(d)&&d.replace(c,function(){b=Number(arguments[1]);return""})}if(e){h.height(b);h.css("overflow","visible");f.triggerGalleryLoaded()}else h.animate({height:b},{queue:false,duration:100,complete:function(){h.css("overflow","visible");f.triggerGalleryLoaded()}})};this.triggerGalleryLoaded=function(){var b=a.Event("galleryLoaded");b.gallery=f;r.trigger(b)};this.triggerContentChanged=function(){var b=a.Event("contentChanged");r.trigger(b)};this.triggerGalleryItemChanged=function(){var b=a.Event("galleryItemChanged");r.trigger(b)};this.triggerGalleryEmptied=function(){var b=a.Event("galleryEmptied");r.trigger(b)};this.getCropScaleRanges=function(){};this.setActiveGalleryItem=function(b,d){if(b=="left")b=g>0?g-1:this.settings.galleryItems.length-1;else if(b=="right")b=g<this.settings.galleryItems.length-1?g+1:this.settings.galleryItems.length>=0?0:-1;else if(String(b)=="NaN")b=g;if(b==g&&d!==true)return;g=b;p.find("span.active").toggleClass("active",false);p.find("span.galleryItemIndex"+b).toggleClass("active",true);var c=f.settings.galleryItems[g];if(d===true){m.html(f._getGalleryItemHtmlTag(c,m.width()));return}q.height(q.height());j.fadeIn(100,function(){if(j._iShowTimer!=null){clearTimeout(j._iShowTimer);j._iShowTimer=null}j._iShowTimer=setTimeout(function(){j._iShowTimer=null;j.find("div").fadeIn("fast")},250);m.empty();m.html(f._getGalleryItemHtmlTag(c,m.width()));var d=function(){if(j._iShowTimer!=null){clearTimeout(j._iShowTimer);j._iShowTimer=null}j.find("div").hide();j.fadeOut(200);var a=m.height(),b=a-q.height();q.animate({height:a},{queue:false,duration:100});h.animate({height:h.height()+b},{queue:false,duration:100,complete:function(){f.triggerGalleryItemChanged()}})};if(c.galleryItemType=="Image"){var e=m.find("img"),b=e.length;if(b>0)e.each(function(){a(this).one("load",function(){b--;if(b==0){e.off("load");d()}}).each(function(){this.complete&&a(this).trigger("load")})});else d()}else d()})};this._getGalleryItemHtmlTag=function(a,b){if(typeof b==="undefined")b=h.width();switch(a.galleryItemType){case"Video":var e=a.embedTag;if(typeof b==="number"&&b>0){var l=a.width>0?a.width:b,k=a.height>0?a.height:300,o=b/l,m=Math.ceil(k*o);e=e.replace(d,'width="'+b+'"');e=e.replace(c,'height="'+m+'"')}return e;case"Image":var g=f.settings.editMode?"":'<a href="'+a.oImgUrl.toString("original")+'" rel="nofollow" target="_blank">',i=f.settings.editMode?"":"</a>";if(typeof b==="number"&&b>0){var n=a.width>0?a.width:b,j=a.height>0?a.height:"auto";if(j=="auto")return g+'<img src="'+a.oImgUrl.toString()+'" style="width:'+b+'px;height:auto;" alt=""/>'+i;else{var q=b/n,p=Math.ceil(j*q);return g+'<img src="'+a.oImgUrl.toString()+'" width="'+b+'" height="'+p+'" alt=""/>'+i}}return g+'<img src="'+a.oImgUrl.toString()+'" alt="" style="width:auto;max-width:'+h.width()+'px;"/>'+i}return"<div>[Invalid Gallery Item Type. Are You Missing a Plugin?]</div>"};this.addGalleryItems=function(d,e,f,g){for(var c=0;c<d.length;c++){var a=d[c];if(this.settings.baseEditor){this.settings.baseEditor.getMatchedEmbedList().push(decodeURIComponent(a.videoLink||a.largeSource||a.standardSource||a.thumbSource));this.settings.baseEditor.getLoadedEmbedList().push(decodeURIComponent(a.videoLink||a.largeSource||a.standardSource||a.thumbSource))}switch(a.type){case"galleryVideo":this.appendGalleryItem(new b.WHTGalleryVideo({videoLink:decodeURIComponent(a.videoLink).replace(/\s/g,"%20"),embedTag:decodeURIComponent(a.embedTag),thumbSource:decodeURIComponent(a.thumbSource).replace(/\s/g,"%20"),caption:decodeURIComponent(a.caption),creditUrl:decodeURIComponent(a.creditURL).replace(/\s/g,"%20"),creditText:decodeURIComponent(a.creditText)}));break;case"galleryImage":this.appendGalleryItem(new b.WHTGalleryImage({src:decodeURIComponent(a.largeSource||a.standardSource||a.thumbSource).replace(/\s/g,"%20"),width:a.largeSource?a.largeWidth:a.standardWidth,height:a.largeSource?a.largeHeight:a.standardHeight,caption:decodeURIComponent(a.caption),creditUrl:decodeURIComponent(a.creditURL).replace(/\s/g,"%20"),creditText:decodeURIComponent(a.creditText),originalUrl:decodeURIComponent(a.originalUrl).replace(/\s/g,"%20"),shadow:a.shadow?a.shadow:false,scale:a.scale?a.scale:0,imageTitleUrlBase:f||a.imageTitleUrlBase||""}))}}this.setDisplayTemplate(e,null,g)};this.appendGalleryItem=function(a){this.settings.galleryItems.push(a);this.setDisplayTemplate()};this.removeGalleryItem=function(a,b){if(!b&&!confirm("Are you sure you want to delete this "+this.settings.galleryItems[a].galleryItemType.toLowerCase()+"?"))return;this.settings.galleryItems.splice(a,1);this.setDisplayTemplate();this.settings.galleryItems.length==0&&this.triggerGalleryEmptied()};this.reOrderGalleryItem=function(b,a){if(b<0||b>this.settings.galleryItems.length)return;if(a>this.settings.galleryItems.length-1)a=0;else if(a<0)a=this.settings.galleryItems.length-1;if(b==a)return;var c=this.settings.galleryItems[a];this.settings.galleryItems[a]=this.settings.galleryItems[b];this.settings.galleryItems[b]=c;this.setDisplayTemplate()};this.showCaptionEditorForItem=function(a,c){var b=this.settings.galleryItems[c];a.find(".share-tip-body-main").hide();a.find(".share-tip-body-edit-caption").show();a.find("#txtImgCaption").val(b.caption).focus();a.find("#txtImgCreditText").val(b.creditText);a.find("#txtImgCreditURL").val(b.creditUrl);a.find(".gallery-btn-caption-ok").data("for-gal-index",c)};this.editGalleryItem=function(c,f,g){if(g){var a=c.find("#txtImgCreditURL").val().trim(),d=c.find("#txtImgCreditText").val().trim(),h=c.find("#txtImgCaption").val().trim();if(e.test(d))if(a==""){a=d;d=""}else{b.Alerts.DisplayErrorNotification("Please don't use a URL as your Credit Text");return}else if(a!=""&&!e.test(a)){b.Alerts.DisplayErrorNotification("Invalid Credit URL");return}else if(a!=""&&a.toLowerCase().indexOf("http://")!=0&&a.toLowerCase().indexOf("https://")!=0)a="http://"+a;this.settings.galleryItems[f].caption=h;this.settings.galleryItems[f].creditText=d;this.settings.galleryItems[f].creditUrl=a}c.find(".share-tip-body-edit-caption").hide();c.find(".share-tip-body-main").show()};this.toggleImageShadow=function(a,b){if(this.settings.galleryItems[a].shadow!=b){this.settings.galleryItems[a].shadow=b==true;this.setDisplayTemplate()}};this.destroy=function(){};this.onLeftClick=function(a){f.setActiveGalleryItem.apply(f,["left",a])};this.onRightClick=function(a){f.setActiveGalleryItem.apply(f,["right",a])};this.onItemThumbnailClick=function(b){f.setActiveGalleryItem.apply(f,[Number(a(this).data("index")),b])};this.onImageUploadResponse=function(d,e){f._bIsPromptingForNewContent=false;a("#"+e).dialog("close");if(d.Error!=null){b.Alerts.DisplayErrorNotification(d.Error.ErrorText);return}var c=d.Response.Value,g=new b.WHTGalleryImage(b.ImgUrl.toImgID(c.ImageID)+".jpg",c.OriginalWidth,c.OriginalHeight,"",c.CreditUrl,"",c.OriginalWebUrl,c.OriginalWidth<532,0);this.appendGalleryItem(g)};this.onVideoEmbedResponse=function(d){f._bIsPromptingForNewContent=false;if(d.Error!=null){b.Alerts.DisplayErrorNotification(d.Error.ErrorText);return}var c=d.Response.Value;if(c.rssItems){var e=a.map(c.rssItems,function(b){b.links=a.map(b.links,function(a){return a.MediaType&&a.MediaType.indexOf("audio")>-1?a:null});return b.links&&b.links.length==1?{title:encodeURIComponent(b.title),URL:b.links[0].Uri}:null});b.createAjaxDialog({URL:b.BuildAJAXUrl("GetPodcastSelectorForm",{Podcasts:JSON.stringify(e)}),Title:"Select Podcast",Width:500,ContainerID:"selectPodcastContainer",onOpen:function(){f.oCalledFrom=f;a("#selectPodcastContainer").data("call-back-gallery",f)},beforeClose:function(){f._bIsPromptingForNewContent&&setTimeout(function(){f.onAddItemPromptClosedWithoutResponse("video")},1)}})}else{var g=new b.WHTGalleryVideo(c.videoLink,c.embedTag,b.ImgUrl.toImgID(c.thumbSource)+".jpg","",c.creditUrl,"");this.appendGalleryItem(g)}};this.onAddItemPromptClosedWithoutResponse=function(){f._bIsPromptingForNewContent=false;f.settings.galleryItems.length==0&&this.triggerGalleryEmptied()}};a.fn.whtGallery=function(c){return this.each(function(){var d=a(this);if(d.data("whtGallery"))return d.data("whtGallery");var e=new b.WHTGallery(d,c);d.data("whtGallery",e);e.init()})}})(window.WHT=window.WHT||{},jQuery);(function(b,a){b.EditorBlock.BlockTypes.EBCodeEditor=b.EditorBlock.extend({EB_TYPE:"EBCodeEditor",IS_TEXT:true,CAN_MERGE_WITH_TWIN:true,CAN_HAVE_TWIN_NEIGHBOR:true,CAN_SPLIT:false,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to enter code...</span>',multiLine:true},minimumHeights:[22,154],init:function(e,d){this.blockID=b.EditorBlock.BlockID++;this.self=this;this.baseEditor=e;this.txtElement=null;this.baseElement=null;var c={};a.extend(true,c,this.settings);d&&a.extend(true,c,d);this.settings=c;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){a.error("!!!.split() not implemented by this EBWealthyParagraph")},merge:function(b){console.log("Merge with xml:"+b);a.error("!!!.merge() not implemented by this EBWealthyParagraph")},setHtml:function(a){this.codeEditor.setValue(a)},onMenuButtonClick:function(){return false},xml:function(b){if(b!=null&&typeof b==="string"){b=a.trim(b);var d="";if(b.indexOf("<DocPart")!=0&&b.indexOf("<HtmlText")!=0)d=b;else try{var c=a(a.parseXML(b).firstChild),e=c.first()[0].nodeName=="DocPart"?c.first():c;d=c.first()[0].nodeName=="HtmlText"?c.first().xml():c.xml()}catch(f){console.log("Error Parsing XML for CodeEditor:\n"+b);console.dir(f)}this.setHtml(d)}var d=a.trim(this.codeEditor.getValue());return d==""?"":'<DocPart PartType="CodeBlock" id="docPartTxt'+this.blockID+'" Mode="'+this.codeEditor.getOption("mode")+'"><HtmlText>'+d+"</HtmlText></DocPart>"},isEmpty:function(){return a.trim(this.codeEditor.getValue())==""},getSelectionRange:function(){return this.codeEditor.getSelection()},onGotFocus:function(){this.codeEditor&&this.codeEditor.focus()},onLostFocus:function(){},onKeyUp:function(){},onKeyDown:function(a){switch(a.keyCode||a.which){case 8:if(this.isEmpty()){this.triggerDeleteBlock();return false}}return true},_build:function(){if(this.baseElement!=null)return;this.baseElement=a('<div id="EBCE'+this.blockID+'" class="CodeMirror-wrapper editorBlock" >').appendTo(this.baseEditor.divEditorBlocks).data("blockID",this.blockID);this.txtElement=a('<textarea id="EBTA'+this.blockID+'"></textarea>').appendTo(this.baseElement);var c=this;a.when(a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/javascript/javascript.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/clike/clike.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/css/css.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/xml/xml.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/htmlmixed/htmlmixed.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/php/php.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/python/python.js"),a.cachedScript(b.imgUrlBase+"/js/libs/codemirror/mode/ruby/ruby.js")).done(function(){c.codeEditor=CodeMirror.fromTextArea(c.txtElement[0],{gutter:true,fixedGutter:true,lineNumbers:true,mode:"javascript",theme:"ambiance",onFocus:function(){c.baseEditor.setFocusedBlock(c)},onKeyEvent:function(b,a){if(a.type==="keyup")c.onKeyUp(a);else if(a.type==="keydown")c.onKeyDown(a)}});var d=CodeMirror.listModes().sort(),f="<select>";for(var e in d)if(d.hasOwnProperty(e)&&d[e]!=="null"){var b=d[e].capitalize();if(b=="Clike")b="C/C++/C#";if(b=="Htmlmixed")b="HTML";if(b=="Css"||b=="Php"||b=="Xml")b=b.toUpperCase();f+='<option value="'+d[e]+'"'+(d[e]==c.codeEditor.getOption("mode")?' selected="selected"':"")+">"+b+"</option>"}f+="</select>";c.defaultSidebarTip={sHeadline:"Editing Code",sBodyTemplate:'<div class="share-tip-section last clearfix"><span class="lbl mgb-smaller">Select Code Language:</span>'+f+"</div>",oForBlock:c,bindEvents:function(b){b.on("change","select",function(){var b=a(this);c.codeEditor.setOption("mode",b.val())})}};c.codeEditor.focus();c.baseEditor._showDefaultSidebarTip()})},_initEvents:function(){var a=this}})})(window.WHT=window.WHT||{},jQuery);(function(b,a){b.EditorBlock.BlockTypes.EBLink=b.EditorBlock.extend({EB_TYPE:"EBLink",IS_TEXT:true,CAN_SET_SELECTION:false,CAN_MERGE_WITH_TWIN:false,CAN_HAVE_TWIN_NEIGHBOR:true,CAN_SPLIT:false,ATTACHMENT_MODE:b.EditorBlock.AM_APPEND_BOTTOM,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click enter a link...</span>',multiLine:false},minimumHeights:[22,154],init:function(e,d){this.blockID=b.EditorBlock.BlockID++;this.self=this;this.baseEditor=e;this.txtElement=null;this.baseElement=null;this.rxMatchURLExact=/^(?:(?:https?|ftp):\/\/)?(?:[A-Z0-9](?:[-A-Z0-9.]*))(?:\.[a-z]{2,4}(?::[0-9]+)?)((?:\/|\?|#)(?:(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$?!:,.])$|(?:\/|\?|#)$|$)/i;this.errorContainer={};this.attachmentInfo={URL:"",Title:"",Description:"",Images:[],SelectedImage:""};var c={};a.extend(true,c,this.settings);d&&a.extend(true,c,d);this.settings=c;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){a.error("!!!.split() not implemented by this EBWealthyParagraph")},setHtml:function(){},onMenuButtonClick:function(){return false},xml:function(c){if(c!=null){var d={};if(typeof c==="string"){c=a.trim(c);if(!(c.indexOf("<DocPart")!=0&&c.indexOf("<Link")!=0&&self.rxMatchURLExact.text(c)))try{var e=a(a.parseXML(c).firstChild);console.dir(e);var h=e.first()[0].nodeName=="DocPart"?e.first():e;sHtml=e.first()[0].nodeName=="Link"?e.first().xml():e.xml()}catch(i){console.log("Error Parsing XML for EBLink:\n"+c);console.dir(i)}}else if(typeof c==="object")if(c.type=="attachedLinkBlock"){d.URL=c.url||"";d.Title=c.title||"";d.Description=c.description||"";if(c.imgsrc){var f=new b.ImgUrl(c.imgsrc,"w240");console.dir(f);if(f.isValid&&f.toString()!=""){d.Images=[f.toString()];console.dir(d.Images)}else d.Images=[c.imgsrc]}else d.Images=[]}else if(c.URL&&c.Title){d.URL=c.URL||"";d.Title=c.Title||"";d.Description=c.Description||"";d.Images=[];if(c.Images&&c.Images.length>0)for(var g=0;g<c.Images.length;g++)d.Images.push(c.Images[g])}d.URL&&d.Title&&this._initLinkPreview(d)}return this.txtTitle&&this.attachmentInfo.URL?'<DocPart PartType="AttachedLink" id="docPartTxt'+this.blockID+'" ><Link href="'+encodeURIComponent(this.attachmentInfo.URL)+'" title="'+encodeURIComponent(b.EncodeEntities(this.txtTitle.val().trim()))+'" imgsrc="'+encodeURIComponent(this.attachmentInfo.SelectedImage)+'" description="'+encodeURIComponent(b.EncodeEntities(this.txtDescription.val().trim()))+'" /></DocPart>':""},blockIndex:function(){a.error("!!!.blockIndex() not implemented by this EBWealthyParagraph")},isEmpty:function(){return this.attachmentInfo.URL==""},getSelectionRange:function(){a.error("!!!.getSelectionRange() not implemented by this EBWealthyParagraph")},setSelection:function(){a.error("!!!.setSelection() not implemented by this EBLink")},onGotFocus:function(){this.txtElement[0].focus()},onLostFocus:function(){},onKeyPress:function(a){switch(a.keyCode||a.which){case 13:if(!this.displayWrapper){a.preventDefault();this.addLinkButton.click()}}return true},onKeyDown:function(a){switch(a.keyCode||a.which){case 8:if(this.txtElement.val()==""){this.triggerDeleteBlock();return false}}return true},onMenuButtonClick:function(){return true},addLinkClick:function(e,c){var d=a(this);if(d.hasClass("disabled"))return false;d.addClass("disabled");a.post(b.BuildAJAXUrl("GetLinkAttachment"),{url:c.txtElement.val()},function(e){if(e.Error==null){var b=e.Response.Value;if(typeof b.embedTag!=="undefined"&&b.embedTag.length>0){var f=c.baseEditor.attachBlockWithDefaultOptions("EBGallery");f.gal.onVideoEmbedResponse(e);c.baseEditor.deleteBlock(c)}else{c.errorContainer&&c.errorContainer.length>0&&c.errorContainer.hide();c._initLinkPreview(b,d)}}else if(c.errorContainer&&c.errorContainer.length>0)c.errorContainer.show();else{c.errorContainer=a('<div class="field-validation-error clear mgl txt-bld" style="background: #FF9; padding: 5px 5px 5px 10px;">Could not load url.</div> ').appendTo(c.baseElement);c.addLinkButton.removeClass("disabled")}})},_build:function(){if(this.baseElement!=null)return;this.baseElement=a('<div id="EBL'+this.blockID+'" class="wteLinkWrapper editorBlock txt-left clearfix">').appendTo(this.baseEditor.divEditorBlocks).data("blockID",this.blockID).data("editorBlock",this);var b='<div class="loading-element mgt txt-center hide"><img src="/images/ajax-loader.gif"/></div><div class="editorWrapper"> <span class="attachBtn attachLink fl" style="cursor: default; margin: 10px 7px 0 10px;"></span><input id="EBLtxt'+this.blockID+'" class="wteLink mgb-smaller fl mgt-smaller" type="text" /><div class="btn med silver mgl-small fl" id="EBLbtn'+this.blockID+'" style="margin-top: 3px;">Add</div><span class="txt-clr-lighter txt-shadow-btm-med txt-size-normal fl mgl-med btn mgt-small txt-bld delbtn">X</span></div>';a(b).appendTo(this.baseElement);this.txtElement=this.baseElement.find("#EBLtxt"+this.blockID);this.addLinkButton=this.baseElement.find("#EBLbtn"+this.blockID);this.loadingElement=this.baseElement.find(".loading-element")},_initEvents:function(){var a=this;a.baseElement.on("focus.whtPostEditor","textarea,input",function(){a.triggerFocusThisBlock()});a.txtElement.on({"keypress.whtPostEditor":function(b){return a.onKeyPress(b)},"keydown.whtPostEditor":function(b){return a.onKeyDown(b)}});a.baseElement.on("click","#EBLbtn"+a.blockID,function(b){a.addLinkClick.apply(this,[b,a])});a.baseElement.on("click",".delbtn",function(){a.triggerDeleteBlock.apply(a)})},_removeImageFromList:function(d,c){for(var a=c.attachmentInfo.Images.slice(0),b=0;b<a.length;b++)a[b]==d&&a.splice(b,1);c.attachmentInfo.Images=a},_initLinkPreview:function(c,e){var b=this;b.baseElement.find(".editorWrapper").hide();b.loadingElement.show();b.attachmentInfo=a.extend(b.attachmentInfo,c);var d='<div class="displayWrapper hide clearfix" style="padding:5px 10px 10px;"><span class="txt-clr-lighter txt-shadow-btm-med txt-size-normal fr btn txt-bld delbtn">X</span><input class="wteLinkTitle" id="EBLtxtTitle'+b.blockID+'" type="text" value=""/><div class="slider fl mgr featured-content-slider-container" style="width:150px;"><div class="gallery-navigate previous fl btn small" style="top:0;"></div><div class="items">';if(c.Images&&c.Images.length>0){var f="";for(var g in c.Images)if(c.Images.hasOwnProperty(g))f+='<div class="fl txt-center" style="width:150px;"><img src="'+c.Images[g].replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")+'" style="max-width: 150px;height:auto;"/></div>';d+=f}d+='</div><div class="gallery-navigate next fr btn small" style="top:0;"></div></div><div class="fl wteLinkDescription"><textarea id="EBLtxtDesc'+b.blockID+'" class="wteLinkDescription"></textarea></div></div>';b.displayWrapper&&b.displayWrapper.length>0&&b.displayWrapper.remove();b.displayWrapper=a(d).appendTo(b.baseElement);b.attachmentInfo.TotalImagesCount=b.attachmentInfo.Images.length;b.attachmentInfo.LoadedImages=0;b.attachmentInfo.MaxHeight=25;if(b.attachmentInfo.TotalImagesCount<1)b._showDisplayWrapper(b,e);else b.displayWrapper.find("img").each(function(){a(this).one("load",function(){b.attachmentInfo.LoadedImages++;var c=a(this),f=c[0].width>0?c[0].width:c[0].naturalWidth,d=c[0].height>0?c[0].height:c[0].naturalHeight;if(f<88||d<20){b._removeImageFromList(c.attr("src"),b);c.parent().remove()}if(b.attachmentInfo.LoadedImages>=b.attachmentInfo.TotalImagesCount){b.displayWrapper.find("img").off("load");b._showDisplayWrapper(b,e)}}).each(function(){this.complete&&a(this).trigger("load")}).error(function(){b.attachmentInfo.LoadedImages++;var d=a(this),c=d.attr("src");console.error("ERROR Loading Image:",c);b._removeImageFromList(c,b);d.parent().remove();b.attachmentInfo.LoadedImages++;if(b.attachmentInfo.LoadedImages>=b.attachmentInfo.TotalImagesCount){b.displayWrapper.find("img").off("load");b._showDisplayWrapper(b,e)}})})},_showDisplayWrapper:function(c,d){c.displayWrapper.show();c.loadingElement.hide();c.txtTitle=c.displayWrapper.find("#EBLtxtTitle"+c.blockID);c.txtTitle.val(b.DecodeEntities(c.attachmentInfo.Title));c.txtDescription=c.displayWrapper.find("#EBLtxtDesc"+c.blockID);c.txtDescription.val(b.DecodeEntities(c.attachmentInfo.Description));c.txtDescription.autogrow();if(c.attachmentInfo.Images&&c.attachmentInfo.Images.length>0){c.displayWrapper.find("img").each(function(){var b=a(this);c.attachmentInfo.MaxHeight=b[0].height>c.attachmentInfo.MaxHeight?b[0].height:c.attachmentInfo.MaxHeight});c.imageSlider=c.displayWrapper.find(".slider").height(c.attachmentInfo.MaxHeight);if(!c.imageSlider.data("scrollable")){c.imageSlider.scrollable({prev:".previous",clickSpeed:50,itemCount:1});c.imageSlider.scrollable().onSeek(function(g,h){var d=g.currentTarget,e=a(d.getItems().get(h)),b=e.find("img"),f=b.height()>75?b.height():75;c.imageSlider.animate({height:f},50);c.attachmentInfo.SelectedImage=b.attr("src")});c.imageSlider.scrollable().seekTo(0)}if(c.attachmentInfo.Images&&c.attachmentInfo.Images.length==1||c.displayWrapper.find(".slider .items img").length==1){c.displayWrapper.find(".gallery-navigate").hide();c.attachmentInfo.SelectedImage=c.displayWrapper.find(".slider .items img").attr("src")}}else{c.displayWrapper.find(".slider").hide();c.txtDescription.width("100%").parent().width("100%")}d&&d.length>0&&d.removeClass("disabled")}})})(window.WHT=window.WHT||{},jQuery);WHT.Comments=new function(){var a=this;a.commentContainerList=[];a.commentList=[];a.commentsDocX=[];a.templates={hiddenResponsesTemplate:"<p class='btn hiddenResponsesBtn txt-lbl txt-size-small upcase txt-clr-link-dark'> Click to View <em class='txt-size-normal txt-clr-dark'>{0}</em> more hidden responses</a></p>"};a.hiddenResponsesList=[];a.init=function(c){$.extend(this,c);a._cacheElements();a._setupHandlers();for(var b=0;b<a.commentList.length;b++){(a.commentList[b].CommentScore<0||a.hiddenResponsesList.indexOf(a.commentList[b].ParentID)>-1)&&a.hiddenResponsesList.push(a.commentList[b].ID);a.ResetCommentCascadeLevel(a.commentList[b])}a.hiddenResponsesList.length>0&&a.$showHiddenResponsesBtn.html($.format(a.templates.hiddenResponsesTemplate,a.hiddenResponsesList.length));(a.commentList==null||a.commentList.length<1||a.hiddenResponsesList.length<1)&&this.$showHiddenResponsesBtn.hide();a.clonedAttachMenu=a.$responseEditorContainer.find(".attachMenu").clone();a.$responseEditorContainer.find(".textholder").append(a.clonedAttachMenu);a.clonedAttachMenu.find(".attachBtn").data("disableevent",true);WHT.OnElementReady(a.clonedAttachMenu);a.$responsesContainer.find(".response:last .separator").hide();a.$responseEditor.val("")};a._setupHandlers=function(){$(".edit-article-btn").click(function(){WHT.NavigateTo(a.editURL)});a.$responsesContainer.on("click",".vote-container .arrow",function(){if(currentlyVoting)return;currentlyVoting=true;var c=true,b=$(this).parent(),d=b.data("commentid");if($(this).hasClass("down"))c=false;if(!WHT.loggedInUser.IsUser){WHT.ShowLoginScreen("Login to vote on this comment:");currentlyVoting=false;WHT.AddDoAfterLoginCallback(function(){a.UpdateCommentScore({commentID:d,upvote:c,voteContainer:b})});return false}a.UpdateCommentScore({commentID:d,upvote:c,voteContainer:b})});a.$showHiddenResponsesBtn.click(function(){a.$responsesContainer.children(".response.hide").show("slow").removeClass("hide");a.$showHiddenResponsesBtn.hide()});a.$cancelCommentBtn.click(function(){a.ResetCommentEditor()});a.$responsesContainer.on("click",".replyBtn",function(e){e.preventDefault();var d=$(this),c=d.data("commentid");a.activateEditor();a.moveEditorBelowComment(c);a.$responseEditor.data("parentCommentID",c);a.hiddenSeparator&&a.hiddenSeparator.show();var b=a.$responseEditorContainer.prev(".response").find(".separator");if(b.length==1){a.hiddenSeparator=b;b.hide()}});a.$responsesContainer.on("click",".editCommentBtn",function(f){f.preventDefault();var e=$(this),c=e.data("commentid"),d=a.GetCommentDocXByID(c);if(d){a.GetCommentContainer(c).hide();a.activateEditor(d);a.moveEditorBelowComment(c);var b=a.$responseEditorContainer.prev().prev(".response").find(".separator");if(b.length==1){a.hiddenSeparator=b;b.hide()}}else WHT.Alerts.DisplayErrorNotification("There was an issue trying to edit this comment.")});a.$responsesContainer.on("click",".deleteCommentBtn",function(d){d.preventDefault();if(!confirm("Delete comment?"))return false;var c=$(this),b=c.data("commentid"),e=a.GetCommentContainer(b);if(!WHT.loggedInUser.IsUser){WHT.ShowLoginScreen("Login to delete this comment:");WHT.AddDoAfterLoginCallback(function(){a.DeleteComment({articleCommentID:b,worldURLName:WHT.currentWorld.UrlName})});return false}a.DeleteComment({articleCommentID:b,worldURLName:WHT.currentWorld.UrlName})});a.$responseEditorContainer.on("click",".textholder",function(){a.commentContainerList&&a.commentContainerList.length==0&&window.setTimeout(function(){a.commentsListHeader.hide();a.hiddenSeparator=a.$responseEditorContainer.prev().hide();a.commentEditorHeader.show()},0);a.activateEditor()})};a._cacheElements=function(){a.$showHiddenResponsesBtn=$(".hidden-responses");a.$responsesContainer=$("#responses");a.$responseEditor=$("#response");a.$responseEditor.data("defaultWidth",a.$responseEditor.width());a.$responseEditorContainer=$(".user-comment-editor");a.$responseEditorContainerShadow=a.$responseEditorContainer.next();a.commentsListHeader=$(".responses-wrapper .comments-list-header");a.commentEditorHeader=a.$responseEditorContainer.find(".comment-editor-header");a.$submitCommentBtn=$(".submitCommentBtn");a.$cancelCommentBtn=$(".cancelCommentBtn")};a.UpdateCommentScore=function(b){$.post(a.updateCommentScoreURL,{VideoID:0,ArticleID:WHT.Article.ArticleID,CommentID:b.commentID,PositiveVote:b.upvote},function(a){if(a.Error!=null){$.jGrowl(a.Error.ErrorText,{position:"center",life:6e3});currentlyVoting=false}else if(a.Response!=null&&a.Response.Value!=null){var d=b.upvote?".up":".down",c=b.upvote?".down":".up";b.voteContainer.find(d).removeClass("inactive").addClass("active");b.voteContainer.find(c).removeClass("active").addClass("inactive");$(".comment-score-"+a.Response.Value.CommentingUserID).text(a.Response.Value.NewUserCommentScore);b.voteContainer.find("span").text(a.Response.Value.Score);currentlyVoting=false}})};a.GetCommentDocXByID=function(d){for(var c=0;c<a.commentsDocX.length;c++){var b=a.commentsDocX[c];if(b&&b.commentID==d)return b}return null};a.GetCommentContainer=function(b){a.commentContainerList[b]=a.commentContainerList[b]||a.$responsesContainer.find("#comment-"+b);return a.commentContainerList[b]};a.DeleteComment=function(d){var b={articleCommentID:0,worldURLName:"www",videoCommentID:0};$.extend(b,d);var c=b.articleCommentID||b.videoCommentID;$.post(a.deleteCommentURL,{ArticleCommentID:b.articleCommentID,VideoCommentID:b.videoCommentID,WorldURLName:b.worldURLName},function(g){if(g.Error!=null){$.jGrowl(g.Error.ErrorText,{position:"center",life:6e3});return false}else{var f=[],e=[];c=parseInt(c);for(var d=0;d<a.commentList.length;d++){var b=a.commentList[d];if(b!=null&&(b.ParentID==c||b.ID==c||f.indexOf(b.ParentID)>-1)){f.push(b.ID);a.GetCommentContainer(b.ID).animate({backgroundColor:"#fb6c6c"},500,function(){$(this).slideUp(600,function(){$(this).remove()})})}else e.push(b)}a.commentList=e;a.ResetCommentEditor()}return true})};a.SubmitComment=function(b){if(a.$submitCommentBtn.hasClass("disabled"))return false;if(b.commentText==null||b.commentText.length<1){$.jGrowl("Comment cannot be empty.",{header:"Error"});return false}else if(!WHT.loggedInUser.IsUser){WHT.AddDoAfterLoginCallback(function(){a.SubmitComment(b)});WHT.ShowLoginScreen("Login to submit this comment:");return false}a.$responseEditor.attr("disabled","disabled");a.$submitCommentBtn.addClass("disabled");a.$responseEditorContainer.addClass("disabled");$.post(a.submitCommentURL,{ContentID:WHT.Article.ArticleID,ParentCommentID:b.parentCommentID,CommentText:b.commentText,SkipReply:b.skipReply,IsVideo:b.isVideo,CommentID:b.CommentID||0},function(c){a.$responseEditorContainer.removeClass("disabled");if(c.Error!=null){$.jGrowl(c.Error.ErrorText,{position:"center",life:6e3});a.ResetCommentEditor();return false}else if(b.CommentID&&b.CommentID>0){var f=c.Response.Value,e=a.GetCommentContainer(f.updatedComment.ID);e.replaceWith(f.updatedCommentHTML);e.show("slow");a.commentContainerList[b.CommentID]=null}else{c.Response.Value.newComment.IsNew=true;if(b.parentCommentID!=null&&b.parentCommentID>0)$(c.Response.Value.newCommentHTML).insertAfter(a.GetCommentContainer(b.parentCommentID));else a.$responsesContainer.append(c.Response.Value.newCommentHTML);a.commentList.push(c.Response.Value.newComment);for(var d=0;d<a.commentList.length;d++)a.commentList[d]&&a.ResetCommentCascadeLevel(a.commentList[d]);a.GetCommentContainer(c.Response.Value.newComment.ID).show("slow");WHT.Article.$responsesWrapper.find(".artSubToggle .isSubscribedToArticle").attr("checked",true);a.ResetCommentEditor();return false}}).error(function(){WHT.Comments.ResetCommentEditor();a.$responseEditorContainer.removeClass("disabled")})};a.ResetCommentCascadeLevel=function(b){var c=a.GetCommentContainer(b.ID);b.CascadeLevel>10&&c.find(".reply-delete-container").hide();if(!b.IsNew||b.ParentID>0)c.find(".separator").show();else c.find(".separator").hide();b.IsNew=false};a.ResetCommentEditor=function(){a.$responseEditorContainer.insertAfter($(".responses-wrapper").next());a.$responseEditorContainerShadow.insertAfter(a.$responseEditorContainer).removeClass("full");a.$responseEditor.removeAttr("disabled");a.$submitCommentBtn.removeClass("disabled");a.$responseEditor.removeData("parentCommentID");a.$responseEditor.val("");a.$responseEditor.width(a.$responseEditor.data("defaultWidth"));a.$cancelCommentBtn.hide();if(a.commentList!=null&&a.commentList.length>0){a.commentsListHeader.children().text("Join the Discussion");a.commentsListHeader.addClass("bb-dark curved-drop-shadow-long");a.commentEditorHeader.show()}else{a.commentsListHeader.children().text("Start the Discussion");a.commentsListHeader.removeClass("bb-dark curved-drop-shadow-long");a.commentEditorHeader.hide()}a.commentsListHeader.show();a.hiddenSeparator&&a.hiddenSeparator.show()};a.activateEditor=function(d){if(a.$responseEditorContainer.hasClass("disabled"))return;if(!WHT.loggedInUser.IsUser){WHT.ShowLoginScreen("Login to submit a comment:");return false}var f=a.$responseEditor,e=f.parents(".share-widget"),c=e.data("whtPostEditor"),b=c?c.getSettings():null;if(!c)setTimeout(function(){e.whtPostEditor({mode:"comment",postTo:"SubmitComment",previewAt:"PreviewComment",editDoc:d})},10);else(!a.$responseEditorContainer.hasClass("active")||b&&b.editDoc||(!b||!b.editDoc)&&d)&&c._initEditor(d);!a.$responseEditorContainerShadow.hasClass("full")&&a.$responseEditorContainerShadow.addClass("full")};a.moveEditorBelowComment=function(c){var b=a.GetCommentContainer(c);a.$responseEditorContainer.insertAfter(b);a.$responseEditorContainerShadow.insertAfter(a.$responseEditorContainer)}}